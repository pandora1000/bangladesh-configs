{const t=function(){return this}(),{document:e,window:s}=t,n="responseType",{Boolean:i,Error:a,Object:l,Promise:o,chrome:r,performance:c}=t,{apply:d}=Reflect,h=(d.call.bind({}.hasOwnProperty),l.call.bind(l.call)),u=(r.app,r.runtime.getURL("/").slice(0,-1),r.runtime.getManifest());r.runtime.getURL(u.options_page),r.runtime.getURL(u.icons[16].split("16")[0]),(()=>{var t,s={7728:(t,s,a)=>{"use strict";a(2993);var r=a(3293),d=(a(287),a(4017)),u=a(3048),p=(a(537),a(5517),a(6252)),m=a(3577);const g={class:"frame-block"},f={class:"flex"},v=(0,p._)("div",{class:"image"},[(0,p._)("img",{src:"/public/images/icon128.png"})],-1),w={class:"info"},C=["textContent"],b=["textContent"],x=["textContent"],y={class:"flex"},k=["textContent"],_=["href"],L=["textContent"],S=["textContent"],$=["data-collapsed"],D=["data-type","hidden"],O=["textContent"],I=["textContent"],T={class:"flex"},F={class:"image flex"},j=["src"],q={class:"actions flex flex-wrap mr-2c"},z=["textContent","data-hotkey","disabled"],P=["textContent"],M={class:"flex flex-col my-1"},W=["textContent"],Z=["textContent","title"],H=["textContent"],E={class:"frame-block flex-1 pos-rel"};var R=a(3824),U=a(6930),B=a(8250),N=a(8856),Y=a(9727),A=a(8694),Q=a(3057),G=a(5310),J=a(8292),K=a(3795);const V=(/Mac/.test(navigator.platform)?"Cmd":"Ctrl")+"-Enter",X=(0,N.Z)({lifetime:9e3});let tt,et,st,nt,it;const at={components:{Icon:U.Z,VmExternals:Y.Z,SettingCheck:A.Z,Tooltip:R.Z},data(){return{installable:!1,installed:!1,message:"",cmOptions:{lineWrapping:!0},code:"",commands:{close:this.close},confirmHotkey:V,info:{},deps:{},descr:"",error:null,heading:this.i18n("msgLoadingData"),lists:null,listsShown:!0,name:"...",reinstall:!1,safeIcon:null,sameCode:!1,script:null}},computed:{trackTooltip(){return K.Z.firefox>=68?this.i18n("installOptionTrackTooltip"):null},isLocal(){return!(0,r.Q1)(this.info.url)},icons(){const{script:t}=this,e=t&&(0,r.t$)(t),s=null==t?void 0:t.meta.supportURL;return[e&&[e,"home",this.i18n("labelHomepage")],s&&[s,"question",this.i18n("buttonSupport")]].filter(i)}},async mounted(){const t=`confirm-${J.BC.paths[0]}`,e=await(0,r.gj)("CacheLoad",t);this.info=e,e?(st=e.ff>=68&&e.url.startsWith("file:"),it=(0,r.gj)("CachePop",e.url),this.guard=setInterval(r.gj,5e3,"CacheHit",{key:t}),await this.loadData(),await this.parseMeta(),await o.all([this.checkSameCode(),(async()=>{let t=2;for(;!await this.loadDeps()&&t;)await(0,r.dL)(3e3),t-=1})()]),this.installable&&(this.heading=this.reinstall?this.i18n("labelReinstall"):this.i18n("labelInstall")),this.disposeList=[B.$J.register("ctrlcmd-enter",()=>this.$refs.confirm.click())],B.$J.enable()):this.close()},beforeUnmount(){var t;this.guard&&(clearInterval(this.guard),this.guard=null),null==(t=this.disposeList)||t.forEach(t=>t())},methods:{async loadData(t){this.installable=!1;const e=st?await new o(this.pingFilePort):await this.getScript(this.info.url);if(null==e||t&&this.code===e)throw 0;this.setCode(e)},setCode(t){var e,s;const n=t.split(/\r?\n/),i=null==(e=this.$refs.externals)||null==(s=e.$refs.code)?void 0:s.cm;let a,l=-1;i&&i.eachLine(({text:t})=>(a=t!==n[l+=1],a)),this.code=t,(a||i&&l<n.length-1)&&this.$nextTick(()=>{i.setCursor(l),i.scrollIntoView(null,i.display.lastWrapHeight/3)})},async parseMeta(){const{meta:t,errors:s}=await(0,r.gj)("ParseMeta",this.code),n=(0,r.iQ)(t,"name");e.title=`${n.slice(0,100)}${n.length>100?"...":""} - ${nt||(nt=e.title)}`,this.name=h(r.Hv,[n,t.version],", "),this.descr=(0,r.iQ)(t,"description"),this.lists=(0,G.zr)(t,["antifeature","grant","match","include","exclude","excludeMatch","compatible","connect"],t=>(null==t?void 0:t.map(t=>[t.replace(/^\W+/,"")||t,t]).sort(([t],[e])=>t<e?-1:t>e).map(([,t])=>t).join("\n"))||""),this.lists[""]=(null==s?void 0:s.join("\n"))||"",this.script={meta:t,custom:{},props:{}},this.allDeps=[[...new Set(t.require)],[...new Set(l.values(t.resources))]]},async loadDeps(){const{script:t,allDeps:[e,s]}=this;if(this.safeIcon||(0,Q.d)(t).then(t=>{this.safeIcon=t}),this.require&&(0,G.vZ)(e.slice().sort(),l.keys(this.require).sort())&&(0,G.vZ)(s.slice().sort(),l.keys(this.resources).sort()))return;this.require={},this.resources={};const n=e.length+s.length;let i=0;const a=c.now(),d=()=>{c.now()-a>500&&(this.message=this.i18n("msgLoadingDependency",[i,n]))},u=async(t,e,s)=>{const n=(0,r.mn)(t,this.info.url),a=`${+s}${t}`;try{const t=await this.getFile(n,{isBlob:s,useCache:!0});e[n]=t,this.deps[a]=t,i+=1,d()}catch(e){return this.deps[a]=!1,t}},p=setTimeout(d,500),m=[...e.map(t=>u(t,this.require,!1)),...s.map(t=>u(t,this.resources,!0))],g=h(r.Hv,await o.all(m),"\n");if(clearTimeout(p),!g)return this.error=null,this.installable=!0,this.message=null,!0;this.message=this.i18n("msgErrorLoadingDependency"),this.error=g},close(){(0,r.gj)("TabClose")},async getFile(t,{isBlob:e,useCache:s}={}){const i=e?`blob+${t}`:`text+${t}`;if(s&&X.has(i))return X.get(i);const a=await(0,r.WY)(t,{[n]:e?"blob":null}),l=e?await(0,r.LZ)(a):a.data;return s&&X.put(i,l),l},async getScript(t){try{return it&&await it||await this.getFile(t)}catch(e){throw this.message=this.i18n("msgErrorLoadingData"),t}finally{it=null}},async installScript(){this.installable=!1;try{const{update:t}=await(0,r.gj)("ParseScript",{code:this.code,url:this.info.url,from:this.info.from,require:this.require,cache:this.resources}),e=(new Date).toLocaleTimeString(["fr"]),s=this.confirmedTime||(this.confirmedTime=e);this.message=`${t.message} ${s}${s===e?"":` --\x3e ${e}`}`,this.installed=!0,this.isLocal&&this.$refs.trackLocalFile.value?this.trackLocalFile():this.$refs.closeAfterInstall.value&&this.close()}catch(t){this.message=`${t}`,this.installable=!0}},async trackLocalFile(){if(!this.tracking&&this.isLocal&&this.installed){for(it=null,this.tracking=!0;this.$refs.trackLocalFile.value&&"stop"!==this.tracking;){await(0,r.dL)(500);try{await this.loadData(!0),await this.parseMeta(),await this.loadDeps(),await this.installScript(),this.sameCode=!1}catch(t){}}this.tracking=!1}},async checkSameCode(){const{name:t,namespace:e}=this.script.meta||{},s=await(0,r.gj)("GetScript",{meta:{name:t,namespace:e}});this.reinstall=!!s,this.sameCode=s&&this.code===await(0,r.gj)("GetScriptCode",s.props.id)},createFilePort(){tt=browser.tabs.connect(this.info.tabId,{name:"FetchSelf"}),tt.onMessage.addListener(t=>{et(t)}),tt.onDisconnect.addListener(()=>{this.tracking="stop"})},pingFilePort(t){tt||this.createFilePort(),et=t,tt.postMessage(null)}}},lt=(0,a(3744).Z)(at,[["render",(t,e)=>{var s;const n=(0,p.up)("icon"),i=(0,p.up)("tooltip"),a=(0,p.up)("setting-check"),l=(0,p.up)("vm-externals");return(0,p.wg)(),(0,p.iD)("div",{class:(0,m.C_)(["page-confirm frame flex flex-col h-screen",{reinstall:t.reinstall}])},[(0,p._)("div",g,[(0,p._)("div",f,[v,(0,p._)("div",w,[(0,p._)("h1",null,[(0,p._)("div",null,[(0,p._)("span",{textContent:(0,m.zw)(t.heading)},null,8,C),t.sameCode?((0,p.wg)(),(0,p.iD)("span",{key:0,textContent:(0,m.zw)(t.i18n("msgSameCode")),style:{"font-weight":"normal"}},null,8,b)):(0,p.kq)("",!0)]),(0,p._)("div",{class:"ellipsis",textContent:(0,m.zw)(t.name)},null,8,x)]),(0,p._)("div",y,[(0,p.Wm)(i,{content:t.i18n("editNavCode"),class:"abs-center",placement:"right"},{default:(0,p.w5)(()=>[(0,p.Wm)(n,{name:"code"})]),_:1},8,["content"]),(0,p._)("span",{class:"ellipsis",textContent:(0,m.zw)(t.info.url?decodeURIComponent(t.info.url):"...")},null,8,k)]),((0,p.wg)(!0),(0,p.iD)(p.HY,null,(0,p.Ko)(t.icons,([t,e,s])=>((0,p.wg)(),(0,p.iD)("a",{key:e,class:"flex",target:"_blank",href:t},[(0,p.Wm)(i,{content:s,class:"abs-center",placement:"right"},{default:(0,p.w5)(()=>[(0,p.Wm)(n,{name:e},null,8,["name"])]),_:2},1032,["content"]),(0,p._)("span",{class:"ellipsis",textContent:(0,m.zw)(decodeURIComponent(t))},null,8,L)],8,_))),128)),(0,p._)("p",{class:"descr",textContent:(0,m.zw)(t.descr)},null,8,S),(0,p._)("div",{class:"lists flex flex-wrap","data-collapsed":!t.listsShown},[(0,p._)("div",{class:"toggle abs-center",onClick:e[0]||(e[0]=e=>t.listsShown=!t.listsShown)},[t.lists?((0,p.wg)(),(0,p.j4)(i,{key:0,content:t.i18n("msgShowHide"),placement:"bottom",align:"left"},{default:(0,p.w5)(()=>[(0,p.Wm)(n,{name:"info"})]),_:1},8,["content"])):(0,p.kq)("",!0)]),((0,p.wg)(!0),(0,p.iD)(p.HY,null,(0,p.Ko)(t.lists,(e,s)=>((0,p.wg)(),(0,p.iD)("dl",{key:s,"data-type":s,hidden:!e.length,tabindex:"0"},[(0,p._)("dt",{textContent:(0,m.zw)(s?`@${s}`:t.i18n("genericError"))},null,8,O),(0,p._)("dd",{textContent:(0,m.zw)(e),class:"ellipsis"},null,8,I)],8,D))),128))],8,$)])]),(0,p._)("div",T,[(0,p._)("div",F,[(0,p._)("img",{src:t.safeIcon},null,8,j)]),(0,p._)("div",q,[(0,p._)("button",{id:"confirm",ref:"confirm",textContent:(0,m.zw)(t.reinstall?t.i18n("buttonConfirmReinstallation"):t.i18n("buttonConfirmInstallation")),"data-hotkey":t.confirmHotkey,onClick:e[1]||(e[1]=(...e)=>t.installScript&&t.installScript(...e)),disabled:!t.installable},null,8,z),(0,p._)("button",{textContent:(0,m.zw)(t.i18n("buttonClose")),onClick:e[2]||(e[2]=(...e)=>t.close&&t.close(...e))},null,8,P),(0,p._)("div",M,[(0,p.Wm)(a,{name:"closeAfterInstall",label:t.i18n("installOptionClose"),"data-disabled":t.isLocal&&(null==(s=t.$refs.trackLocalFile)?void 0:s.value),ref:"closeAfterInstall"},null,8,["label","data-disabled"]),(0,p.Wm)(a,{name:"trackLocalFile",onChange:t.trackLocalFile,ref:"trackLocalFile","data-disabled":!t.isLocal},{default:(0,p.w5)(()=>[(0,p.Wm)(i,{content:t.trackTooltip,disabled:!t.trackTooltip},{default:(0,p.w5)(()=>[(0,p._)("span",{textContent:(0,m.zw)(t.i18n("installOptionTrack"))},null,8,W)]),_:1},8,["content","disabled"])]),_:1},8,["onChange","data-disabled"])]),t.message?((0,p.wg)(),(0,p.iD)("div",{key:0,textContent:(0,m.zw)(t.message),title:t.error,class:"status"},null,8,Z)):(0,p.kq)("",!0)])]),t.info.incognito?((0,p.wg)(),(0,p.iD)("div",{key:0,class:"incognito",textContent:(0,m.zw)(t.i18n("msgIncognitoChanges"))},null,8,H)):(0,p.kq)("",!0)]),(0,p._)("div",E,[t.script?((0,p.wg)(),(0,p.j4)(l,{key:0,ref:"externals",value:t.script,class:"abs-full","cm-options":t.cmOptions,commands:t.commands,install:{code:t.code,deps:t.deps,url:t.info.url}},null,8,["value","cm-options","commands","install"])):(0,p.kq)("",!0)])],2)}]]),ot=lt;e.title=`${(0,r.ag)("labelInstall")} - ${(0,r.ag)("extName")}`,d.Z.ready.then(()=>{(0,u.sY)(ot)})},6291:(t,e,s)=>{var n={"./arrow.svg":7864,"./author.svg":6263,"./code.svg":4237,"./cog.svg":8527,"./command.svg":6337,"./filter.svg":1691,"./home.svg":6447,"./info.svg":6396,"./more.svg":485,"./plus.svg":336,"./question.svg":934,"./refresh.svg":1727,"./search.svg":2574,"./toggle-off.svg":3882,"./toggle-on.svg":6276,"./trash.svg":2981,"./undo.svg":418};function i(t){var e=o(t);return s(e)}function o(t){if(!s.o(n,t)){var e=new a("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}i.keys=()=>l.keys(n),i.resolve=o,t.exports=i,i.id=6291},7462:(t,e,s)=>{"use strict";function n(){return n=l.assign?l.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)l.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},n.apply(this,arguments)}s.d(e,{Z:()=>n})}},r={};function d(t){var e=r[t];if(void 0!==e)return e.exports;var n=r[t]={exports:{}};return s[t].call(n.exports,n,n.exports,d),n.exports}d.m=s,t=[],d.O=(e,s,n,i)=>{if(!s){var a=1/0;for(h=0;h<t.length;h++){for(var[s,n,i]=t[h],o=!0,r=0;r<s.length;r++)(!1&i||a>=i)&&l.keys(d.O).every(t=>d.O[t](s[r]))?s.splice(r--,1):(o=!1,i<a&&(a=i));if(o){t.splice(h--,1);var c=n();void 0!==c&&(e=c)}}return e}i=i||0;for(var h=t.length;h>0&&t[h-1][2]>i;h--)t[h]=t[h-1];t[h]=[s,n,i]},d.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return d.d(e,{a:e}),e},d.d=(t,e)=>{for(var s in e)d.o(e,s)&&!d.o(t,s)&&l.defineProperty(t,s,{enumerable:!0,get:e[s]})},d.o=(t,e)=>l.prototype.hasOwnProperty.call(t,e),d.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&l.defineProperty(t,Symbol.toStringTag,{value:"Module"}),l.defineProperty(t,"__esModule",{value:!0})},d.j=47,(()=>{var t={47:0};d.O.j=e=>0===t[e];var e=(e,s)=>{var n,i,[a,l,o]=s,r=0;if(a.some(e=>0!==t[e])){for(n in l)d.o(l,n)&&(d.m[n]=l[n]);if(o)var c=o(d)}for(e&&e(s);r<a.length;r++)i=a[r],d.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return d.O(c)},s=self.webpackChunkviolentmonkey=self.webpackChunkviolentmonkey||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})();var u=d.O(void 0,[386,84],()=>d(7728));u=d.O(u)})()}