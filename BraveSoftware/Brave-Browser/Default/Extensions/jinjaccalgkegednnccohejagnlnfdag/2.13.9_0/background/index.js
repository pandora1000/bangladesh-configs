{const e=function(){return this}(),{document:t,window:n}=e,r="Violentmonkey",s="auto",o="page",i="content",a="forceContent",c="injectInto",l="more",u="val",d=-1,p="response",h="responseHeaders",f="responseText",m="responseType",g="sessionId",w=e=>"function"==typeof e,y=e=>null!=e&&"object"==typeof e,{Boolean:v,Error:b,Object:k,Promise:x,chrome:S,performance:$}=e,I=x,U=b,{apply:R}=Reflect,M=R.call.bind({}.hasOwnProperty),C=k.call.bind(k.call),T=!S.app,_="#scripts",E=S.runtime.getURL("/"),D=E.slice(0,-1),O=S.runtime.getManifest(),j=S.runtime.getURL(O.options_page),L=S.runtime.getURL(O.icons[16].split("16")[0]);(()=>{"use strict";var R,A={3327:(R,A,z)=>{var q;let{browser:N}=e;if(T||null!=(q=N)&&q.runtime);else{const{Proxy:t}=e,{bind:n}=t,r="message",s="stack",o=e=>"addListener"===e||"removeListener"===e||"hasListener"===e||"hasListeners"===e,i=(e,t,r,s)=>{const i=r[t];if(void 0===i)return;let l;return l=w(s)?s(r,i):w(i)?0===s||o(t)||!M(r,t)?C(n,i,r):c(r,i):y(i)&&0!==s?a(i,s):i,e[t]=l,l},a=(e,n)=>new t({__proto__:null},{__proto__:null,get:(t,r)=>{var s;return null!=(s=t[r])?s:i(t,r,e,null==n?void 0:n[r])}}),c=(e,t,n)=>(...o)=>{let i,a;const c=new I((e,t)=>{i=e,a=t}),l=new U(`callstack before invoking ${t.name||"chrome API"}:`);return C(t,e,...o,e=>{const t=S.runtime.lastError,o=t||(n?n(i,e):i(e));o&&(t||(l[s]=`${o[1]}\n${l[s]}`),l[r]=t?o[r]:`${o[0]}`,l.isRuntime=!!t,a(l))}),c},l=(e,t)=>[e,t&&(t[r]?[t[r],t[s]]:[t,(new U)[s]])],u=async(e,t)=>{try{t(l(await e))}catch(e){t(l(0,e))}},d=(e,t,n,r)=>{try{const s=e(t,n);if(s&&s instanceof x)return u(s,r),!0;void 0!==s&&r(l(s))}catch(e){r(l(0,e))}},p=(e,t)=>(t?t[1]:"null response")||e(t[0]),h=(e,t)=>c(e,t,p);N=e.browser=a(S,{extension:0,i18n:0,runtime:{connect:0,getManifest:0,getURL:0,onMessage:{addListener:(e,t)=>r=>C(t,e,C(n,d,null,r))},sendMessage:h},tabs:{connect:0,sendMessage:h}})}const P=N,F="application/x-www-form-urlencoded",W=/((?:^|\n)\s*\/\/\x20==UserScript==)([\s\S]*?\n)\s*\/\/\x20==\/UserScript==|$/,B=/\n((?!\n)\s)*$/,H=/^(https?|file|ftps?):/,V="watchStorage",G=e.browser,K=864e5,J="blacklist",X=/^document-(start|body|end|idle)$/;let Y;function Z(e){return null==e?[]:Array.isArray(e)?e:`${e}`.split(".").filter(v)}function Q(e,t){for(let n=0,r=Z(t);n<r.length;n++){const t=r[n];if(!e||"object"!=typeof e)break;e=e[t]}return e}function ee(e,t,n,r){t=Z(t);let s,o=e||{};for(let e=0;s=t[e],e<t.length-1;e+=1)o=o[s]||(o[s]={});return void 0===n?delete o[s]:o[s]=n,r?o:e}function te(e,t,n){const r={};for(let s=0;s<t.length;s++){const o=t[s];let i=null==e?void 0:e[o];n&&(i=n(i,o)),void 0!==i&&(r[o]=i)}return r}function ne(e,t,n){const r={};for(let s=0,o=k.keys(this);s<o.length;s++){let i=o[s];const a=this[i];t&&!(i=C(t,n,i,a,this))||(r[i]=e?C(e,n,a,i,this):a)}return r}function re(e,t){this&&k.entries(this).forEach(e,t)}function se(e,t){this&&k.keys(this).forEach(e,t)}function oe(e,t){this&&k.values(this).forEach(e,t)}function ie(e){return e&&"object"==typeof e?Array.isArray(e)?Array.from(e,ie):C(ne,e,ie):e}function ae(e,t){let n;if(e&&t&&typeof e==typeof t&&"object"==typeof e)if(Array.isArray(e))n=e.length===t.length&&e.every((e,n)=>ae(e,t[n]));else{const r=k.keys(e);n=r.length===k.keys(t).length&&r.every(n=>ae(e[n],t[n]))}else n=e===t;return n}function ce(e,t){if(e!==t)return e&&"object"==typeof e?t&&"object"==typeof t?(Y=!1,e=le(e,t),Y?e:void 0):ie(e):e}function le(e,t){const n=Array.isArray(e),r=n?e:k.keys(e),s=n?t:k.keys(t),o=n?[]:{};r.length!==s.length&&(Y=!0);for(let s,i,a,c=0;c<r.length;c+=1)s=n?c:r[c],i=e[s],a=t[s],i&&"object"==typeof i?a&&"object"==typeof a?i=le(i,a):(i=ie(i),Y=!0):i!==a&&(Y=!0),o[s]=i;return o}function ue(e){return void 0===e?0:!0===e||null==e?4:!1===e?5:"string"==typeof e?e.length+2:"object"!=typeof e?`${e}`.length:Array.isArray(e)?e.reduce((e,t)=>e+1+ue(t),2):k.keys(e).reduce((t,n)=>t+n.length+4+ue(e[n]),2)}function de(e,t){return G.i18n.getMessage(e,t)||e}function pe(e,t){let n,r,s;function o(){r=null,$.now()>=n?s():i()}function i(){if(!r){const e=n-$.now();r=setTimeout(o,e)}}return t=Math.max(0,+t||0),function(...r){n=$.now()+t,s=()=>{s=null,e.apply(this,r)},i()}}function he(){}function fe(e="VM"){for(let t="";t+=Math.random().toString(36).slice(2);)if(t.length>9)return e+t}function me(e,t=0,n=1e99){const r=8192,s=[],o=e.length,i=Math.min(o||e.byteLength,t+n),a=null==o||t||i>r;for(;t<i;t+=r)s.push(String.fromCharCode.apply(null,a?new Uint8Array(e,t,Math.min(r,i-t)):e));return s.join("")}function ge(e,t=0,n=1e99){return(t||n<e.size)&&(e=e.slice(t,t+n)),e.size?new x(t=>{const n=new FileReader;n.readAsDataURL(e),n.onload=()=>{const e=n.result;t(e.slice(e.indexOf(",")+1))}}):""}function we(e){const t=e.indexOf(","),n=e.slice(0,t);return e=decodeURIComponent(e.slice(t+1)),e=/(^|;)\s*base64\s*(;|$)/.test(n)?atob(e):e,/[\x80-\xFF]/.test(e)?(new TextDecoder).decode(ye(e)):e}function ye(e){const t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r+=1)n[r]=e.charCodeAt(r);return n}const ve=/^(.*?)-([-.0-9a-z]+)|$/i,be=/^\d+$/;function ke(e,t){const[,n=e||"",r]=ve.exec(e),[,s=t||"",o]=ve.exec(t),i=xe(n,s)||!r-!o||r&&xe(r,o,!0);return i<0?-1:+!!i}function xe(e,t,n){const r=e.split("."),s=t.split("."),o=r.length,i=s.length,a=(n?Math.min:Math.max)(o,i);let c;for(let e=0;!c&&e<a;e+=1){const t=r[e],o=s[e];c=n?be.test(t)&&be.test(o)?t-o:t>o||t<o&&-1:(parseInt(t,10)||0)-(parseInt(o,10)||0)}return c||n&&o-i}function Se(e){for(const t in e)if(M(e,t))return!1;return!0}function $e(e){return Array.isArray(e)?e:[e]}const Ie=["blob","arraybuffer"];async function Ue(e,t={}){return new x((n,r)=>{const s=new XMLHttpRequest,o={headers:{get:e=>s.getResponseHeader(e)}},{[m]:i}=t;s.open("GET",e,!0),Ie.includes(i)&&(s[m]=i),s.onload=()=>{if(o.status=s.status||200,o.data=s[Ie.includes(i)?p:f],"json"===i)try{o.data=JSON.parse(o.data)}catch(e){}o.status>300?r(o):n(o)},s.onerror=()=>{o.status=-1,r(o)},s.send()})}const Re={"greasyfork.org":"application/javascript, text/plain, text/css"},Me=/^(file:\/\/|about:|data:|https?:\/\/([^@/]*@)?(localhost|127\.0\.0\.1|(192\.168|172\.16|10\.0)\.\d+\.\d+|\[(::1|(fe80|fc00)::[.:0-9a-f]+)]|[^/:]+\.(test|example|invalid|localhost))(:\d+|\/|$))/i,Ce=e=>/^data:/i.test(e),Te=e=>e&&!Me.test(decodeURI(e));async function _e(e,t={}){if(e.startsWith("file://"))return Ue(e,t);const{body:n,headers:r,[m]:s}=t,o=n&&"[object Object]"===C({}.toString,n),[,i,a,c,l]=e.match(/^([-\w]+:\/\/)([^@/]*@)?([^/]*)(.*)|$/),u=Re[c],d=k.assign({cache:Te(e)?void 0:"no-cache"},t,{body:o?JSON.stringify(n):n,headers:o||u||a?k.assign({},r,o&&{"Content-Type":"application/json"},a&&{Authorization:`Basic ${btoa(decodeURIComponent(a.slice(0,-1)))}`},u&&{accept:u}):r});let p={url:e,status:-1};try{const t=a?i+c+l:e,n=await fetch(t,d),r={arraybuffer:"arrayBuffer",blob:"blob",json:"json"}[s]||"text";p.status=n.status||200,p.headers=n.headers,p.data=await n[r]()}catch(t){p=k.assign(t,p),p.message+="\n"+e}if(p.status<0||p.status>300)throw p;return p}const Ee=G.windows,De=`${L}128.png`,Oe=/[#/?]/g,je=e=>String.fromCharCode(e.charCodeAt(0)-32+65280),Le=/(Receiving end does not exist)|The message port closed before|$/;function Ae(){const e=[];return{hook:t=>(e.push(t),()=>{const n=e.indexOf(t);n>=0&&e.splice(n,1)}),fire:t=>{e.slice().forEach(e=>{e(t)})}}}function ze(e,t,n){return T&&y(t)&&(t=ie(t)),Ne({cmd:e,data:t},n)}function qe(e,t,n,r){return G.tabs.sendMessage(e,{cmd:t,data:n},r).catch(Fe)}function Ne(e,{retry:t}={}){if(t)return Pe(e);let n=G.runtime.sendMessage(e);return n=n.catch(Fe),n}async function Pe(e,t=1e4){for(let n=$.now();$.now()-n<t;){try{const t=await Ne(e);if(void 0!==t)return t}catch(e){if(!Le.exec(e)[1])throw e}await G.storage.local.get(r)}throw new b(r+" cannot connect to the background page.")}function Fe(e){if(!Le.exec(e)[0])return x.reject(e)}function We(e){var t;let n;return e.custom.homepageURL||(n=e.meta).homepageURL||(null==(t=e.inferred)?void 0:t.homepageURL)||n.homepage||n.website||n.source}function Be(e){var t;return e.meta.supportURL||(null==(t=e.inferred)?void 0:t.supportURL)}function He(e){var t,n;return e.custom.name||(n=e.meta,"name",navigator.languages.map(e=>n[`name:${e}`]||n[`name:${e.toLowerCase()}`]).find(v)||n.name||"")||`#${null!=(t=e.props.id)?t:de("labelNoName")}`}function Ve(e){var t;return(null==(t=`${e.custom.runAt||e.meta.runAt||""}`.match(X))?void 0:t[1])||"end"}function Ge(e,t){return`${E}${t&&T?"%20":""}${encodeURIComponent((t||He(e)).replace(Oe,je))}.user.js#${e.props.id}`}function Ke(e,t){if(e.config.shouldUpdate){const{custom:n,meta:r}=e,s=et(n.downloadURL||r.downloadURL||n.lastInstallURL),o=et(n.updateURL||r.updateURL||s),i=s||o;if(i)return t?[s,o]:i}}function Je(e,t){let n;try{n=new URL(e,t)}catch(t){return`data:,${t.message} ${e}`}return["http:","https:","ftp:","data:"].includes(n.protocol)||(n.protocol="http:"),n.href}function Xe(e){return e.replace(/[-\\/:*?"<>|%\s]/g,e=>{let t=e.charCodeAt(0).toString(16);return t.length<2&&(t=`0${t}`),`-${t}`})}async function Ye(){return(await G.tabs.query({active:!0,currentWindow:!0}))[0]||Ee&&(await G.tabs.query({active:!0,windowId:(await Ee.getCurrent()).id}))[0]}function Ze(e){return e<0?x.resolve():new x(t=>setTimeout(t,e))}function Qe(e){return this.filter(v).join(e)}function et(e){try{if(e&&new URL(e))return e}catch(e){}}function tt(e,t){if(Ce(t))return t;if(/^(i,|image\/)/.test(e)){const t=e.lastIndexOf(",");return`data:${e.startsWith("image/")?e.slice(0,t):"image/png"};base64,${e.slice(t+1)}`}return e}async function nt(e,t){const n=(e.headers.get("content-type")||"").split(";")[0]||"",r=await ge(e.data);return t?[n,r]:`${n},${r}`}var rt=z(3347),st=z.n(rt);function ot(e){return(...t)=>st()&&st()[e](...t)}const it=ot("getDomain"),at=(ot("getSubdomain"),ot("getPublicSuffix"));function ct(){return ct=k.assign?k.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)k.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ct.apply(this,arguments)}const lt={},ut=k.assign.bind(k,lt);function dt(e){C(re,e,([e,t])=>{lt[e]=t,t.isOwn=!0})}async function pt(e){const t=await browser.tabs.query({});let n=0;for(let r=0;r<t.length;r++)e(t[r]),n+=1,n%20==0&&await new x(setTimeout)}let ht=browser.storage.local;class ft{constructor(e){this.name="",this.prefix=e}toKey(e){return this.prefix+e}toId(e){return e.startsWith(this.prefix)?e.slice(this.prefix.length):""}async getOne(e){const t=this.toKey(e);return(await ht.get([t]))[t]}async getMulti(e,t){const n=null==e?void 0:e.map(this.toKey,this),r=await ht.get(n);return t||this.prefix?C(ne,r,t,this.toId,this):r}async remove(e){const t=$e(e).filter(v).map(this.toKey,this);t.length&&await ht.remove(t)}async setOne(e,t){if(e)return this.set({[e]:t})}async set(e){return await ht.set(this.prefix?C(ne,e,null,this.toKey,this):e),e}}const mt="cac:",gt="code:",wt="mod:",yt="req:",vt="scr:",bt="val:",kt={get api(){return ht},set api(e){ht=e},forKey:e=>xt[/^\w+:|$/.exec(e)[0]],base:new ft(""),cache:new ft(mt),code:new ft(gt),mod:new ft(wt),require:new ft(yt),script:new ft(vt),value:new ft(bt)},xt=C(ne,kt,null,(e,t)=>{if(t instanceof ft)return t.name=e,t.prefix}),St=xt[mt].name,$t=xt[gt].name,It=(xt[wt].name,xt[yt].name),Ut=(xt["scr:"].name,xt[bt].name),Rt=kt;function Mt(e={}){const t={},{init:n,transform:r}=e;return function(...e){const[n]=e;return t[n]||(t[n]=C(s,this,...e))};async function s(...e){const[s,o]=e;try{const i=await Ct(s,n?n(o):o);if(i){const t=r?await r(i,...e):i.data;await this.setOne(s,t)}}finally{delete t[s]}}}async function Ct(e,t){if(Ce(e))return;const n=await Rt.mod.getOne(e);for(let r=0,s=[0,1];r<s.length;r++){const o=s[r];if(n||o){const r=await _e(e,o?t:ct({},t,{method:"HEAD"})),{headers:s}=r,i=s.get("etag")||+new Date(s.get("last-modified"))||+new Date(s.get("date"));if(i&&i===n)return;if(o)return i?Rt.mod.setOne(e,i):n&&Rt.mod.remove(e),r}}}function Tt({lifetime:e=3e3,onDispose:t}={}){let n,r,s,o=k.create(null),i=-1;return{batch:e=>{r=e,s=0},get:a,some:(e,t)=>{for(const n in o){const r=o[n];if(r&&e.call(t,r.value,n))return!0}},pop:(e,t)=>{const n=a(e,t);return c(e),n},put:(e,t,n)=>(l(o[e]=n?{value:t,lifetime:n}:{value:t},n),t),del:c,has:e=>o[e],hit:(e,t)=>{const n=o[e];n&&l(n,t)},destroy:()=>{if(t)for(const e in o)c(e);else o=k.create(null);clearTimeout(n),n=0}};function a(e,t,n=!0){const r=o[e];return r&&n&&l(r,r.lifetime),r?r.value:t}function c(e){const n=o[e];n&&(delete o[e],null==t||t(n.value,e))}function l(t,o=e){if(t.expiry=o+(r&&s||(s=$.now())),n){if(o>=i)return;clearTimeout(n)}i=o,n=setTimeout(u,o+1e3)}function u(){const e=$.now();let t=Number.MAX_SAFE_INTEGER;for(const n in o){const{expiry:r}=o[n];r<e?c(n):r<t&&(t=r)}i=t-e,n=t<Number.MAX_SAFE_INTEGER?setTimeout(u,i+1e3):0}}dt({Storage:([e,t,...n])=>kt[e][t](...n)}),Rt.cache.fetch=Mt({init:e=>ct({},e,{[m]:"blob"}),async transform(e,t,n,r){const[s,o]=await nt(e,!0);return await(null==r?void 0:r(t,e.data,s)),`${s},${o}`}}),Rt.require.fetch=Mt({transform:({data:e},t)=>/^\s*</.test(e)?x.reject(`NOT_JS: ${t} "${e.slice(0,100).trim().replace(/\s{2,}/g," ")}"`):e}),Rt.code.fetch=Mt();const _t=Tt({lifetime:3e5});dt({CacheLoad:e=>_t.get(e)||null,CacheHit(e){_t.hit(e.key,e.lifetime)},CachePop:e=>_t.pop(e)||null});const Et=_t;function Dt(){const e={};return{on:(t,n)=>{let r=e[t];r||(r=[],e[t]=r),r.push(n)},off:(t,n)=>{const r=e[t];if(r){const e=r.indexOf(n);e>=0&&r.splice(e,1)}},fire:(t,n)=>{const r=e[t];r&&r.forEach(e=>{e(n,t)})}}}const Ot={isApplied:!0,autoUpdate:1,updateEnabledScriptsOnly:!0,lastUpdate:0,lastModified:0,showBadge:"unique",badgeColor:"#880088",badgeColorBlocked:"#888888",exportValues:!0,exportNameTemplate:"[violentmonkey]_YYYY-MM-DD_HH.mm.ss",expose:{"greasyfork%2Eorg":!0,"sleazyfork%2Eorg":!1},closeAfterInstall:!1,trackLocalFile:!1,autoReload:!1,features:null,blacklist:null,syncScriptStatus:!0,sync:null,customCSS:"",importScriptData:!0,importSettings:!0,notifyUpdates:!1,notifyUpdatesGlobal:!1,version:null,defaultInjectInto:s,xhrInject:!1,filters:{searchScope:"name",showOrder:!1,sort:"exec",viewSingleColumn:!1,viewTable:!1},filtersPopup:{sort:"exec",enabledFirst:!1,groupRunAt:!0,hideDisabled:""},editor:{lineWrapping:!1,indentWithTabs:!1,indentUnit:2,tabSize:2,undoDepth:500},editorTheme:"",editorThemeName:null,editorWindow:!1,editorWindowPos:{},editorWindowSimple:!0,scriptTemplate:`// ==UserScript==\n// @name        New script {{name}}\n// @namespace   ${r} Scripts\n// @match       {{url}}\n// @grant       none\n// @version     1.0\n// @author      -\n// @description {{date}}\n// ==/UserScript==\n`,showAdvanced:!0,uiTheme:""},jt=[],Lt=[];async function At(e){try{await(w(e)?e():e)}catch(e){console.error(e)}}let zt,qt,Nt={};dt({GetAllOptions:()=>lt.GetOptions(Ot),GetOptions:e=>C(ne,e,(e,t)=>Kt(t)),async SetOptions(e){qt&&await qt;for(let t=0,n=$e(e);t<n.length;t++){const{key:e,value:r,reply:s}=n[t];Jt(e,r,s)}zt&&Gt()}});const Pt="options",Ft="scriptTemplate",Wt=Ae(),Bt=pe(Gt,100),Ht=pe(()=>Rt.base.setOne(Pt,Nt),100);function Vt(e,t,n){zt?delete zt[e]:zt={},zt[e]=t,n||Bt()}function Gt(){const e=zt;zt=null,Wt.fire(e)}function Kt(e){var t;let n=Nt[e];if(null!=n)return n;const r=Z(e),s=r[0],o=null!=(t=Nt[s])?t:ie(Ot[s]);return r.length>1?Q(o,r.slice(1)):o}function Jt(e,t,n){if(qt)return qt.then(()=>Jt(...arguments));const r=Z(e),s=r[0];if(e=r.join("."),!M(Ot,s))return;const o=r.length>1&&r.slice(1),i=Kt([s]);ae(t,o?Q(i,o):i)||(Nt[s]=o?ee(i,o,t):t,Xt(s),Ht(),Vt(e,t,n))}function Xt(e){return ae(Nt[e],Ot[e])&&delete Nt[e]}qt=Rt.base.getOne(Pt).then(e=>{y(e)&&(Nt=e),Nt.version||Jt("version",1),"// ==UserScript==\n// @name New Script\n// @namespace Violentmonkey Scripts\n// @match {{url}}\n// @grant none\n// ==/UserScript==\n"===Nt[Ft]&&(Nt[Ft]=Ot[Ft]),k.keys(Nt).map(Xt).some(v)&&(delete Nt[`${Ft}Edited`],Ht()),qt=null}),jt.push(qt);const Yt=Wt.hook;function Zt(e){return e.split("&").reduce((e,t)=>{const[n,r]=t.split("=").map(decodeURIComponent);return e[n]=r,e},{})}function Qt(e){return k.entries(e).map(e=>e.map(encodeURIComponent).join("=")).join("&")}const en=new class{constructor(e){this.events={},this.allowed=e}checkType(e){if(this.allowed&&!this.allowed.includes(e))throw new b(`Unknown event type: ${e}`)}on(e,t){this.checkType(e);const{events:n}=this;let r=n[e];return r||(r=[],n[e]=r),()=>this.off(e,t)}off(e,t){this.checkType(e);const n=this.events[e];if(n){const e=n.indexOf(t);e>=0&&n.splice(e,1)}}emit(e,t){this.checkType(e);const n=this.events[e];if(n){const r={type:e,data:t,defaultPrevented:!1,preventDefault(){r.defaultPrevented=!0}};n.some(e=>(e(r),r.defaultPrevented))}}}(["scriptEdit","scriptChanged"]);dt({CacheNewScript(e){const t=fe();return Et.put(`new-${t}`,cn(e)),t},NewScript:e=>e&&Et.get(`new-${e}`)||cn()});const tn={default:()=>[],transform:(e,t)=>(e.push(t),e)},nn={default:()=>!1,transform:()=>!0},rn={default:()=>null,transform:(e,t)=>null==e?t:e},sn={include:tn,exclude:tn,match:tn,excludeMatch:tn,require:tn,resource:{default:()=>({}),transform:(e,t)=>{const n=t.match(/^(\w\S*)\s+(.*)/);return n&&(e[n[1]]=n[2]),e}},grant:tn},on={antifeature:tn,compatible:tn,connect:tn,noframes:nn,unwrap:nn};function an(e){const t=C(ne,sn,e=>e.default());return(e.match(W)[2]||"").replace(/(?:^|\n)\s*\/\/\x20(@\S+)(.*)/g,(e,n,r)=>{const[s,o]=n.slice(1).split(":"),i=s.replace(/[-_](\w)/g,(e,t)=>t.toUpperCase()),a=o?`${i}:${o.toLowerCase()}`:i,c=r.trim(),l=sn[a]||on[a]||rn;let u=t[a];void 0===u&&(u=l.default()),t[a]=l.transform(u,c)}),t.resources=t.resource,delete t.resource,t}function cn(e){const t=ct({url:"*://*/*",name:"",date:(new Date).toLocaleString()},e),n=Kt("scriptTemplate").replace(/{{(\w+)}}/g,(e,n)=>{const r=t[n];return null==r?e:r});return{script:{custom:{origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},config:{enabled:1,shouldUpdate:1},meta:an(n),props:{}},code:n}}function ln(e){const t=e.meta.namespace||"",n=e.meta.name||"";let r=Xe(`${t}\n${n}\n`);return t||n||(r+=e.props.id||""),r}function un(e){let t=e.custom.lastInstallURL;if(t){switch(t=t.split("/",6),t[2]){case"greasyfork.org":"scripts"!==t[3]&&t.splice(3,1);break;case"raw.githubusercontent.com":t[2]="github.com";break;case"github.com":break;case"openuserjs.org":t[3]="scripts",t[4]=t[4].replace(/(\.min)?\.user\.js$/,"");break;default:t=!1}t&&(t.length=5,t=t.join("/"))}if(t||(t=e.meta.namespace,t=/^https?:\/\/(?!tampermonkey\.net\/)/.test(t)&&Je(t).replace(/^https?(:\/\/userscripts)(\.org\/users\/\w)/,"https$1-mirror$2")),t)return e.inferred.homepageURL=t,t}function dn(e,t=We(e)){let n=t&&t.match(/^https:\/\/(?:(?:(g)reasyfork\.org(?:\/(?!scripts)[^/]+)?|openuserjs\.org)(?=\/scripts\/)|github\.com)\/[^/]+\/[^/]+/);if(n)return n=`${n[0]}/${n[1]?"feedback":"issues"}`,e.inferred.supportURL=n,n}function pn(e){if(!e||e.inferred)return;e.inferred={};const t=We(e)||un(e);Be(e)||dn(e,t)}dt({TestBlacklist:Fn});const hn={test:()=>1},fn=Tt({lifetime:36e5}),mn=Tt({lifetime:36e5}),gn=Tt({lifetime:6e4}),wn=Tt({lifetime:6e4}),yn=/^(\*|http([s*])?|file|ftp|urn):\/\/([^/]*)\/(.*)/,vn=/^(\*|http([s*])?|file|ftp|urn|([^:]*?)(?=:))(:(?:\/(?:\/)?)?)?([^/]*)(?:\/(.*))?/,bn=/^([^:]*):\/\/([^/]*)\/(.*)/;let kn,xn,Sn,$n,In,Un,Rn,Mn={},Cn=0,Tn=[];Lt.push(Wn),Yt(e=>{if(J in e){const t=Wn(e.blacklist||[]),n=t.length?t:null;if(Rt.base.setOne("blacklistErrors",n),n)throw n}});class _n{constructor(e,t,n,r,s){const o="*"===t||"*"===n;this.scheme=o?"http":t,this.scheme2=o?"https":null,this.host="*"===r?null:Nn(r),this.path="*"===s?null:Pn(s)}test(){var e,t;return(this.scheme===Sn||this.scheme2===Sn)&&!1!==(null==(e=this.host)?void 0:e.test($n))&&!1!==(null==(t=this.path)?void 0:t.test(In))}static try(e){const t=e.match(yn);if(t)return new _n(...t);if("<all_urls>"===e)return hn;throw`Bad pattern: ${_n.fail(e)} in ${e}`}static fail(e){const t=e.match(vn);return((null!=t[3]?(t[3]?"unknown":"missing")+" scheme, ":"")+("://"!==t[4]?'missing "://", ':"")||(null==t[6]?'missing "/" for path, ':"")).slice(0,-2)}}class En{constructor(e,t,n){this.s=n?e.toLowerCase():e,this.i=!!n,this.cmp=t<0?"":t?"startsWith":"endsWith"}test(e){const{s:t,cmp:n}=this,r=e.length-t.length;return r>=0&&(n&&r?e[n](t)||this.i&&e.toLowerCase()[n](t):e===t||!r&&this.i&&e.toLowerCase()===t)}static try(e,t){const n=e.indexOf("*");if(n===e.length-1)e=e.slice(0,-1);else if(0===n&&e.indexOf("*",1)<0)e=e.slice(1);else if(n>=0)return;return new En(e,n,t)}}function Dn(e){fn.batch(e),mn.batch(e),gn.batch(e),wn.batch(e),kn=Array.isArray(e)&&e}function On(e){xn=e,[,Sn,$n,In]=e?e.match(bn):["","","",""],Un=e?gn.get(e)||gn.put(e,{}):null,Rn=e?wn.get(e)||wn.put(e,{}):null}function jn(e,t){let n,r,s,o;const{custom:i,meta:a}=t;return(!((n=i.origMatch&&a.match||"").length+(r=i.match||"").length+(s=i.origInclude&&a.include||"").length+(o=i.include||"").length)||Ln(e,t,n,r,s,o))&&!((n=i.origExcludeMatch&&a.excludeMatch||"").length+(r=i.excludeMatch||"").length+(s=i.origExclude&&a.exclude||"").length+(o=i.exclude||"").length&&Ln(e,t,n,r,s,o))}function Ln(e,t,...n){xn!==e&&On(e);for(let r,s,o,i,a,c,l,u,d=0;d<4;d+=1){if((s=n[d]).length){i||(d<2?(o=_n.try,i=fn,a=Un):(o=zn,i=mn,a=Rn));for(let n=0,d=s;n<d.length;n++){const s=d[n];if(e&&(c=a[s]))return c;if(null==c){if(!(r=i.get(s))){try{r=o(s)}catch(e){r={err:e}}i.put(s,r)}if(l=r.err)kn&&(l=l.message||l,l=e?`${l} - ${u||(u=Ge(t))}`:l,kn.push(l));else if(e&&(a[s]=+!!r.test(e)))return!0}}}1===d&&(i=!1)}}function An(e){return e.replace(/[.?+[\]{}()|^$]/g,"\\$&").replace(/\*/g,".*?")}function zn(e){if(e.length>1&&"/"===e[0]&&"/"===e[e.length-1])return new RegExp(e.slice(1,-1),"i");const t=e.includes(".tld/"),n=!t&&En.try(e,!0);if(n)return n;const r=`^${An(e)}$`,s=t?r.replace("\\.tld/","((?:\\.[-\\w]+)+)/"):r,o=RegExp(s,"i");return r!==s&&(o.test=qn),o}function qn(e){var t;const n=e.match(this),r=null==n||null==(t=n[1])?void 0:t.slice(1).toLowerCase();return!!r&&at(r)===r}function Nn(e){const t=e.endsWith(".tld")&&!!st();let n,r="",s=e,o="";if(e.startsWith("*."))s=s.slice(2),r="(?:|[^:/]*?\\.)";else if(!t&&(n=En.try(e,!0)))return n;t&&(s=s.slice(0,-4),o="(|(?:\\.[-\\w]+)+)");const i=RegExp(`^${r}${An(s)}${o}$`,"i");return t&&(i.test=qn),i}function Pn(e){const t=e.indexOf("?"),n=e.indexOf("#",t+1)>=0;return n&&En.try(e)||RegExp(`^${An(e)}${n?"$":`($|${t>=0?"#":"[?#]"})`}`)}function Fn(e){let t=Mn[e];if(void 0===t){xn!==e&&On(e);const n=Tn.find(t=>t.test(e));t=(null==n?void 0:n.reject)&&n.text,Bn(e,t||!1)}return t}function Wn(e=Kt(J)){const t=(e,t,n)=>e.get(t)||e.put(t,n(t)),n=[];return Dn(!0),Tn=(Array.isArray(e)?e:(e||"").split("\n")).reduce((e,r)=>{try{if(!(r=r.trim())||r.startsWith("#"))return e;const n=r.startsWith("@")&&r.split(/\s/,1)[0],s=n?r.slice(n.length+1).trim():r,o="@include"===n,i=(o||"@exclude"===n)&&t(mn,s,zn)||!n&&!s.includes("/")&&t(fn,`*://${s}/*`,_n.try)||t(fn,s,_n.try);i.reject=!("@match"===n||o),i.text=r,e.push(i)}catch(e){n.push(e)}return e},[]),Mn={},Cn=0,Dn(),n}function Bn(e,t){if(Mn[e]=t,Cn+=e.length,Cn>1e5)for(const e in Mn)if(delete Mn[e]&&(Cn-=e.length)<75e3)return}const Hn={scripts:[],scriptMap:{},removedScripts:[],sizes:{},sizesPrefixRe:RegExp(`^(${gt}|scr:|${bt}|${yt}|${mt}${wt})`),storeInfo:{id:0,position:0}};function Vn(e){return+e||0}function Gn(e){return null==e?void 0:e.props.id}async function Kn(){const e=Hn.scripts.reduce((e,t,n)=>{const{props:r}=t,s=n+1;return r.position!==s&&(r.position=s,(e||(e={}))[r.id]=t),e},null);return Hn.storeInfo.position=Hn.scripts.length,e&&(await Rt.script.set(e),Jt("lastModified",Date.now())),!!e}async function Jn(){Hn.scripts.sort((e,t)=>Vn(e.props.position)-Vn(t.props.position));const e=await Kn();return ze("ScriptsUpdated",null),e}function Xn(e){return Hn.scriptMap[e]}function Yn(e){var t;return null!=(t=null==e?void 0:e.map(Xn))?t:[...Hn.scripts,...Hn.removedScripts]}function Zn({id:e,uri:t,meta:n,removed:r}){let s;return e?s=Xn(e):(t||(t=ln({meta:n,id:"@@should-have-name"})),s=Hn[r?"removedScripts":"scripts"].find(({props:e})=>t===e.uri)),s}function Qn(){return[...Hn.scripts]}ut({GetScriptVer(e){const t=Zn(e);return t?t.meta.version:null}}),dt({CheckPosition:Jn,CheckRemove:br,RemoveScripts:vr,GetScript:Zn,async ExportZip({values:e}){const t=Qn(),n=t.map(Gn),r=await Rt.code.getMulti(n);return{items:t.map(e=>({script:e,code:r[e.props.id]})),values:e?await Rt.value.getMulti(n):void 0}},GetScriptCode:e=>Rt.code[Array.isArray(e)?"getMulti":"getOne"](e),async MarkRemoved({id:e,removed:t}){if(!t&&Zn({meta:Xn(e).meta}))throw de("msgNamespaceConflictRestore");await Sr(e,{config:{removed:t?1:0},props:{lastModified:Date.now()}});const n=Hn[t?"scripts":"removedScripts"],r=n.findIndex(t=>t.props.id===e),[s]=n.splice(r,1);Hn[t?"removedScripts":"scripts"].push(s)},Move({id:e,offset:t}){const n=Xn(e),r=Hn.scripts.indexOf(n);return Hn.scripts.splice(r,1),Hn.scripts.splice(r+t,0,n),Kn()},ParseMeta:$r,ParseScript:Ir,UpdateScriptInfo:({id:e,config:t,custom:n})=>Sr(e,{config:t,custom:n,props:{lastModified:Date.now()}}),Vacuum:_r}),jt.push(async()=>{var e;const t=await Rt.base.getOne("version"),n="2.13.9";t||await new x((e,t)=>{function n(n){const r=n.transaction(["scripts","require","cache","values"]),o={};let i=3;const a=()=>{i-=1,i||e(Rt.base.set(o))},c=(e,n)=>{const s=r.objectStore(e).getAll();s.onsuccess=()=>n(s.result),s.onerror=t};c("scripts",e=>{const t={};e.forEach(e=>{const{code:n,id:r,uri:i}=e;o[Rt.script.toKey(r)]=s(e),o[Rt.code.toKey(r)]=n,t[i]=r}),c("values",e=>{e.forEach(({uri:e,values:n})=>{const r=t[e];r&&(o[Rt.value.toKey(r)]=n)}),a()})}),c("cache",e=>{e.forEach(({uri:e,data:t})=>{o[Rt.cache.toKey(e)]=t}),a()}),c("require",e=>{e.forEach(({uri:e,code:t})=>{o[Rt.require.toKey(e)]=t}),a()})}function s(e){return{meta:an(e.code),custom:k.assign({origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},e.custom),props:{id:e.id,uri:e.uri,position:e.position},config:{enabled:e.enabled,shouldUpdate:e.update}}}console.info("Upgrade database..."),(()=>{const e=indexedDB.open(r,1);e.onsuccess=()=>{try{n(e.result)}catch(e){t(e)}},e.onerror=t,e.onupgradeneeded=()=>{t()}})()}).catch(()=>{}),n!==t&&Rt.base.set({version:n});const i=await Rt.base.getMulti(),{scripts:a,removedScripts:c,storeInfo:l,scriptMap:u}=Hn,d={};C(re,i,([e,t])=>{const n=+Rt.script.toId(e);if(n&&t){const e=ln(t);if(!t.config.removed){if(u[n]&&u[n]!==t)return;if(d[e])return;d[e]=t}t.props=ct({},t.props,{id:n,uri:e}),t.custom=ct({},{origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},t.custom),l.id=Math.max(l.id,n),l.position=Math.max(l.position,Vn(t.props.position)),(t.config.removed?c:a).push(t);const{meta:r=(t.meta={})}=t;r.require||(r.require=[]),r.resources||(r.resources={}),r.grant=[...new Set(r.grant||[])]}}),n!==t&&T&&(null==(e=i.options)?void 0:e.defaultInjectInto)===o&&ke(t,"2.12.7")<=0&&Jt("defaultInjectInto",s),Jn(),_r(i)});const er="cacheKeys",tr="reqKeys",nr="scripts",rr="valueIds",sr=()=>({depsMap:{},runAt:{},[nr]:[]}),or=/^GM[_.]setClipboard$/,ir=/^GM[_.](listValues|([gs]et|delete)Value)$/,ar={[St]:er,[$t]:"ids",[It]:tr,[Ut]:rr},cr=k.entries(ar),lr=new Set;function ur(e,t,n){Dn(n||!0);const r=Fn(e)?[]:Hn.scripts.filter(n=>{var r;return(t||!(null!=(r=n.custom.noframes)?r:n.meta.noframes))&&jn(e,n)});if(Dn(),!r[0])return;let s=!T;const o={},i=sr(),a=sr();for(let e=0;e<cr.length;e++){const[t,n]=cr[e];i[t]={},a[t]={},i[n]=[],a[n]=[]}return r.forEach(e=>{const{id:t}=e.props;if(!(o[t]=+!!e.config.enabled))return;const{meta:n,custom:r}=e,{pathMap:c=Ur(e)}=r,l=Ve(e),u="start"===l||"body"===l?i:a,{depsMap:d}=u;u.ids.push(t),u.runAt[t]=l,n.grant.some(ir.test,ir)&&u.valueIds.push(t),!s&&n.grant.some(or.test,or)&&(s=i.clipFF=!0);for(let e=0,r=[[n.require,It,we],[k.values(n.resources),St]];e<r.length;e++){const[n,s,o]=r[e],a=ar[s],l=s===St?i:u;for(let e=0;e<n.length;e++){let r=n[e];r=c[r]||r,r&&(Ce(r)?o&&(u[s][r]=o(r)):l[a].includes(r)||(u[a].push(r),(d[r]||(d[r]=[])).push(t)))}}u.scripts.push(e)}),n?(i.ids.length&&(i.promise=dr(i)),a.ids.length&&(a.promise=Ze().then(dr.bind(null,a))),k.assign(i,{allIds:o,[l]:a})):dr(a)}async function dr(e){const t=[];for(let n=0;n<cr.length;n++){const[r,s]=cr[n];for(let n=0,o=e[s];n<o.length;n++){const e=o[n];t.push(Rt[r].toKey(e))}}const n=await Rt.base.getMulti(t),r=new Set;for(let t=0;t<cr.length;t++){const[o,i]=cr[t];for(let t=0,a=e[i];t<a.length;t++){const i=a[t];let c=n[Rt[o].toKey(i)];var s;c||o!==Ut||(c={}),e[o][i]=c,null==c&&(o===$t?r.add(i):null==(s=e.depsMap[i])||s.forEach(e=>r.add(e)))}}return r.size&&pr(r),e}function pr(e){const t=[],n=de("msgMissingResources");let r,s=de("msgReinstallScripts"),o=s;e.forEach(e=>{r=`\n#${e}: ${He(Xn(e))}`,s+=r,lr.has(e)||(lr.add(e),t.push(e),o+=r)}),console.error(`${n} ${s}`),t.length&&hr(n,o,t)}function hr(e,t,n){lt.Notification({title:e,text:t},void 0,e=>{e&&n.forEach(e=>lt.OpenEditor(e))})}async function fr({ids:e,sizes:t}){const n=Yn(e);return n.forEach(pn),{scripts:n,cache:await mr(n),sizes:t&&gr(e)}}async function mr(e){const t=[];for(let n=0;n<e.length;n++){const{custom:r,meta:{icon:s}}=e[n];/^https?:\/\//i.test(s)&&t.push(r.pathMap[s]||s)}const n=`${L}38.png`,[r,s]=await x.all([Rt.cache.getMulti(t,tt),lt.GetImageData(n).catch(he)]);return s&&(r[n]=s),r}function gr(e){const t=Yn(e);return t.map(({meta:e,custom:{pathMap:n={}},props:{id:r}},s)=>[Hn.sizes[gt+r]||0,ue(t[s]),Hn.sizes[bt+r]||0,e.require.reduce(wr,{len:0,pathMap:n}).len,k.values(e.resources).reduce(yr,{len:0,pathMap:n}).len])}function wr(e,t){return e.len+=(Hn.sizes[yt+(e.pathMap[t]||t)]||0)+t.length,e}function yr(e,t){return e.len+=(Hn.sizes[mt+(e.pathMap[t]||t)]||0)+t.length,e}async function vr(e){const t=[],n=[];if(Hn.removedScripts.forEach(r=>{const{id:s}=r.props;(e.includes(s)?n:t).push(r)}),n.length)return e=n.map(e=>e.props.id),e.forEach(e=>{delete Hn.scriptMap[e]}),Hn.removedScripts=t,await Rt.base.remove(e.flatMap(e=>[Rt.code.toKey(e),Rt.script.toKey(e),Rt.value.toKey(e)])),ze("RemoveScripts",e)}function br({force:e}={}){const t=Date.now(),n=Hn.removedScripts.filter(n=>{const{lastModified:r}=n.props;return n.config.removed&&(e||t-Vn(r)>6048e5)}).map(e=>e.props.id);return vr(n)}function kr(){const e=new Uint16Array(8);return n.crypto.getRandomValues(e),e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768,"01-2-3-4-567".replace(/\d/g,t=>(e[t]+65536).toString(16).slice(-4))}async function xr(e,t){const n=e.config||{};n.enabled=Vn(n.enabled),n.shouldUpdate=Vn(n.shouldUpdate);const r=e.props||{};let s;if(r.id?s=Hn.scriptMap[r.id]:(Hn.storeInfo.id+=1,r.id=Hn.storeInfo.id),r.uri=ln(e),r.uuid=r.uuid||(null==crypto.randomUUID?void 0:crypto.randomUUID())||kr(),Hn.scripts.some(({props:{id:e,uri:t}={}})=>r.id!==e&&r.uri===t))throw de("msgNamespaceConflict");if(s){e.config=ct({},s.config,n),e.props=ct({},s.props,r);const t=Hn.scripts.indexOf(s);Hn.scripts[t]=e}else r.position?Hn.storeInfo.position<r.position&&(Hn.storeInfo.position=r.position):(Hn.storeInfo.position+=1,r.position=Hn.storeInfo.position),e.config=n,e.props=r,Hn.scripts.push(e);return Rt.base.set({[Rt.script.toKey(r.id)]:e,[Rt.code.toKey(r.id)]:t})}async function Sr(e,t){const n=Hn.scriptMap[e];if(!n)throw null;return n.props=ct({},n.props,t.props),n.config=ct({},n.config,t.config),n.custom=ct({},n.custom,t.custom),await Rt.script.setOne(e,n),ze("UpdateScript",{where:{id:e},update:n})}function $r(e){const t=y(e),n=t&&e.custom||{origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},r=an(t?e.code:e),s=[];return Dn(s),jn("",{meta:r,custom:n}),Dn(),{meta:r,errors:s.length?s:null}}async function Ir(e){const{meta:t,errors:n}=$r(e);if(!t.name)throw`${de("msgInvalidScript")}\n${de("labelNoName")}`;const r={errors:n,update:{message:null==e.message?de("msgUpdated"):e.message||""}};let s;const o=Zn({id:e.id,meta:t});if(o){if(e.isNew)throw de("msgNamespaceConflict");s=ct({},o),delete s.inferred}else({script:s}=cn()),r.isNew=!0,r.update.message=de("msgInstalled");return s.config=ct({},s.config,e.config,{removed:0}),s.custom=ct({},s.custom,e.custom),s.props=ct({},s.props,{lastModified:Date.now(),lastUpdated:Date.now()},e.props),s.meta=t,!We(s)&&Te(e.from)&&(s.custom.homepageURL=e.from),Te(e.url)&&(s.custom.lastInstallURL=e.url),e.position&&(s.props.position=+e.position),e.update||Rt.mod.remove(Ke(s,!0)||[]),Ur(s,e.url),await xr(s,e.code),Rr(s,e),k.assign(r.update,s,e.update),r.where={id:s.props.id},ze("UpdateScript",r),en.emit("scriptChanged",r),r}function Ur(e,t){const{meta:n}=e,r=t||e.custom.lastInstallURL,s=r?[...n.require,...k.values(n.resources),n.icon].reduce((e,t)=>{if(t){const n=Je(t,r);n!==t&&(e[t]=n)}return e},{}):{};return e.custom.pathMap=s,s}async function Rr(e,t,n){const{custom:{pathMap:r},meta:s}=e,o=(e,s,o)=>{var i;if(!e||Ce(e))return;e=r[e]||e;const a=null==t||null==(i=t[s])?void 0:i[e];return null==a||o?Rt[s].fetch(e,n,o).catch(e=>e):Rt[s].setOne(e,a)&&null},i=await x.all([...s.require.map(e=>o(e,It)),...k.values(s.resources).map(e=>o(e,St)),Te(s.icon)&&o(s.icon,St,Mr)]);if(null==t||!t.ignoreDepsErrors){const t=C(Qe,i.map(Cr),"\n");if(t){const n=de("msgErrorFetchingResource");return ze("UpdateScript",{update:{error:t,message:n},where:{id:e.props.id}}),`${n}\n${t}`}}}function Mr(e,t,n){return new x((r,s)=>{const o=URL.createObjectURL(new Blob([t],{type:n})),i=t=>{URL.revokeObjectURL(o),"load"===t.type?r():s(`IMAGE_ERROR: ${e}`)},a=new Image;a.onload=i,a.onerror=i,a.src=o})}function Cr(e){return e&&C(Qe,[e.status&&`HTTP${e.status}`,e.url]," ")||e}let Tr;async function _r(e){if(Tr)return Tr;let t;Tr=new x(e=>{t=e});const n=e&&[],r={},s={},o=[],i=[],a={},c=RegExp(`^(${[bt,mt,yt,gt,wt].join("|")})`),l=[bt,wt],u={},d=(t,n,s,o)=>{if(!n||o&&Ce(n))return 0;const i=t+((null==o?void 0:o[n])||n),c=a[i];c<0?(a[i]=1,n!==s&&(a[wt+n]=1),t!==wt&&(r[i]=ue(e[i])+(t===bt?0:i.length))):c||l.includes(t)||(a[i]=2+s)};return e||(e=await Rt.base.getMulti()),C(se,e,e=>{c.test(e)&&(a[e]=-1)}),Hn.sizes=r,Yn().forEach(e=>{const{meta:t,props:n}=e,{icon:r}=t,{id:s}=n,o=e.custom.pathMap||Ur(e),i=Ke(e,!0);i&&(i.forEach(e=>d(wt,e,s)),u[s]=i[0]),d(gt,s,s),d(bt,s,s),t.require.forEach(e=>d(yt,e,s,o)),C(oe,t.resources,e=>d(mt,e,s,o)),Te(r)&&d(mt,r,s,o)}),C(re,a,([e,t])=>{if(t<0)i.push(e);else if(t>=2){const r=Rt.forKey(e),s=r.toId(e),a=r.name===$t?u[s]:s;n?n.push(a||+s&&Ge(Xn(s))||e):a&&r.fetch&&(i.push(wt+a),o.push(r.fetch(a).catch(e=>`${He(Xn(+s||t-2))}: ${Cr(e)}`)))}}),i.length&&(await Rt.base.remove(i),s.errors=(await x.all(o)).filter(v)),n&&n.length&&console.warn("Missing required resources. Try vacuuming database in options.",n),Tr=null,s.fixes=o.length+i.length,t(s),s}const Er={update:lt.ParseScript,list:async()=>Qn(),get:lt.GetScriptCode,remove:e=>lt.MarkRemoved({id:e,removed:!0})},Dr=[],Or=[],jr={},Lr=pe(ss,36e5);let Ar,zr=x.resolve();function qr({name:e,uri:t}){return e||`vm@2-${t}`}function Nr(e){return/^vm(?:@\d+)?-/.test(e)}function Pr(e){const t=e.indexOf("-"),[,n]=e.slice(0,t).split("@");if("2"===n)return e.slice(t+1);try{return decodeURIComponent(e.slice(3))}catch(t){return e.slice(3)}}function Fr(){function e(e,t){const n=Z(e);n.unshift("sync"),Jt(n,t)}return(()=>{let t=Kt("sync");t&&t.services||(t={services:{}},e([],t))})(),{get:(e,t)=>{var n;const r=Z(e);return r.unshift("sync"),null!=(n=Kt(r))?n:t},set:e}}function Wr(e){function t(t){const n=Z(t);return n.unshift("services",e),n}return{get:(e,n)=>Ar.get(t(e),n),set:(e,n)=>{y(e)?C(re,e,([e,n])=>{Ar.set(t(e),n)}):Ar.set(t(e),n)},clear:()=>{Ar.set(t(),{})}}}function Br(e,t,n){let r=t||e[0];function s(){return r}return{get:s,set:t=>(e.includes(t)?(r=t,n&&n()):console.warn("Invalid state:",t),s()),is:e=>$e(e).includes(r)}}function Hr(){return Dr.map(e=>{const t=jr[e];return{name:t.name,displayName:t.displayName,authState:t.authState.get(),syncState:t.syncState.get(),lastSync:t.config.get("meta",{}).lastSync,progress:t.progress,properties:t.properties,userConfig:t.getUserConfig()}})}function Vr(e,t,n){let r;return 2===t?r={version:t,custom:e.custom,config:e.config,props:te(e.props,["lastUpdated"])}:1===t&&(r={version:t,more:{custom:e.custom,enabled:e.config.enabled,update:e.config.shouldUpdate,lastUpdated:e.props.lastUpdated}}),k.assign(r,n)}function Gr(e){const t={};try{const n=JSON.parse(e);t.code=n.code,2===n.version?(t.config=n.config,t.custom=n.custom,t.props=n.props):1===n.version&&n.more&&(t.custom=n.more.custom,t.config=Kr({enabled:n.more.enabled,shouldUpdate:n.more.update}),t.props=Kr({lastUpdated:n.more.lastUpdated}))}catch(n){t.code=e}return t}function Kr(e){return Array.isArray(e)?e.forEach(Kr):y(e)&&C(re,e,([t,n])=>{void 0===n?delete e[t]:Kr(n)}),e}function Jr(e){const t=function(){this.initialize()};return t.prototype=e,t.extend=Xr,t}function Xr(e){return Jr(k.assign(k.create(this.prototype),e))}const Yr=pe(()=>{ze("UpdateSync",Hr())}),Zr=Jr({name:"base",displayName:"BaseService",delayTime:1e3,urlPrefix:"",metaFile:r,properties:{authType:"oauth"},getUserConfig:he,setUserConfig:he,initialize(){this.progress={finished:0,total:0},this.config=Wr(this.name),this.authState=Br(["idle","no-auth","initializing","authorizing","authorized","unauthorized","error"],null,Yr),this.syncState=Br(["idle","ready","syncing","error"],null,Yr),this.lastFetch=x.resolve(),this.startSync=this.syncFactory();const e=Dt();["on","off","fire"].forEach(t=>{this[t]=(...n)=>{e[t](...n)}})},log(...e){console.log(...e)},syncFactory(){let e,t;const n=()=>this.authState.is("authorized")&&es()===this.name,r=()=>{if(!n())return x.resolve();this.log("Ready to sync:",this.displayName),this.syncState.set("ready"),zr=zr.then(()=>new x(e=>{t=pe(e,1e4),t()})).then(()=>{if(n())return this.sync();this.syncState.set("idle")}).catch(e=>{console.error(e)}).then(()=>{e=null,t=null}),e=zr};return()=>(e||r(),t&&t(),e)},prepareHeaders(){this.headers={}},prepare(){return this.authState.set("initializing"),(this.initToken()?x.resolve(this.user()):x.reject({type:"no-auth"})).then(()=>{this.authState.set("authorized")},e=>{throw["no-auth","unauthorized"].includes(null==e?void 0:e.type)?this.authState.set(e.type):(console.error(e),this.authState.set("error")),this.syncState.set("idle"),e})},checkSync(){return this.prepare().then(()=>this.startSync())},user:he,acquireLock:he,releaseLock:he,handleMetaError(e){throw e},getMeta(){return this.get({name:this.metaFile}).then(e=>JSON.parse(e)).catch(e=>this.handleMetaError(e)).then(e=>({name:this.metaFile,data:e}))},initToken(){this.prepareHeaders();const e=this.config.get("token");return this.headers.Authorization=e?`Bearer ${e}`:null,!!e},loadData(e){const{progress:t}=this,{delay:n=this.delayTime}=e;let r=x.resolve();return n&&(r=this.lastFetch.then(e=>Ze(n-(Date.now()-e))).then(()=>Date.now()),this.lastFetch=r),t.total+=1,Yr(),r.then(()=>{var t;(e=k.assign({},e)).headers=k.assign({},this.headers,e.headers);let{url:n}=e;return n.startsWith("/")&&(n=(null!=(t=e.prefix)?t:this.urlPrefix)+n),_e(n,e)}).then(({data:e})=>({data:e}),e=>({error:e})).then(({data:e,error:n})=>(t.finished+=1,Yr(),n?x.reject(n):e))},getLocalData:()=>Er.list(),getSyncData(){return this.getMeta().then(e=>x.all([e,this.list(),this.getLocalData()]))},sync(){return this.progress={finished:0,total:0},this.syncState.set("syncing"),this.prepare().then(()=>this.getSyncData()).then(e=>x.resolve(this.acquireLock()).then(()=>e)).then(([e,t,n])=>{const r=e.data||{},s=r.info||{},o=r.timestamp||0;let i=!o||k.keys(s).length!==t.length;const a=Date.now(),c=Kt("lastModified"),l={},u=this.config.get("meta",{}),d=!u.timestamp,p=d||o>u.timestamp;this.log("First sync:",d),this.log("Outdated:",p,"(","local:",u.timestamp,"remote:",o,")");const h=[],f=[],m=[],g=[],w=[];r.info=t.reduce((e,t)=>{l[t.uri]=t;let n=s[t.uri];return n||(n={},i=!0),e[t.uri]=n,n.modified||(n.modified=a,i=!0),e},{}),n.forEach(e=>{const{props:{uri:t,position:n,lastModified:s}}=e,a=r.info[t],u=l[t];a&&u?(d||!s||a.modified>s?h.push({local:e,remote:u,info:a}):(a.modified<s&&(f.push({local:e,remote:u}),a.modified=s,i=!0),a.position!==n&&(a.position&&c<=o?w.push({local:e,remote:u,info:a}):(a.position=n,i=!0))),delete l[t]):d||!p||s>o?f.push({local:e}):g.push({local:e})}),C(re,l,([e,t])=>{const n=r.info[e];p?h.push({remote:t,info:n}):m.push({remote:t})});const y=[...h.map(({remote:e,info:t})=>(this.log("Download script:",e.uri),this.get(e).then(e=>{const n=Gr(e);if(!n.code)return;t.modified&&ee(n,"props.lastModified",t.modified);const r=+t.position;return r&&(n.position=r),!Kt("syncScriptStatus")&&n.config&&delete n.config.enabled,Er.update(n)}))),...f.map(({local:e,remote:t})=>(this.log("Upload script:",e.props.uri),Er.get(e.props.id).then(n=>{const s=Vr(e,1,{code:n});return r.info[e.props.uri]={modified:e.props.lastModified,position:e.props.position},i=!0,this.put(k.assign({},t,{uri:e.props.uri,name:null}),JSON.stringify(s))}))),...m.map(({remote:e})=>(this.log("Remove remote script:",e.uri),delete r.info[e.uri],i=!0,this.remove(e))),...g.map(({local:e})=>(this.log("Remove local script:",e.props.uri),Er.remove(e.props.id))),...w.map(({local:e,info:t})=>{const n={};return t.position&&(n.props={position:t.position}),Sr(e.props.id,n)})];return y.push(x.all(y).then(()=>Jn()).then(e=>{if(e)return i=!0,Er.list().then(e=>{e.forEach(e=>{const t=r.info[e.props.uri];t&&(t.position=e.props.position)})})})),y.push(x.all(y).then(()=>{const t=[];return i&&(r.timestamp=Date.now(),t.push(this.put(e,JSON.stringify(r)))),u.timestamp=r.timestamp,u.lastSync=Date.now(),this.config.set("meta",u),x.all(t)})),x.all(y.map(e=>e.then(he,e=>e||!0))).then(e=>e.filter(v)).then(e=>{if(e.length)throw e})}).then(()=>{this.syncState.set("idle"),this.log("Sync finished:",this.displayName)},e=>{this.syncState.set("error"),this.log("Failed syncing:",this.displayName),this.log(e)}).then(()=>x.resolve(this.releaseLock()).catch(he))}});function Qr(e){Or.push(e)}function es(){return Ar.get("current")}function ts(e){return jr[e||es()]}function ns(){Ar||(Ar=Fr(),Or.forEach(e=>{const t=new e,{name:n}=t;Dr.push(n),jr[n]=t})),ss()}function rs(e){if(!e.syncState.is(["ready","syncing"]))return e.authState.is(["idle","error"])?e.checkSync():e.authState.is("authorized")?e.startSync():void 0}function ss(){const e=ts();return e&&x.resolve(rs(e)).then(Lr)}let os;async function is(e,t){null==os||os();const n=(await browser.tabs.create({url:e})).id,r=e=>{var t,r;if(null!=(t=(r=ts()).checkAuth)&&t.call(r,e.url))return browser.tabs.remove(n),setTimeout(os,0),{cancel:!0}};os=()=>{browser.webRequest.onBeforeRequest.removeListener(r)},t=t.replace(/:\d+/,""),browser.webRequest.onBeforeRequest.addListener(r,{urls:[`${t}*`],types:["main_frame","xmlhttprequest"]},["blocking"])}Yt(e=>{(null==e?void 0:e["sync.current"])&&ns()});const as={"+":"-","/":"_"};async function cs(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t),r=new Blob([n],{type:"application/octet-binary"});return(await ge(r)).replace(/[+/=]/g,e=>as[e]||"")}function ls(){return fe(fe(fe()))}async function us(e){return{code_challenge:await cs(e),code_challenge_method:"S256"}}const ds="f0q12zup2uys5w8",ps="https://violentmonkey.github.io/auth_dropbox.html",hs=/[\u007f-\uffff]/g,fs=e=>`\\u${(e.charCodeAt(0)+65536).toString(16).slice(1)}`;function ms(e){return JSON.stringify(e).replace(hs,fs)}function gs(e){return{name:e.name,size:e.size,uri:Pr(e.name)}}Qr(Zr.extend({name:"dropbox",displayName:"Dropbox",refreshToken(){const e=this.config.get("refresh_token");return this.authorized({grant_type:"refresh_token",refresh_token:e}).then(()=>this.prepare())},user(){const e=()=>this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/users/get_current_account"});return e().catch(t=>{if(401===t.status)return this.refreshToken().then(e);throw t}).catch(e=>401===e.status?x.reject({type:"unauthorized"}):x.reject({type:"error",data:e}))},handleMetaError(e){if(409!==e.status)throw e},list(){return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/files/list_folder",body:{path:""},responseType:"json"}).then(e=>e.entries.filter(e=>"file"===e[".tag"]&&Nr(e.name)).map(gs))},get(e){const t=qr(e);return this.loadData({method:"POST",url:"https://content.dropboxapi.com/2/files/download",headers:{"Dropbox-API-Arg":ms({path:`/${t}`})}})},put(e,t){const n=qr(e);return this.loadData({method:"POST",url:"https://content.dropboxapi.com/2/files/upload",headers:{"Dropbox-API-Arg":ms({path:`/${n}`,mode:"overwrite"}),"Content-Type":"application/octet-stream"},body:t,responseType:"json"}).then(gs)},remove(e){const t=qr(e);return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/files/delete",body:{path:`/${t}`},responseType:"json"}).then(gs)},async authorize(){this.session={state:fe(),codeVerifier:ls()},is(`https://www.dropbox.com/oauth2/authorize?${Qt(ct({response_type:"code",token_access_type:"offline",client_id:ds,redirect_uri:ps,state:this.session.state},await us(this.session.codeVerifier)))}`,ps)},async authorized(e){delete this.headers.Authorization,this.authState.set("authorizing");const t=await this.loadData({method:"POST",url:"https://api.dropbox.com/oauth2/token",headers:{"Content-Type":F},body:Qt(ct({client_id:ds},e)),responseType:"json"});if(!t.access_token)throw t;this.config.set({uid:t.account_id,token:t.access_token,refresh_token:t.refresh_token||e.refresh_token})},checkAuth(e){const t=`${ps}?`;if(!e.startsWith(t))return;const n=Zt(e.slice(t.length)),{state:r,codeVerifier:s}=this.session||{};return this.session=null,n.state===r&&n.code?(this.authorized({code:n.code,code_verifier:s,grant_type:"authorization_code",redirect_uri:ps}).then(()=>this.checkSync()),!0):void 0},revoke(){return this.config.set({uid:null,token:null,refresh_token:null}),this.prepare()}}));const ws="000000004418358A",ys="https://violentmonkey.github.io/auth_onedrive.html";function vs(e){return{name:e.name,size:e.size,uri:Pr(e.name)}}Qr(Zr.extend({name:"onedrive",displayName:"OneDrive",urlPrefix:"https://api.onedrive.com/v1.0",refreshToken(){const e=this.config.get("refresh_token");return this.authorized({refresh_token:e,grant_type:"refresh_token"}).then(()=>this.prepare())},user(){const e=()=>this.loadData({url:"/drive",responseType:"json"});return e().catch(t=>{if(401===t.status)return this.refreshToken().then(e);throw t}).catch(e=>400===e.status&&"invalid_grant"===Q(e,"data.error")?x.reject({type:"unauthorized"}):x.reject({type:"error",data:e}))},handleMetaError(e){if(404===e.status){var t;const n=(null==(t=e.headers.get("WWW-Authenticate"))?void 0:t[0])||"";return/^Bearer realm="OneDriveAPI"/.test(n)?this.refreshToken().then(()=>this.getMeta()):void 0}throw e},list(){return this.loadData({url:"/drive/special/approot/children",responseType:"json"}).then(e=>e.value.filter(e=>e.file&&Nr(e.name)).map(vs))},get(e){const t=qr(e);return this.loadData({url:`/drive/special/approot:/${encodeURIComponent(t)}`,responseType:"json"}).then(e=>this.loadData({url:e["@content.downloadUrl"],delay:!1}))},put(e,t){const n=qr(e);return this.loadData({method:"PUT",url:`/drive/special/approot:/${encodeURIComponent(n)}:/content`,headers:{"Content-Type":"application/octet-stream"},body:t,responseType:"json"}).then(vs)},remove(e){const t=qr(e);return this.loadData({method:"DELETE",url:`/drive/special/approot:/${encodeURIComponent(t)}`}).catch(he)},authorize(){is(`https://login.live.com/oauth20_authorize.srf?${Qt({client_id:ws,scope:"onedrive.appfolder wl.offline_access",response_type:"code",redirect_uri:ys})}`,ys)},checkAuth(e){const t=`${ys}?code=`;if(e.startsWith(t))return this.authState.set("authorizing"),this.authorized({code:e.slice(t.length)}).then(()=>this.checkSync()),!0},revoke(){return this.config.set({uid:null,token:null,refresh_token:null}),this.prepare()},authorized(e){return this.loadData({method:"POST",url:"https://login.live.com/oauth20_token.srf",prefix:"",headers:{"Content-Type":F},body:Qt(k.assign({},{client_id:ws,client_secret:"j9x3OVEtHvhiHKDWOGquyMfZKk96040H",redirect_uri:ys,grant_type:"authorization_code"},e)),responseType:"json"}).then(e=>{if(!e.access_token)throw e;this.config.set({uid:e.user_id,token:e.access_token,refresh_token:e.refresh_token})})}}));const bs="590447512361-fa9j9vrskafqi75q2p2o2mkirdo9lavo.apps.googleusercontent.com",ks="http://127.0.0.1:45678/",xs="https://www.googleapis.com/auth/drive.appdata",Ss={status:"UNAUTHORIZED"};function $s(e){return{id:e.id,name:e.name,size:+e.size,uri:Pr(e.name)}}Qr(Zr.extend({name:"googledrive",displayName:"Google Drive",urlPrefix:"https://www.googleapis.com/drive/v3",refreshToken(){const e=this.config.get("refresh_token");return e?this.authorized({refresh_token:e,grant_type:"refresh_token"}).then(()=>this.prepare()):x.reject({type:"unauthorized"})},user(){const e=()=>this.loadData({url:`https://www.googleapis.com/oauth2/v3/tokeninfo?${Qt({access_token:this.config.get("token")})}`,responseType:"json"});return e().then(e=>{if(e.scope!==xs)return x.reject(Ss)}).catch(t=>t===Ss||400===t.status&&"Invalid Value"===Q(t,"data.error_description")?this.refreshToken().then(e):x.reject({type:"error",data:t}))},getSyncData(){return this.loadData({url:`/files?${Qt({spaces:"appDataFolder",fields:"files(id,name,size)"})}`,responseType:"json"}).then(({files:e})=>{let t;const n=e.filter(e=>!!Nr(e.name)||(t||e.name!==this.metaFile?this.remove(e):t=e,!1)).map($s).filter(e=>!!e.size||(this.remove(e),!1)),r=t?$s(t):{},s=this.get(r).then(e=>JSON.parse(e)).catch(e=>this.handleMetaError(e)).then(e=>k.assign({},r,{name:this.metaFile,uri:null,data:e}));return x.all([s,n,this.getLocalData()])})},async authorize(){this.session={state:fe(),codeVerifier:ls()};const e=ct({response_type:"code",client_id:bs,redirect_uri:ks,scope:xs,state:this.session.state},await us(this.session.codeVerifier));this.config.get("refresh_token")||(e.prompt="consent"),is(`https://accounts.google.com/o/oauth2/v2/auth?${Qt(e)}`,ks)},checkAuth(e){const t="http://127.0.0.1:45678/?";if(!e.startsWith(t))return;const n=Zt(e.slice(t.length)),{state:r,codeVerifier:s}=this.session||{};return this.session=null,n.state===r&&n.code?(this.authState.set("authorizing"),this.authorized({code:n.code,code_verifier:s,grant_type:"authorization_code",redirect_uri:ks}).then(()=>this.checkSync()),!0):void 0},revoke(){return this.config.set({token:null,refresh_token:null}),this.prepare()},authorized(e){return this.loadData({method:"POST",url:"https://www.googleapis.com/oauth2/v4/token",prefix:"",headers:{"Content-Type":F},body:Qt(k.assign({},{client_id:bs,client_secret:"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"},e)),responseType:"json"}).then(e=>{if(!e.access_token)throw e;{const t={token:e.access_token};e.refresh_token&&(t.refresh_token=e.refresh_token),this.config.set(t)}})},handleMetaError:he,list(){throw new b("Not supported")},get({id:e}){return e?this.loadData({url:`/files/${e}?alt=media`}):x.reject()},put(e,t){const n=qr(e),{id:r}=e,s=fe("violentmonkey-is-great-"),o={"Content-Type":`multipart/related; boundary=${s}`},i=r?{name:n}:{name:n,parents:["appDataFolder"]},a=[`--${s}`,"Content-Type: application/json; charset=UTF-8","",JSON.stringify(i),`--${s}`,"Content-Type: text/plain","",t,`--${s}--`,""].join("\r\n"),c=r?`https://www.googleapis.com/upload/drive/v3/files/${r}?uploadType=multipart`:"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart";return this.loadData({url:c,body:a,headers:o,method:r?"PATCH":"POST"})},remove({id:e}){return this.loadData({method:"DELETE",url:`/files/${e}`})}}));const Is=Symbol("children");class Us{constructor(e,t){this.node=e,this.nsMap=ct({},t),this.parseAttrs(),this.parseName()}static fromXML(e){const t=(new DOMParser).parseFromString(e,"application/xml");return new Us(t)}parseAttrs(){const{node:e,nsMap:t}=this,n={},{attributes:r}=e;if(r)for(let r=0,s=e.attributes;r<s.length;r++){const e=s[r],{name:o,value:i}=e;"xmlns"===o?t.$=i:o.startsWith("xmlns:")&&(t[o.slice(6)]=i),n[o]=i}this.attrs=n}parseName(){const{node:e,nsMap:t}=this;if(1===e.nodeType){let n=e.tagName,r=t.$;if(n.includes(":")){let e;if([e,n]=n.split(":"),r=t[e],!r)throw new b(`Unknown namespace: ${e}`)}this.name=r+n}}text(){const{node:e}=this;if(e)return(e.textContent||"").trim()}children(){if(!this[Is]){const{node:e,nsMap:t}=this;this[Is]=[...e.children].map(e=>new Us(e,t))}return this[Is]}map(e){return this.children().map(e)}getCallback(e){return"string"==typeof e?(t=e,e=>e.name===t):e;var t}filter(e){return this.children().filter(this.getCallback(e))}find(e){return this.children().find(this.getCallback(e))}attr(e){return this.attrs[e]}}const Rs={serverUrl:"",anonymous:!1,username:"",password:""},Ms=Zr.extend({name:"webdav",displayName:"WebDAV",properties:{authType:"password",serverUrl:null},getUserConfig(){return this.userConfig||(this.userConfig=ct({},Rs,this.config.get("userConfig"))),this.userConfig},setUserConfig(e){k.assign(this.userConfig,e),this.config.set("userConfig",this.userConfig)},initToken(){var e;this.prepareHeaders();const t=this.getUserConfig();let s=(null==(e=t.serverUrl)?void 0:e.trim())||"";s.includes("://")||(s=`http://${s}`),s.endsWith("/")||(s+="/");try{new URL(s)}catch(e){return this.properties.serverUrl=null,!1}this.properties.serverUrl=`${s}${r}/`;const{anonymous:o,username:i,password:a}=t;if(o)return!0;if(!i||!a)return!1;const c=n.btoa(`${i}:${a}`);return this.headers.Authorization=`Basic ${c}`,!0},loadData(e){return Zr.prototype.loadData.call(this,k.assign({credentials:"omit"},e))},handleMetaError(e){if(![404,409].includes(e.status))throw e},list(){const{serverUrl:e}=this.properties,t=()=>this.loadData({method:"MKCOL",url:e}),n=()=>this.loadData({method:"PROPFIND",url:e,headers:{depth:"1"}}).then(e=>Us.fromXML(e).children()[0].map(e=>{const t=e.find("DAV:propstat").find("DAV:prop");if("file"==(t.find("DAV:resourcetype").find("DAV:collection")?"directory":"file")){let r;const s=t.find("DAV:displayname");if(void 0!==s)r=s.text();else{const t=e.find("DAV:href").text();r=decodeURIComponent(t.substring(t.lastIndexOf("/")+1))}if(Nr(r)){const e=t.find("DAV:getcontentlength");return{name:(n={name:r,size:e?+e.text():0}).name,size:n.size,uri:Pr(n.name)}}}var n;return null}).filter(v));return n().catch(e=>{if(404===e.status)return t().then(n);throw e})},get(e){const t=qr(e),{serverUrl:n}=this.properties;return this.loadData({url:n+t})},put(e,t){const n=qr(e),r={"Content-Type":"text/plain"},s=this.config.get("lock");s&&(r.If=`(<${s}>)`);const{serverUrl:o}=this.properties;return this.loadData({method:"PUT",url:o+n,body:t,headers:r})},remove(e){const t=qr(e),n={},r=this.config.get("lock");r&&(n.If=`(<${r}>)`);const{serverUrl:s}=this.properties;return this.loadData({method:"DELETE",url:s+t,headers:n})}});Qr(Ms),dt({SyncAuthorize:()=>{const e=ts();e&&e.authorize()},SyncRevoke:()=>{const e=ts();e&&e.revoke()},SyncStart:ss,SyncSetConfig:e=>{const t=ts();if(t)return t.setUserConfig(e),t.checkSync()}});const Cs={},Ts=Cs;function _s(e,t){const n=new RegExp(`\\s${e?"Chrom(e|ium)":"Firefox"}/(\\d+[.0-9]*)|$`,"i"),r=navigator.userAgent.match(n).pop();return t?r:parseFloat(r)}k.defineProperties(Cs,{chrome:{value:_s(!0)},firefox:{value:_s(),writable:!0},ready:{value:x.all([browser.runtime.getPlatformInfo(),null==browser.runtime.getBrowserInfo?void 0:browser.runtime.getBrowserInfo()]).then(([{os:e,arch:t},{name:n,version:r}={}])=>{k.assign(Cs,{arch:t,os:e,browserName:(null==n?void 0:n.toLowerCase())||"chrome",browserVersion:r||_s(!0,!0)}),T&&(Cs.firefox=parseFloat(r)||0)})}});const Es={},Ds=!T||!(!n.AbortSignal||!browser.windows),Os=/^(about:newtab|(chrome|edge):\/\/(newtab\/|startpageshared\/|vivaldi-webui\/startpage))$/,js=e=>e.pendingUrl||e.url||"";dt({async OpenEditor(e,t){if(null==e){const{tab:t,domain:n}=await lt.GetTabDomain(),r=n&&lt.CacheNewScript({url:js(t).split(/[#?]/)[0],name:`${Kt("scriptTemplateEdited")?"":"- "}${n}`});e="_new"+(r?`/${r}`:"")}let n=j;e&&(n+=`${_}/${e}`);for(let t=0,r=browser.extension.getViews();t<r.length;t++){const s=r[t],o=s.location.href;if(o===n||!e&&o===n+_){const{id:e,windowId:t}=await s.browser.tabs.getCurrent();return null==Ee||Ee.update(t,{focused:!0}),browser.tabs.update(e,{active:!0})}}return lt.TabOpen({url:n,maybeInWindow:!!e},t)}}),ut({async TabOpen({url:e,active:t=!0,container:n,insert:r=!0,maybeInWindow:s=!1,pinned:o},i={}){const a=i.tab||await Ye()||{},c=i.url,l=!c||c.startsWith(E),{incognito:u,windowId:d}=a,p=!u||T||!/^(chrome[-\w]*):/.test(e),h={active:!!t,pinned:!!o};let f,m=a.cookieStoreId;var g;if(m&&!u&&(m=(0===(g=l?0:n)?"firefox-default":g>0&&`firefox-container-${g}`)||m),m&&(m={cookieStoreId:m}),/^[-\w]+:/.test(e)||(e=l?browser.runtime.getURL(e):Je(e,c)),s&&Ee&&Kt("editorWindow")&&(!m||Ts.firefox>=64)){const n=ct({url:e,incognito:p&&u},Kt("editorWindowSimple")&&{type:"popup"},!T&&{focused:!!t},m),r=Kt("editorWindowPos"),s=r&&"top"in r;f=(await Ee.create(ct({},n,r)).catch(s&&he)||s&&await Ee.create(n)).tabs[0]}else l&&p&&Os.test(js(a))&&(f=await browser.tabs.update(a.id,ct({url:e},h)).catch(he));return f||(f=await browser.tabs.create(ct({url:e},h,m,p&&ct({windowId:d},r&&{index:a.index+1},Ds&&{openerTabId:a.id})))),t&&f.windowId!==d&&await(null==Ee?void 0:Ee.update(f.windowId,{focused:!0})),l||(Es[f.id]=a.id),l?f:{id:f.id}},TabClose({id:e}={},t){var n;const r=e||(null==t||null==(n=t.tab)?void 0:n.id);r>=0&&browser.tabs.remove(r)},TabFocus(e,t){browser.tabs.update(t.tab.id,{active:!0}).catch(he),null==Ee||Ee.update(t.tab.windowId,{focused:!0}).catch(he)}}),browser.tabs.onRemoved.addListener(e=>{const t=Es[e];t>=0&&(qe(t,"TabClosed",e),delete Es[e])});const Ls=t.createElement("textarea");let As;ut({SetClipboard(e){As=e,Ls.focus(),t.execCommand("copy",!1,null)}}),t.body.appendChild(Ls),t.addEventListener("copy",e=>{e.preventDefault();const{type:t,data:n}=As;e.clipboardData.setData(t||"text/plain",n)}),Lt.push(()=>{var e;null==(e=browser.commands)||e.onCommand.addListener(e=>{if("newScript"===e)lt.OpenEditor();else{const t="settings"===e?`#${e}`:"";lt.TabOpen({url:`${j}${t}`})}})}),dt({GetImageData:async e=>e.startsWith(L)?(await Zs(e)).uri:(await Rt.cache.fetch(e),tt(await Rt.cache.getOne(e)))}),ut({SetBadge:(e,{tab:t,frameId:n})=>{const r=t.id,s=Ps[r]||{};s.idMap&&0!==n||(s.total=0,s.unique=0,s.idMap={},Ps[r]=s),s.total+=e.length,e&&(e.forEach(e=>{s.idMap[e]=1}),s.unique=k.keys(s.idMap).length),Js(t,s),Ks(t,s)}});const zs=[16,32],qs={},Ns=(()=>{const e=S.browserAction,t=()=>S.runtime.lastError,n=n=>(...r)=>{try{C(n,e,...r,t)}catch(t){C(n,e,...r)}};return te(e,["setIcon","setBadgeText","setBadgeBackgroundColor","setTitle"],e=>e?n(e):he)})(),Ps={};let Fs,Ws,Bs,Hs,Vs,Gs;function Ks(e,t=Ps[e.id]){t&&Ns.setBadgeText({text:`${t[Ws]||""}`,tabId:e.id})}function Js(e,t=Ps[e.id]){t&&Ns.setBadgeBackgroundColor({color:t.blocked?Hs:Bs,tabId:e.id})}function Xs(e,t=js(e)){const n=e.id,r=H.test(t),s=(r?Fn(t):void 0)&&Vs||!r&&Gs||"";if(s||(Ps[n]||{}).blocked){Ns.setTitle({title:s,tabId:n});const t=s?{blocked:!0}:{};Ps[n]=t,Ys(e,t),Ks(e,t)}}async function Ys(e={},t={}){const n=(t.blocked?"b":!Fs&&"w")||"",r={};for(let e=0;e<zs.length;e++){const t=zs[e],s=Zs(`${L}${t}${n}.png`);r[t]=(s.then?await s:s).img}Ns.setIcon({tabId:e.id,imageData:r})}function Zs(e){return qs[e]||(qs[e]=Qs(e))}function Qs(e){return new x((n,r)=>{const s=new Image;s.src=e,s.onload=()=>{const{width:r,height:o}=s;if(!r)return void n(e);const i=t.createElement("canvas"),a=i.getContext("2d");i.width=r,i.height=o,a.drawImage(s,0,0,r,o),n(qs[e]={uri:i.toDataURL(),img:a.getImageData(0,0,r,o)})},s.onerror=r})}Yt(e=>{let t;const n=[];null!=(t=e.isApplied)&&(Fs=t,Ys(),n.push(Ys)),null!=(t=e.showBadge)&&(Ws=t,n.push(Ks)),((t=e.badgeColor)&&(Bs=t)||(t=e.badgeColorBlocked)&&(Hs=t))&&n.push(Js),J in e&&n.push(Xs),n.length&&pt(e=>n.forEach(t=>t(e)))}),Lt.push(()=>{Fs=Kt("isApplied"),Ws=Kt("showBadge"),Bs=Kt("badgeColor"),Hs=Kt("badgeColorBlocked"),Vs=de("failureReasonBlacklisted"),Gs=de("failureReasonNoninjectable"),pt(Xs),Fs||Ys()}),browser.tabs.onRemoved.addListener(e=>{delete Ps[e]}),browser.tabs.onUpdated.addListener((e,t,n)=>{const{url:r}=t;("loading"===t.status||t.favIconUrl&&n.url.startsWith("about:"))&&Xs(n,r)});const eo={};function to(e,t){const n=eo[e];w(n)?n(t):n&&qe(n[0],t?"NotificationClick":"NotificationClose",e,{frameId:n[1]})}ut({async Notification({image:e,text:t,title:n},r,s){const o=await browser.notifications.create({type:"basic",title:C(Qe,[n,T&&de("extName")]," - "),message:t,iconUrl:e||De}),i=s||r&&[r.tab.id,r.frameId];return i&&(eo[o]=i),o},RemoveNotification:e=>browser.notifications.clear(e)}),browser.notifications.onClicked.addListener(e=>{to(e,!0)}),browser.notifications.onClosed.addListener(e=>{to(e,!1),delete eo[e]});const no={};function ro(e){const t=+e.name;t&&(no[t]=1,qe(t,"PopupShown",!0),e.onDisconnect.addListener(so))}function so({name:e}){delete no[e],qe(+e,"PopupShown",!1)}async function oo(){qe((await Ye()).id,"PopupShown",!0)}let io;ut({async SetPopup(e,t){no[t.tab.id]||(k.assign(e,await fr({ids:k.keys(e.ids)})),Et.put("SetPopup",k.assign({[t.frameId]:[e,t]},Et.get("SetPopup"))))}}),Lt.push(()=>{browser.runtime.onConnect.addListener(ro),browser.webRequest.onBeforeRequest.addListener(oo,{urls:[S.runtime.getURL(O.browser_action.default_popup)],types:["main_frame"]})});const ao=fe("VM-Verify"),co={__proto__:null},lo={__proto__:null},uo=/^(proxy-|sec-)|^(user-agent|accept-(charset|encoding)|access-control-request-(headers|method)|connection|content-length|cookie2?|date|dnt|expect|host|keep-alive|origin|referer|te|trailer|transfer-encoding|upgrade|via)$/i,po={urls:["<all_urls>"],types:["xmlhttprequest"]},ho=[browser.webRequest.OnBeforeSendHeadersOptions.EXTRA_HEADERS].filter(v),fo={},mo=e=>e.name===ao,go=e=>/^cookie2?$/i.test(e.name),wo=e=>!(mo(e)||/^origin$/i.test(e.name)&&e.value===D),yo=e=>wo(e)&&!go(e),vo=/^set-cookie2?$/i,bo=/^\s*(?:__(Secure|Host)-)?([^=\s]+)\s*=\s*(")?([!#-+\--:<-[\]-~]*)\3(.*)/,ko=/\s*;?\s*(\w+)(?:=(")?([!#-+\--:<-[\]-~]*)\2)?/y,xo={strict:"strict",lax:"lax",none:"no_restriction"},So={onBeforeSendHeaders:[({requestHeaders:e,requestId:t,url:n})=>{var r;const s=lo[t]||(null==(r=e.find(mo))?void 0:r.value),o=co[s];if(o){lo[t]=s,o.coreId=t,o.url=n;const r=fo[s]||[],i=e.findIndex(go),a=r.findIndex(go);i>=0&&(o.noNativeCookie?e.splice(i,1):a>=0&&(e[i].value+="; "+r.splice(a,1)[0].value)),e=e.concat(r).filter(o.anonymous?yo:wo)}return{requestHeaders:e}},"requestHeaders","blocking",...ho],onHeadersReceived:[({[h]:e,requestId:t,url:n})=>{const r=co[lo[t]];if(r){const{storeId:t}=r;return(r.anonymous||t)&&(e=e.filter(e=>!vo.test(e.name)||t&&($o(e.value,t,n),!1))),r[h]=e.map(Uo).join(""),{[h]:e}}},h,"blocking",...ho]};function $o(e,t,n){let r=bo.exec(e);if(r){var s;const[,e,o,,i,a]=r,c={},l="Host"===e;for(ko.lastIndex=0;r=ko.exec(a);)c[r[1].toLowerCase()]=r[3];const u=null==(s=c.sameSite)?void 0:s.toLowerCase();browser.cookies.set({url:n,name:o,value:i,domain:l?void 0:c.domain,expirationDate:Math.max(0,+new Date(1e3*c["max-age"]||c.expires))||void 0,httpOnly:"httponly"in c,path:l?"/":c.path,sameSite:xo[u],secure:n.startsWith("https:")&&(!!e||"none"===u||"secure"in c),storeId:t})}}function Io(e,t){t?(fo[e]=t,C(re,So,([e,[t,...n]])=>{browser.webRequest[e].addListener(t,po,n)})):e in fo&&(delete fo[e],Se(fo)&&C(re,So,([e,[t]])=>{browser.webRequest[e].removeListener(t)}))}function Uo({name:e,value:t,binaryValue:n}){return`${Ro(e)}: ${n?me(n):Ro(t)}\r\n`}function Ro(e){return/[\u0080-\uFFFF]/.test(e)?(io||(io=new TextEncoder),me(io.encode(e))):e}Ts.chrome>=74&&Ts.chrome<=91&&browser.webRequest.onBeforeSendHeaders.addListener(he,po,ho),ut({HttpRequest(e,t){const{tab:{id:n},frameId:r}=t,{id:s,events:o}=e,i=e=>co[s]&&qe(n,"HttpRequested",e,{frameId:r});return co[s]={id:s,tabId:n,frameId:r,xhr:new XMLHttpRequest},Oo(e,o,t,i).catch(o.includes("error")&&(e=>i({id:s,error:e.message,data:null,type:"error"})))},AbortRequest(e){const t=co[e];t&&(t.xhr.abort(),jo(t))},RevokeBlob(e){const t=Et.pop(`xhrBlob:${e}`);t&&(clearTimeout(t),URL.revokeObjectURL(e))}});const Mo=1e6,Co=["readyState","status","statusText"],To=["lengthComputable","loaded","total"];function _o(e,t){return ge(e,t*Mo,Mo)}function Eo(e){const t=URL.createObjectURL(e);return Et.put(`xhrBlob:${t}`,setTimeout(URL.revokeObjectURL,6e4,t),6e4),t}function Do(e,t,n,r,s){let o,i,a,c,l,u=x.resolve(),d=0,m=null,g=!0;const{id:w,xhr:y}=e,v=n&&Eo||r&&_o,b=[],k=async()=>{if(o||(o=y.getResponseHeader("Content-Type")||""),y[p]!==m){m=y[p],g=!1;try{a=y[f],a===m&&(a=["same"])}catch(e){}(n||r)&&m&&(i=m.size,d=r&&Math.ceil(i/Mo)||1)}const u=b.shift(),{type:k}=u,x=t.includes(k),S=x&&(!s||4===y.readyState)&&!g;if(x||"loadend"===k){if(S){g=!0;for(let t=1;t<d;t+=1)await e.cb({id:w,chunk:t*Mo,data:await v(m,t),size:i})}await e.cb({blobbed:n,chunked:r,contentType:o,id:w,type:k,data:x?ct({finalUrl:e.url||y.responseURL},te(y,Co),te(u,To),{[p]:S?d&&await v(m,0)||m:null,[h]:c!==(l=e[h]||y.getAllResponseHeaders())?c=l:null,[f]:S?a:null}):null}),"loadend"===k&&jo(e)}};return e=>{b.push(e),u=u.then(k)}}async function Oo(e,t,n,r){const{tab:s}=n,{incognito:o}=s,{anonymous:i,id:a,overrideMimeType:c,xhrType:l}=e,u=Je(e.url,n.url),d=co[a];if(!d||d.cb)return;d.cb=r,d.anonymous=i;const{xhr:p}=d,h=[],f=l&&!T,g=f&&o,w=f&&!o,[y,v]=Ao(e.data);let b=!i&&(o||T);if(p.open(e.method||"GET",u,!0,e.user||"",e.password||""),p.setRequestHeader(ao,a),v&&p.setRequestHeader("Content-Type",v),C(re,e.headers,([e,t])=>{uo.test(e)?h.push({name:e,value:t}):p.setRequestHeader(e,t),b&&(b=!go({name:e}))}),p[m]=(f?"blob":l)||"text",p.timeout=Math.max(0,Math.min(2147483647,e.timeout))||0,c&&p.overrideMimeType(c),b){d.noNativeCookie=!0;for(let e=0,t=await browser.cookies.getAllCookieStores();e<t.length;e++){const n=t[e];if(n.tabIds.includes(s.id)){(T?"firefox-default"!==n.id:"0"!==n.id)&&(d.storeId=n.id);break}}const e=Date.now()/1e3,t=(await browser.cookies.getAll(ct({url:u,storeId:d.storeId},Ts.firefox>=59&&{firstPartyDomain:null}))).filter(t=>t.session||t.expirationDate>e);t.length&&h.push({name:"cookie",value:t.map(e=>`${e.name}=${e.value};`).join(" ")})}Io(a,h);const k=Do(d,t,w,g,"json"===e[m]);t.forEach(e=>{p[`on${e}`]=k}),p.onloadend=k,p.send(y)}function jo({id:e,coreId:t}){delete lo[t],delete co[e],Io(e,!1)}function Lo(e,t){C(oe,co,n=>{null!=e&&n.tabId!==e||t&&n.frameId!==t||lt.AbortRequest(n.id)})}function Ao([e,t,n]){if("fd"===t){const n=new FormData;e.forEach(e=>n.set(...e)),e=n,t=""}else if("usp"===t)t=F+";charset=UTF-8";else if(null!=t){const r=ye(atob(e.slice(e.indexOf(",")+1)));n||(t=e.match(/^data:(.+?);base64/)[1].replace(/(boundary=)[^;]+/,(e,t)=>t+String.fromCharCode(...r.slice(2,r.indexOf(13))))),e=r}return[e,t]}const zo=(e,t)=>e[t]||(e[t]={}),qo={};let No=x.resolve(),Po={};function Fo(e,t){null==e&&(Po={}),C(re,qo,([n,r])=>{const s=r[e];s&&(t?(delete s[t],Se(s)&&delete r[e]):delete r[e]),(null==e||Se(r))&&delete qo[n]})}function Wo(e,t,n){e.forEach(e=>{const{id:r,[u]:s}=e;s?ee(qo,[r,t,n],s):delete qo[r]})}function Bo(e){Rt.value.set(e),No=No.catch(console.warn).then(Ho)}async function Ho(){const e=[],t={};C(re,Po,Vo,t),Po={};for(let n=0,r=k.entries(t);n<r.length;n++){const[t,s]=r[n];for(let n=0,r=k.entries(s);n<r.length;n++){const[s,o]=r[n];Se(o)||(e.push(Go(+t,+s,o)),20===e.length&&await x.all(e.splice(0)))}}await x.all(e)}function Vo([e,t]){const n=k.entries(t);C(re,qo[e],([t,r])=>{if(t<0)return;const s=zo(this,t);C(re,r,([t,r])=>{const o=zo(zo(s,t),e);n.forEach(([e,t])=>{t!==r[e]&&(t?r[e]=t:delete r[e],o[e]=t)})})})}function Go(e,t,n){return qe(e,"UpdatedValues",n,{frameId:t}).catch(console.warn)}dt({async GetValueStore(e,{tab:t}){const n=zo(zo(qo,e),t.id);return n[0]||(n[0]=await Rt.value.getOne(e))},SetValueStores(e){const t={};return C(re,e,([e,n={}])=>{var r;(e=null==(r=Zn({id:+e,uri:e}))?void 0:r.props.id)&&(t[e]=n,Po[e]=n)}),Bo(t),No}}),ut({UpdateValue({id:e,key:t,raw:n},{tab:r,frameId:s}){const o=Q(qo,[e,r.id,s]);if(o)return n?o[t]=n:delete o[t],zo(Po,e)[t]=n||null,Bo({[e]:o}),No}});let Ko={},Jo={};const Xo={},Yo=Tt({lifetime:36e5}),Zo=Tt({lifetime:864e5}),{scriptMap:Qo}=Hn,{api:ei}=Rt,ti=pe(async()=>{const e=k.keys(Ko),t=[],n=Ko;Ko={},e.forEach(e=>{const r=n[e];r||(delete n[e],t.push(e)),ci(e,r)}),Se(n)||await ei.set(n),t.length&&await ei.remove(t),Jo&&setTimeout(li,0,n,t),ri({keys:e})},200),{hook:ni,fire:ri}=Ae(),si=ni;function oi(e,t,n=!0){n&&!Jo&&(Jo={}),C(re,t,([t,r])=>{const{prefix:s}=Rt[t];for(let t=0,o=$e(r);t<o.length;t++){const r=s+o[t],i=Jo[r]||n&&(Jo[r]=[]),a=i?i.indexOf(e):-1;a>=0&&!n?(i.splice(a,1),i.length||delete Jo[r]):a<0&&n&&i.push(e)}}),Se(Jo)&&(Jo=null)}function ii(e){Yo.batch(e),Zo.batch(e)}function ai(e,t){const n=+Rt.script.toId(e);if(n)return t?Qo[n]=t:delete Qo[n],!0}async function ci(e,t){const n=Hn.sizesPrefixRe.exec(e);n&&n[0]!==vt&&(Hn.sizes[e]=ue(t))}function li(e,t){const n=new Map;let r,s;for(const o in Jo)if((r=e[o])||t.includes(o))for(let e=0,t=Jo[o];e<t.length;e++){const i=t[e];(s=n.get(i))||n.set(i,s={}),s[o]={newValue:r}}n.forEach((e,t)=>t(e))}let ui,di,pi;Rt.api={async get(e){var t;const n={};var r;return ii(!0),(!(e=null==(t=e)?void 0:t.filter(e=>{const t=Yo.get(e),r=void 0!==t;return r&&(n[e]=ie(t)),!r&&0!==Zo.get(e)}))||e.length)&&(C(re,await ei.get(e),([t,r])=>{n[t]=r,Zo.put(t,1),Yo.put(t,ie(r),!e&&5e3),ai(t,r)}),null==(r=e)||r.forEach(e=>Zo.put(e,+M(n,e)))),ii(!1),n},async set(e){const t={},n=[];let r;ii(!0),C(re,e,([e,s])=>{const o=ce(s,Yo.get(e));void 0!==o&&(Yo.put(e,o),Zo.put(e,1),Rt.value.toId(e)?(r=!0,Ko[e]=o):(n.push(e),t[e]=s,ai(e,s)&&s.inferred&&delete(t[e]=ct({},s)).inferred,ci(e,s)))}),ii(!1),n.length&&(await ei.set(t),ri({keys:n})),r&&ti()},async remove(e){let t;(e=e.filter(e=>{let n=0!==Zo.get(e);return n&&(Yo.del(e),Zo.put(e,0),Rt.value.toId(e)?(Ko[e]=null,t=!0,n=!1):(ai(e),ci(e))),n})).length&&(await ei.remove(e),ri({keys:e})),t&&ti()}},n.watchStorage=e=>{const t=$.now();return Xo[t]=e,t},browser.runtime.onConnect.addListener(e=>{if(!e.name.startsWith(V))return;const{id:t,cfg:n,tabId:r}=JSON.parse(e.name.slice(V.length)),s=t?Xo[t]:e.postMessage.bind(e);oi(s,n),e.onDisconnect.addListener(()=>{Fo(r),oi(s,n,!1),delete Xo[t]})});const hi=fe(),fi={urls:["*://*/*"],types:["main_frame","sub_frame"]},mi=Symbol("code"),gi="inject",wi={[gi]:{},[er]:[]},yi=ct({},wi,{[gi]:{expose:!0,[g]:hi}}),vi=browser.contentScripts,bi=Tt({lifetime:3e5,onDispose(e){var t;null==(t=e.csReg)||t.then(e=>e.unregister()),bi.del(e[l])}}),ki=["description","name","namespace","runAt","version"],xi=[["homepageURL","homepage"]],Si=/^(?:(m|excludeM)atch|(ex|in)clude)$/,$i=(e,t)=>e+(t?"es":"s"),Ii=e=>e.replace(Si,$i),Ui={[s]:1,[i]:1,[o]:1},Ri={[mt]:er,[gt]:!0,[yt]:tr,[vt]:!0,[bt]:rr},Mi={},Ci=`(${e=>{self.vmResolve?self.vmResolve(e):self.vmData=e}})`,Ti=(e,t)=>t?e:`-${e}`,_i=e=>Ui[e]?e:di||s,Ei=(e,t)=>_i(e[c]||t[c]),Di=(e,t)=>e===i||e===s&&t,Oi={[J]:bi.destroy,defaultInjectInto(e){di=_i(e),bi.destroy()},xhrInject:e=>{pi=e,bi.destroy(),browser.webRequest.onHeadersReceived.removeListener(zi),e&&browser.webRequest.onHeadersReceived.addListener(zi,fi,["blocking",h,browser.webRequest.OnHeadersReceivedOptions.EXTRA_HEADERS].filter(v))},isApplied:e=>{ui=e;const t=(e?"add":"remove")+"Listener",n=e?fi:void 0;browser.webRequest.onSendHeaders[t](Ai,n),ui&&pi||browser.webRequest.onHeadersReceived[t](zi,n),browser.tabs.onRemoved[t](Ji),browser.tabs.onReplaced[t](Xi),e||(bi.destroy(),Yi(),Yo.destroy(),Zo.destroy())},expose(e){C(re,e,([e,t])=>{Mi[decodeURIComponent(e)]=t})}};function ji(e,t){if(e.cacheKeys)for(let r=0;r<this.length;r++){var n;const[s,o]=this[r],i=Ri[s];if(!0===i)return bi.destroy(),!0;null!=(n=e[i])&&n.includes(+o||o)&&(s===yt?e.depsMap[o].forEach(e=>bi.del(vt+e)):bi.del(t))}}function Li(e){C(re,e,([e,t])=>{Oi[e]?Oi[e](t):e.includes(".")&&Li(ee({},e,t))})}function Ai({url:e,frameId:t}){const n=!t,r=Ti(e,n);bi.has(r)||Ni(r,e,n)}function zi(e){var t;const n=Ti(e.url,!e.frameId),r=pi&&bi.get(n);return(null==r||null==(t=r.inject)?void 0:t.scripts)&&qi(e,r)}function qi({url:e,[h]:t,tabId:n,frameId:r},s){T&&e.startsWith("https:")&&Gi(t)&&(s[a]=!0),Wi(s.inject.scripts,s[a],n,r,s);const o=URL.createObjectURL(new Blob([JSON.stringify(s.inject)]));return t.push({name:"Set-Cookie",value:`"**VMInitInjection**"=${o.split("/").pop()}; SameSite=Lax`}),setTimeout(URL.revokeObjectURL,6e4,o),{[h]:t}}async function Ni(e,t,n){const r=n&&t.startsWith("https://")&&Mi[t.split("/",3)[2]],s=r?yi:wi;if(!ui)return s;const i=[],a=ur(t,n,i);if(bi.put(e,a||s),!a)return s;await a.promise,bi.batch(!0);const u=r?{expose:!0}:{},d={[gi]:u},{allIds:p,[l]:h}=a,f=h.promise&&fe("more");return k.assign(u,{[St]:a[St],[nr]:Pi(a),[c]:di,[l]:f,[g]:hi,clipFF:a.clipFF,ids:p,info:{ua:Ts},errors:i.filter(e=>p[e.split("#").pop()]).join("\n")}),C(oe,Ri,e=>{!0!==e&&(d[e]=a[e])}),d[l]=h,vi&&!pi&&n&&(u[o]=a[o]||Bi(h),d.csReg=Vi(u,t)),f&&(bi.put(f,h),h[l]=e),bi.put(e,d),bi.batch(!1),d}function Pi(e){const t=e.scripts;for(let n,r,s,a=0;a<t.length;a++)n=t[a],(s=n.id)||(s=n.props.id,r=vt+s,n=bi.get(r)||bi.put(r,Fi(n,e)),t[a]=n),n[c]!==i&&(e[o]=!0),n[u]=e[Ut][s]||null;return t}function Fi(e,t){const{custom:n,meta:r,props:s}=e,{id:o}=s,{require:i,runAt:a}=t,l=t.code[o],u=fe(),d=fe(),p={data:u,win:d},h=He(e),f=n.pathMap||{},m=!r.unwrap,{grant:g}=r,w=g.length,y=!w||1===w&&"none"===g[0],v=[],b=C(ne,r,null,Ii),k=W.exec(l);let x,S,$;for(let e=0;e<ki.length;e++){const t=ki[e];null==b[t]&&(b[t]="")}for(let e=0;e<xi.length;e++){const[t,n]=xi[e];!b[t]&&($=b[n])&&(b[t]=$)}m&&v.push(`window.${d}=function ${u}(`+(y?"{GM,GM_info,unsafeWindow,cloneInto,createObjectIn,exportFunction}":"GM")+(T?`,${u}){try{`:"){")+(y?"":"with(this)with(c)delete c,")+"((define,module,exports)=>{");for(let e=0,t=r.require;e<t.length;e++){const n=t[e],r=i[f[n]||n];/\S/.test(r)&&(v.push(r,B.test(r)?";":"\n;"),x=!0)}return x&&m&&v.push("(()=>{"),S=v.length,v.push(l),v.push((B.test(l)?"":"\n")+(x&&m?"})()":"")+(m?`})()${T?`}catch(e){${u}(e)}`:""}}`:"")+(T?";0":"")+`\n//# sourceURL=${Ge(e,h)}`),{code:"",displayName:h,gmi:{scriptWillUpdate:!!e.config.shouldUpdate,uuid:s.uuid},id:o,key:p,meta:b,pathMap:f,runAt:a[o],[mi]:v,[c]:Ei(n,r),metaStr:["",S,$=k.index+k[1].length,$+k[2].length]}}function Wi(e,t,n,r,s){let i,a;const u=[];for(let n=0;n<e.length;n++){const r=e[n],s=r.metaStr;if(Di(r[c],t)){if(!s[0]){const[,e,t,n]=s;s[0]=r[mi][e].slice(t,n)}i="",u.push([r.id,r.key.data])}else s[0]="",i=t?d:r[mi],t||(a=!0);r.code=i}s&&(s.inject[o]=a||Bi(s[l])),u[0]&&setTimeout(Hi,0,u,n,r)}function Bi(e,t){return null==e?void 0:e.scripts.some(Ki,t||null)}function Hi(e,t,n){for(let r=0;r<e.length;r++){const[s,o]=e[r],i=bi.get(vt+s);i&&i.key.data===o&&browser.tabs.executeScript(t,{code:i[mi].join(""),runAt:`document_${i.runAt}`.replace("body","start"),frameId:n}).then(i.meta.unwrap&&(()=>qe(t,"Run",s,{frameId:n})))}}function Vi(e,t){for(let t=0,n=e.scripts;t<n.length;t++){const e=n[t];e.code=e[mi]}return vi.register({js:[{code:`${Ci}(${JSON.stringify(e)})`}],matches:t.split("#",1),runAt:"document_start"})}function Gi(e){return e.some(({name:e,value:t})=>/^content-security-policy$/i.test(e)&&/^.(?!.*'unsafe-inline')/.test(t.match(/(?:^|;)\s*script-src-elem\s[^;]+/)||t.match(/(?:^|;)\s*script-src\s[^;]+/)||t.match(/(?:^|;)\s*default-src\s[^;]+/)||""))}function Ki(e){return!Di(e[c]||Ei(e.custom,e.meta),this)}function Ji(e){Yi(e)}function Xi(e,t){Yi(t)}function Yi(e,t){Lo(e,t),Fo(e,t)}ut({async GetInjected({url:e,[a]:t,done:n},r){const{frameId:s,tab:o}=r,i=o.id,c=!s;e||(e=r.url||o.url),Yi(i,s);const l=Ti(e,c),u=bi.get(l)||await Ni(l,e,c),d=u.inject?u:await u.promise,p=d.inject,h=p.scripts;return h&&(Wi(h,d[a]||t,i,s,d),Wo(h,i,s)),no[i]&&setTimeout(qe,0,i,"PopupShown",no[i],{frameId:s}),!n&&p},async InjectionFeedback({[a]:e,[i]:t,[l]:n,url:r},s){const{frameId:o,tab:c}=s,u=c.id;if(Hi(t,u,o),!n)return;r||(r=s.url||c.url);let d=bi.get(n)||bi.put(n,ur(r,!o));const p=d[St]||bi.put(n,d=await d)[St],h=Pi(d);return Wi(h,e,u,o),Wo(h,u,o),{[nr]:h,[St]:p}}}),Yt(Li),Lt.push(()=>{C(se,Oi,e=>{Li({[e]:Kt(e)})})}),si(({keys:e})=>{bi.some(ji,e.map((e,t)=>[e.slice(0,t=e.indexOf(":")+1),e.slice(t)]))});const Zi=`${E}confirm/index.html#`;ut({async CheckInstallerTab(e,t){const n=T&&(t.url||"").startsWith("file:")&&await browser.tabs.get(e).catch(he);return n&&js(n).startsWith(Zi)},async ConfirmInstall({code:e,from:t,url:n},{tab:r={}}){if(e||(e=(await _e(n)).data),/^\s*</.test(s=e)||s.indexOf("// ==UserScript==")<0)throw de("msgInvalidScript");var s;Et.put(n,e,3e3);const o=fe(),{active:i,id:a,incognito:c}=r,l=(!c||T)&&(n===t||Et.has(`autoclose:${a}`)||/^(chrome:\/\/(newtab|startpage)\/|about:(home|newtab))$/.test(t));Et.put(`confirm-${o}`,{incognito:c,url:n,from:t,tabId:a,ff:Ts.firefox});const u=Zi+o,{windowId:d}=l?await browser.tabs.update(a,{url:u}):await lt.TabOpen({url:u,active:!!i},{tab:r});i&&d!==r.windowId&&await(null==Ee?void 0:Ee.update(d,{focused:!0}))}});const Qi=/^https:\/\/(greasyfork\.org\/scripts\/[^/]*\/code|openuserjs\.org\/install\/[^/]*|github\.com\/[^/]*\/[^/]*\/(raw\/[^/]*|releases\/[^/]*\/download)|raw\.githubusercontent\.com(\/[^/]*){3}|gist\.github\.com\/.*?)\/[^/]*?\.user\.js([?#]|$)/i,ea=/^https?:\/\/((gist\\.)?github\\.com|(greasyfork|openuserjs)\\.org)\//i,ta=e=>`${j}${_}/${+e.split("#")[1]}`,na=T&&new RegExp(`^(view-source:)?(${E.replace("://","$&)?")}[^/]*\\.user\\.js#\\d+`),ra=na&&((e,t)=>{na.test(t)&&browser.tabs.update(e,{url:ta(t)})});async function sa(e,t){const n=e>=0&&await browser.tabs.get(e)||{},{data:r}=await _e(t).catch(he)||{};r&&an(r).name?lt.ConfirmInstall({code:r,url:t,from:n.url},{tab:n}):(Et.put(`bypass:${t}`,!0,1e4),e>=0&&browser.tabs.update(e,{url:t}))}if(na){const e=(e,{url:t})=>t&&ra(e,t),t=browser.tabs.onUpdated,n=t.addListener.bind(t,e);try{n({properties:["url"]})}catch(e){n()}}browser.tabs.onCreated.addListener(e=>{const{id:t,title:n,url:r}=e;(!r.startsWith("file:")||Ts.firefox<68)&&/\.user\.js([?#]|$)/.test(js(e))&&Et.put(`autoclose:${t}`,!0,1e4),na&&"about:blank"===r&&ra(t,n)}),browser.webRequest.onBeforeRequest.addListener(e=>{const{method:t,tabId:n,url:r}=e;if("GET"===t)return r.startsWith(E)?{redirectUrl:ta(r)}:Et.has(`bypass:${r}`)||ea.test(r)&&!Qi.test(r)?void 0:(sa(n,r),T?{cancel:!0}:{redirectUrl:"javascript:void 0"})},{urls:["*://*/*.user.js","*://*/*.user.js?*","file://*/*.user.js","file://*/*.user.js?*",`${E}*.user.js`],types:["main_frame"]},["blocking"]);const oa={};function ia(e,t){const{id:n}=t.props,r=Ke(t,!0);return!r||!t.config.enabled&&Kt("updateEnabledScriptsOnly")||e.push(oa[n]||(oa[n]=aa(t,r))),e}async function aa(e,t){const{id:n}=e.props;let r,s,o,i;try{const{update:a}=await Ir({id:n,code:await ca(e,t),update:{checking:!1}});s=de("msgScriptUpdated",[He(a)]),i={cache:"no-cache"},r=!0}catch(e){o=e.error,i=!e.error&&!e.checking&&{}}finally{i&&(o=await Rr(e,null,i)),la(e)&&(s||o)&&(r={script:e,text:C(Qe,[s,o],"\n")}),delete oa[n]}return r}async function ca(e,t){let n;const{meta:r,props:{id:s}}=e,[o,i]=t,a={},c={update:a,where:{id:s}};l(de("msgCheckingForUpdate"));try{const{data:e}=await Ct(i,{cache:"no-cache",headers:{Accept:"text/x-userscript-meta,*/*"}})||{},{version:t}=e?an(e):{};if(ke(r.version,t)>=0)l(de("msgNoUpdate"),{checking:!1});else{if(o)return o===i&&null!=e&&e.replace(W,"").trim()?(l(de("msgUpdated")),e):(l(de("msgUpdating")),n=de("msgErrorFetchingScript"),(await Ct(o,{cache:"no-cache"})).data);l(de("msgNewVersion"),{checking:!1})}}catch(e){l(n||de("msgErrorFetchingUpdateInfo"),{error:e})}throw a;function l(e,{error:t,checking:n=!t}={}){k.assign(a,{message:e,checking:n,error:t?`${de("genericError")} ${t.status}, ${t.url}`:null}),ze("UpdateScript",c)}}function la(e){var t;const n=Kt("notifyUpdates");return Kt("notifyUpdatesGlobal")?n:null!=(t=e.config.notifyUpdates)?t:n}dt({async CheckUpdate(e){const t=e?[Xn(e)]:Qn(),n=await x.all(t.reduce(ia,[])),r=n.filter(e=>null==e?void 0:e.text);return r.length&&hr(de("msgOpenUpdateErrors"),r.map(e=>`* ${e.text}\n`).join(""),r.map(e=>e.script.props.id)),e||Jt("lastUpdate",Date.now()),n.reduce((e,t)=>e+(!0===t),0)}}),Yt(e=>{"autoUpdate"in e&&ha(),ze("UpdateOptions",e)}),dt({async GetData(e){const t=await fr(e);return t.sync=Hr(),t},GetSizes:gr,async GetTabDomain(){const e=await Ye()||{},t=js(e).match(/^https?:\/\/([^/]+)|$/)[1];return{tab:e,domain:t&&it(t)||t}}}),ut({SetTimeout:e=>e>0&&Ze(e)});const ua=["MarkRemoved","Move","ParseScript","RemoveScript","UpdateScriptInfo"],da=["CheckRemove","CheckUpdate"];async function pa({cmd:e,data:t}={},n){const r=M(lt,e)&&lt[e];if(!r)throw new U(`Unknown command: ${e}`);if(r.isOwn&&n&&!n.fake&&(n.origin?n.origin!==D:!`${n.url}`.startsWith(E)))throw new U(`Command is only allowed in extension context: ${e}`);try{const s=await r(t,n);return(ua.includes(e)||s&&da.includes(e))&&ss(),null!=s?s:null}catch(e){throw e instanceof U?e:new U(y(e)?JSON.stringify(e):e)}}function ha(){const e=(+Kt("autoUpdate")||0)*K;if(!e)return;let t=Date.now()-Kt("lastUpdate");t>=e&&(pa({cmd:"CheckUpdate"}),t=0),clearTimeout(ha.timer),ha.timer=setTimeout(ha,Math.min(2147483647,e-t))}(async t=>{await x.all(jt.map(At)),await At(()=>{var t;e.handleCommandMessage=pa,e.deepCopy=ie,P.runtime.onMessage.addListener(pa),setTimeout(ha,2e4),ns(),br(),setInterval(br,K),null==(t=S.declarativeContent)||t.onPageChanged.removeRules()}),await x.all(Lt.map(At)),jt.length=0,Lt.length=0})()}},z={};function q(e){var t=z[e];if(void 0!==t)return t.exports;var n=z[e]={exports:{}};return A[e](n,n.exports,q),n.exports}q.m=A,R=[],q.O=(e,t,n,r)=>{if(!t){var s=1/0;for(c=0;c<R.length;c++){for(var[t,n,r]=R[c],o=!0,i=0;i<t.length;i++)(!1&r||s>=r)&&k.keys(q.O).every(e=>q.O[e](t[i]))?t.splice(i--,1):(o=!1,r<s&&(s=r));if(o){R.splice(c--,1);var a=n();void 0!==a&&(e=a)}}return e}r=r||0;for(var c=R.length;c>0&&R[c-1][2]>r;c--)R[c]=R[c-1];R[c]=[t,n,r]},q.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return q.d(t,{a:t}),t},q.d=(e,t)=>{for(var n in t)q.o(t,n)&&!q.o(e,n)&&k.defineProperty(e,n,{enumerable:!0,get:t[n]})},q.o=(e,t)=>k.prototype.hasOwnProperty.call(e,t),(()=>{var e={798:0};q.O.j=t=>0===e[t];var t=(t,n)=>{var r,s,[o,i,a]=n,c=0;if(o.some(t=>0!==e[t])){for(r in i)q.o(i,r)&&(q.m[r]=i[r]);if(a)var l=a(q)}for(t&&t(n);c<o.length;c++)s=o[c],q.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return q.O(l)},n=self.webpackChunkviolentmonkey=self.webpackChunkviolentmonkey||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var N=q.O(void 0,[582],()=>q(3327));N=q.O(N)})()}