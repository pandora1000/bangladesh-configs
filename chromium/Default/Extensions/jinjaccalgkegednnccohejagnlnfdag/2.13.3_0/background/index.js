{const e=function(){return this||globalThis}(),{Boolean:t,Error:n,Object:r,Promise:o,document:s,window:i}=e,a=o,c=n,{hasOwnProperty:u,toString:l}={},d=r.call.bind(r.call),p=!e.chrome.app;(()=>{var h,f={2993:()=>{var t;if(p||null!=(t=e.browser)&&t.runtime);else{const{chrome:t,Proxy:n}=e,{apply:r,bind:o}=n,s="message",i="stack",p=e=>"addListener"===e||"removeListener"===e||"hasListener"===e||"hasListeners"===e,h=e=>"function"==typeof e,f=e=>"object"==typeof e,m=(e,t,n,r)=>{const s=n[t];if(void 0===s)return;let i;return i=h(r)?r(n,s):h(s)?0===r||p(t)||!d(u,n,t)?d(o,s,n):w(n,s):f(s)&&0!==r?g(s,r):s,e[t]=i,i},g=(e,t)=>new n({},{get:(n,r)=>{var o;return null!=(o=n[r])?o:m(n,r,e,null==t?void 0:t[r])}}),w=(e,n,o)=>(...u)=>{let l,p;const h=new a((e,t)=>{l=e,p=t}),f=new c(`callstack before invoking ${n.name||"chrome API"}:`);return u[u.length]=e=>{const n=t.runtime.lastError,r=n||(o?o(l,e):l(e));r&&(n||(f[i]=`${r[1]}\n${f[i]}`),f[s]=n?r[s]:`${r[0]}`,f.isRuntime=!!n,p(f))},d(r,n,e,u),h},y=e=>[e,null],b=e=>[null,null!=e&&e[s]?[e[s],e[i]]:[e,(new c)[i]]],v=async(e,t)=>{try{e=await e,t(y(e))}catch(e){t(b(e))}},k=(e,t,n,r)=>{try{const o=e(t,n);if(o&&"[object Promise]"===d(l,o))return v(o,r),!0;void 0!==o&&r(y(o))}catch(e){r(b(e))}},x=(e,t)=>(t?t[1]:"null response")||e(t[0]),$=(e,t)=>w(e,t,x);e.browser=g(t,{extension:0,i18n:0,runtime:{connect:0,getManifest:0,getURL:0,onMessage:{addListener:(e,t)=>n=>d(t,e,d(o,k,null,n))},sendMessage:$},tabs:{connect:0,sendMessage:$}})}},353:(a,l,h)=>{"use strict";h(2993);const f="auto",m="page",g="content",w={__proto__:null,[f]:[m,g],[m]:[m],[g]:[g]},y=/(?:^|\n)\s*\/\/\x20==UserScript==([\s\S]*?\n)\s*\/\/\x20==\/UserScript==|$/,b=/^(https?|file|ftps?):/,v="watchStorage",k="feedback",x="forceContent",$="more",S=e.browser,I=2147483647,U=36e5,_=864e5,C=6048e5,T=S.runtime.getURL("/"),R=T.slice(0,-1),M=`${T}public/images/icon`,D="blacklist",E=`${D}Errors`;function O(e,t){return S.i18n.getMessage(e,t)||e}function j(e,t){let n,r,o;function s(){r=null,performance.now()>=n?o():i()}function i(){if(!r){const e=n-performance.now();r=setTimeout(s,e)}}function a(...r){n=performance.now()+t,o=()=>{o=null,e.apply(this,r)},i()}return t=Math.max(0,+t||0),a}function A(){}function L(e="VM"){const t=performance.now();return e+Math.floor(1e12*(t-Math.floor(t)+1)).toString(36)+Math.floor(1e12*(Math.random()+1)).toString(36)}function z(e,t=0,n=1e99){const r=8192,o=[],s=e.length,i=Math.min(s||e.byteLength,t+n),a=null==s||t||i>r;for(;t<i;t+=r)o.push(String.fromCharCode.apply(null,a?new Uint8Array(e,t,Math.min(r,i-t)):e));return o.join("")}function q(e,t=0,n=1e99){return(t||n<e.size)&&(e=e.slice(t,t+n)),e.size?new o(t=>{const n=new FileReader;n.readAsDataURL(e),n.onload=()=>{const e=n.result;t(e.slice(e.indexOf(",")+1))}}):""}function N(e){const t=e.indexOf(","),n=e.slice(0,t);return e=decodeURIComponent(e.slice(t+1)),e=/(^|;)\s*base64\s*(;|$)/.test(n)?atob(e):e,/[\x80-\xFF]/.test(e)?(new TextDecoder).decode(P(e)):e}function P(e){const t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r+=1)n[r]=e.charCodeAt(r);return n}const H=/^(.*?)-([-.0-9a-z]+)|$/i,V=/^\d+$/;function W(e,t){const[,n=e||"",r]=H.exec(e),[,o=t||"",s]=H.exec(t),i=B(n,o)||!r-!s||r&&B(r,s,!0);return i<0?-1:+!!i}function B(e,t,n){const r=e.split("."),o=t.split("."),s=r.length,i=o.length,a=(n?Math.min:Math.max)(s,i);let c;for(let e=0;!c&&e<a;e+=1){const t=r[e],s=o[e];c=n?V.test(t)&&V.test(s)?t-s:t>s||t<s&&-1:(parseInt(t,10)||0)-(parseInt(s,10)||0)}return c||n&&s-i}function F(e){for(const t in e)if(d(u,e,t))return!1;return!0}function G(e){return Array.isArray(e)?e:[e]}const K=["blob","arraybuffer"];async function J(e,t={}){return new o((n,r)=>{const o=new XMLHttpRequest,s={headers:{get:e=>o.getResponseHeader(e)}},{responseType:i}=t;o.open("GET",e,!0),K.includes(i)&&(o.responseType=i),o.onload=()=>{if(s.status=o.status||200,s.data=K.includes(i)?o.response:o.responseText,"json"===i)try{s.data=JSON.parse(s.data)}catch(e){}s.status>300?r(s):n(s)},o.onerror=()=>{s.status=-1,r(s)},o.send()})}const X={"greasyfork.org":"application/javascript, text/plain, text/css"},Y=/^(file:\/\/|data:|https?:\/\/([^@/]*@)?(localhost|127\.0\.0\.1|(192\.168|172\.16|10\.0)\.\d+\.\d+|\[(::1|(fe80|fc00)::[.:0-9a-f]+)]|[^/:]+\.(test|example|invalid|localhost))(:\d+|\/|$))/i,Z=e=>/^data:/i.test(e),Q=e=>e&&!Y.test(decodeURI(e));async function ee(e,t={}){if(e.startsWith("file://"))return J(e,t);const{body:n,headers:o,responseType:s}=t,i=n&&"[object Object]"===d({}.toString,n),[,a,c,u,l]=e.match(/^([-\w]+:\/\/)([^@/]*@)?([^/]*)(.*)|$/),p=X[u],h=r.assign({cache:Q(e)?void 0:"no-cache"},t,{body:i?JSON.stringify(n):n,headers:i||p||c?r.assign({},o,i&&{"Content-Type":"application/json"},c&&{Authorization:`Basic ${btoa(decodeURIComponent(c.slice(0,-1)))}`},p&&{accept:p}):o}),f={url:e,status:-1};try{const t=c?a+u+l:e,n=await fetch(t,h),r={arraybuffer:"arrayBuffer",blob:"blob",json:"json"}[s]||"text";f.status=n.status||200,f.headers=n.headers,f.data=await n[r]()}catch(e){}if(f.status<0||f.status>300)throw f;return f}let te;function ne(e){return null==e?[]:Array.isArray(e)?e:`${e}`.split(".").filter(t)}function re(e,t){for(let n=0,r=ne(t);n<r.length;n++){const t=r[n];if(!e||"object"!=typeof e)break;e=e[t]}return e}function oe(e,t,n,r){t=ne(t);let o,s=e||{};for(let e=0;o=t[e],e<t.length-1;e+=1)s=s[o]||(s[o]={});return void 0===n?delete s[o]:s[o]=n,r?s:e}function se(e,t,n){const r={};for(let o=0;o<t.length;o++){const s=t[o];let i=null==e?void 0:e[s];n&&(i=n(i,s)),void 0!==i&&(r[s]=i)}return r}function ie(e,t,n){const o={};for(let s=0,i=r.keys(this);s<i.length;s++){let r=i[s];const a=this[r];t&&!(r=d(t,n,r,a,this))||(o[r]=e?d(e,n,a,r,this):a)}return o}function ae(e,t){this&&r.entries(this).forEach(e,t)}function ce(e,t){this&&r.keys(this).forEach(e,t)}function ue(e,t){this&&r.values(this).forEach(e,t)}function le(e){return e&&"object"==typeof e?Array.isArray(e)?Array.from(e,le):d(ie,e,le):e}function de(e,t){let n;if(e&&t&&typeof e==typeof t&&"object"==typeof e)if(Array.isArray(e))n=e.length===t.length&&e.every((e,n)=>de(e,t[n]));else{const o=r.keys(e);n=o.length===r.keys(t).length&&o.every(n=>de(e[n],t[n]))}else n=e===t;return n}function pe(e,t){if(e!==t)return e&&"object"==typeof e?t&&"object"==typeof t?(te=!1,e=he(e,t),te?e:void 0):le(e):e}function he(e,t){const n=Array.isArray(e),o=n?e:r.keys(e),s=n?t:r.keys(t),i=n?[]:{};o.length!==s.length&&(te=!0);for(let r,s,a,c=0;c<o.length;c+=1)r=n?c:o[c],s=e[r],a=t[r],s&&"object"==typeof s?a&&"object"==typeof a?s=he(s,a):(s=le(s),te=!0):s!==a&&(te=!0),i[r]=s;return i}function fe(e){return void 0===e?0:!0===e||null==e?4:!1===e?5:"string"==typeof e?e.length+2:"object"!=typeof e?`${e}`.length:Array.isArray(e)?e.reduce((e,t)=>e+1+fe(t),2):r.keys(e).reduce((t,n)=>t+n.length+4+fe(e[n]),2)}const me=`${M}128.png`,ge=/[#/?]/g,we=e=>String.fromCharCode(e.charCodeAt(0)-32+65280);function ye(){const e=[];function t(t){e.slice().forEach(e=>{e(t)})}function n(t){return e.push(t),()=>{const n=e.indexOf(t);n>=0&&e.splice(n,1)}}return{hook:n,fire:t}}function be(e,t,n){return xe({cmd:e,data:t},n)}const ve=()=>null==S.extension.getBackgroundPage?void 0:S.extension.getBackgroundPage();function ke(e,t,n,r){return S.tabs.sendMessage(e,{cmd:t,data:n},r).catch(A)}function xe(e,{retry:t}={}){if(t)return $e(e);let n=S.runtime.sendMessage(e);return i===ve()&&(n=n.catch(A)),n}async function $e(e,t=10){let r=10;for(;t>0;t-=1){try{const t=await xe(e);if(void 0!==t)return t}catch(e){if(!`${e}`.includes("Could not establish connection."))throw e}await De(r),r*=2}throw new n("Violentmonkey cannot connect to the background page.")}function Se(e,n){return navigator.languages.map(t=>e[`${n}:${t}`]||e[`${n}:${t.toLowerCase()}`]).find(t)||e[n]||""}function Ie({custom:e,meta:t}){let n=e.homepageURL||t.homepageURL||t.homepage||t.website||t.source;return n||(n=t.namespace,n=/^https?:\/\/(?!tampermonkey\.net\/)/.test(n)&&Te(n).replace(/^https?(:\/\/userscripts)(\.org\/users\/\w)/,"https$1-mirror$2")),n||""}function Ue(e){var t;return e.custom.name||Se(e.meta,"name")||`#${null!=(t=e.props.id)?t:O("labelNoName")}`}function _e(e,t){return`${T}${t&&p?"%20":""}${encodeURIComponent((t||Ue(e)).replace(ge,we))}.user.js#${e.props.id}`}function Ce(e,t){if(e.config.shouldUpdate){const{custom:n,meta:r}=e,o=n.downloadURL||r.downloadURL||n.lastInstallURL,s=n.updateURL||r.updateURL||o,i=o||s;if(i)return t?[o,s]:i}}function Te(e,t){let n;try{n=new URL(e,t)}catch(t){return`data:,${t.message} ${e}`}return["http:","https:","ftp:","data:"].includes(n.protocol)||(n.protocol="http:"),n.href}function Re(e){return e.replace(/[-\\/:*?"<>|%\s]/g,e=>{let t=e.charCodeAt(0).toString(16);return t.length<2&&(t=`0${t}`),`-${t}`})}async function Me(){return(await S.tabs.query({active:!0,currentWindow:!0}))[0]||(await S.tabs.query({active:!0,windowId:(await S.windows.getCurrent()).id}))[0]}function De(e){return e<0?o.resolve():new o(t=>setTimeout(t,e))}function Ee(e){return this.filter(t).join(e)}function Oe(e,t){if(Z(t))return t;if(/^(i,|image\/)/.test(e)){const t=e.lastIndexOf(",");return`data:${e.startsWith("image/")?e.slice(0,t):"image/png"};base64,${e.slice(t+1)}`}return e}async function je(e,t){const n=(e.headers.get("content-type")||"").split(";")[0]||"",r=await q(e.data);return t?[n,r]:`${n},${r}`}var Ae=h(3347),Le=h.n(Ae);function ze(){}function qe(e){return(...t)=>Le()&&Le()[e](...t)}function Ne(){return!!Le()}const Pe=qe("getDomain"),He=(qe("getSubdomain"),qe("getPublicSuffix"));function Ve(){return Ve=r.assign?r.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)r.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Ve.apply(this,arguments)}const We={},Be=r.assign.bind(r,We);function Fe(e){d(ae,e,([e,t])=>{We[e]=t,t.isOwn=!0})}async function Ge(e){const t=await browser.tabs.query({});let n=0;for(let r=0;r<t.length;r++)e(t[r]),n+=1,n%20==0&&await new o(setTimeout)}let Ke=browser.storage.local;class Je{constructor(e){this.name="",this.prefix=e}toKey(e){return this.prefix+e}toId(e){return e.startsWith(this.prefix)?e.slice(this.prefix.length):""}async getOne(e){const t=this.toKey(e);return(await Ke.get([t]))[t]}async getMulti(e,t){const n=null==e?void 0:e.map(this.toKey,this),r=await Ke.get(n);return t||this.prefix?d(ie,r,t,this.toId,this):r}async remove(e){const n=G(e).filter(t).map(this.toKey,this);n.length&&await Ke.remove(n)}async setOne(e,t){if(e)return this.set({[e]:t})}async set(e){return await Ke.set(this.prefix?d(ie,e,null,this.toKey,this):e),e}}const Xe="cac:",Ye="code:",Ze="mod:",Qe="req:",et="scr:",tt="val:",nt={get api(){return Ke},set api(e){Ke=e},forKey:e=>rt[/^\w+:|$/.exec(e)[0]],base:new Je(""),cache:new Je(Xe),code:new Je(Ye),mod:new Je(Ze),require:new Je(Qe),script:new Je(et),value:new Je(tt)},rt=d(ie,nt,null,(e,t)=>{if(t instanceof Je)return t.name=e,t.prefix}),ot=rt[Xe].name,st=rt[Ye].name,it=(rt[Ze].name,rt[Qe].name),at=(rt[et].name,rt[tt].name),ct=nt;function ut(e={}){const t={},{init:n,transform:r}=e;return function(...e){const[n]=e;return t[n]||(t[n]=d(o,this,...e))};async function o(...e){const[o,s]=e;try{const i=await lt(o,n?n(s):s);if(i){const t=r?await r(i,...e):i.data;await this.setOne(o,t)}}finally{delete t[o]}}}async function lt(e,t){if(Z(e))return;const n=await ct.mod.getOne(e);for(let r=0,o=[0,1];r<o.length;r++){const s=o[r];if(n||s){const r=await ee(e,s?t:Ve({},t,{method:"HEAD"})),{headers:o}=r,i=o.get("etag")||+new Date(o.get("last-modified"))||+new Date(o.get("date"));if(i&&i===n)return;if(s)return i?ct.mod.setOne(e,i):n&&ct.mod.remove(e),r}}}function dt({lifetime:e=3e3,onDispose:t}={}){let n,o,s,i=r.create(null),a=-1;const c=()=>o&&s||(s=performance.now()),u=1e3;return{batch:l,get:d,forEach:p,pop:h,put:f,del:m,has:g,hit:w,destroy:y};function l(e){o=e,s=0}function d(e,t,n=!0){const r=i[e];return r&&n&&b(r,r.lifetime),r?r.value:t}function p(e,t){for(const n in i){const r=i[n];r&&e.call(t,r.value,n)}}function h(e,t){const n=d(e,t);return m(e),n}function f(e,t,n){return b(i[e]=n?{value:t,lifetime:n}:{value:t},n),t}function m(e){const n=i[e];n&&(delete i[e],null==t||t(n.value,e))}function g(e){return i[e]}function w(e,t){const n=i[e];n&&b(n,t)}function y(){if(t)for(const e in i)m(e);else i=r.create(null);clearTimeout(n),n=0}function b(t,r=e){if(t.expiry=r+c(),n){if(r>=a)return;clearTimeout(n)}a=r,n=setTimeout(v,r+u)}function v(){const e=performance.now();let t=Number.MAX_SAFE_INTEGER;for(const n in i){const{expiry:r}=i[n];r<e?m(n):r<t&&(t=r)}a=t-e,n=t<Number.MAX_SAFE_INTEGER?setTimeout(v,a+u):0}}Fe({Storage:([e,t,...n])=>nt[e][t](...n)}),ct.cache.fetch=ut({init:e=>Ve({},e,{responseType:"blob"}),async transform(e,t,n,r){const[o,s]=await je(e,!0);return await(null==r?void 0:r(t,e.data,o)),`${o},${s}`}}),ct.require.fetch=ut({transform:({data:e},t)=>/^\s*</.test(e)?o.reject(`NOT_JS: ${t} "${e.slice(0,100).trim().replace(/\s{2,}/g," ")}"`):e}),ct.code.fetch=ut();const pt=dt({lifetime:3e5});Fe({CacheLoad:e=>pt.get(e)||null,CacheHit(e){pt.hit(e.key,e.lifetime)},CachePop:e=>pt.pop(e)||null});const ht=pt;function ft(){const e={};return{on:t,off:n,fire:r};function t(t,n){let r=e[t];r||(r=[],e[t]=r),r.push(n)}function n(t,n){const r=e[t];if(r){const e=r.indexOf(n);e>=0&&r.splice(e,1)}}function r(t,n){const r=e[t];r&&r.forEach(e=>{e(n,t)})}}const mt={isApplied:!0,autoUpdate:1,lastUpdate:0,lastModified:0,showBadge:"unique",badgeColor:"#880088",badgeColorBlocked:"#888888",exportValues:!0,exportNameTemplate:"[violentmonkey]_YYYY-MM-DD_HH.mm.ss",expose:{"greasyfork%2Eorg":!0,"sleazyfork%2Eorg":!1},closeAfterInstall:!1,trackLocalFile:!1,autoReload:!1,features:null,blacklist:null,syncScriptStatus:!0,sync:null,customCSS:"",importScriptData:!0,importSettings:!0,notifyUpdates:!1,notifyUpdatesGlobal:!1,version:null,defaultInjectInto:f,xhrInject:!1,filters:{searchScope:"name",showOrder:!1,sort:"exec",viewSingleColumn:!1,viewTable:!1},filtersPopup:{sort:"exec",enabledFirst:!1,hideDisabled:""},editor:{lineWrapping:!1,indentWithTabs:!1,indentUnit:2,tabSize:2,undoDepth:500},editorTheme:"",editorThemeName:null,editorWindow:!1,editorWindowPos:{},editorWindowSimple:!0,scriptTemplate:"// ==UserScript==\n// @name        New script {{name}}\n// @namespace   Violentmonkey Scripts\n// @match       {{url}}\n// @grant       none\n// @version     1.0\n// @author      -\n// @description {{date}}\n// ==/UserScript==\n",showAdvanced:!0,uiTheme:""},gt=[],wt=[];async function yt(e){const t=e=>"function"==typeof e?e():e;await o.all(gt.map(t)),await t(e),await o.all(wt.map(t)),gt.length=0,wt.length=0}let bt,vt,kt={};Fe({GetAllOptions:()=>We.GetOptions(mt),GetOptions:e=>d(ie,e,(e,t)=>Dt(t)),async SetOptions(e){vt&&await vt;for(let t=0,n=G(e);t<n.length;t++){const{key:e,value:r,reply:o}=n[t];Et(e,r,o)}bt&&Mt()}});const xt="options",$t="version",St="scriptTemplate",It="// ==UserScript==\n// @name New Script\n// @namespace Violentmonkey Scripts\n// @match {{url}}\n// @grant none\n// ==/UserScript==\n",Ut=100,_t=ye(),Ct=j(Mt,Ut),Tt=j(Ot,Ut);function Rt(e,t,n){bt?delete bt[e]:bt={},bt[e]=t,n||Ct()}function Mt(){const e=bt;bt=null,_t.fire(e)}function Dt(e,t){var n,r,o;const s=ne(e),i=s[0],a=null!=(n=null!=(r=kt[i])?r:le(mt[i]))?n:t;return s.length>1?null!=(o=re(a,s.slice(1)))?o:t:a}function Et(e,t,n){if(vt)return vt.then(()=>Et(...arguments));const r=ne(e),o=r[0];if(e=r.join("."),!d(u,mt,o))return;const s=r.length>1&&r.slice(1),i=Dt([o]);de(t,s?re(i,s):i)||(kt[o]=s?oe(i,s,t):t,jt(o),Tt(),Rt(e,t,n))}function Ot(){return ct.base.setOne(xt,kt)}function jt(e){return de(kt[e],mt[e])&&delete kt[e]}vt=ct.base.getOne(xt).then(e=>{e&&"object"==typeof e&&(kt=e),kt[$t]||Et($t,1),kt[St]===It&&(kt[St]=mt[St]),r.keys(kt).map(jt).some(t)&&(delete kt[`${St}Edited`],Tt()),vt=null}),gt.push(vt);const At=_t.hook;function Lt(e){return e.split("&").reduce((e,t)=>{const[n,r]=t.split("=").map(decodeURIComponent);return e[n]=r,e},{})}function zt(e){return r.entries(e).map(e=>e.map(encodeURIComponent).join("=")).join("&")}class qt{constructor(e){this.events={},this.allowed=e}checkType(e){if(this.allowed&&!this.allowed.includes(e))throw new n(`Unknown event type: ${e}`)}on(e,t){this.checkType(e);const{events:n}=this;let r=n[e];return r||(r=[],n[e]=r),()=>this.off(e,t)}off(e,t){this.checkType(e);const n=this.events[e];if(n){const e=n.indexOf(t);e>=0&&n.splice(e,1)}}emit(e,t){this.checkType(e);const n=this.events[e];if(n){const r={type:e,data:t,defaultPrevented:!1,preventDefault(){r.defaultPrevented=!0}};n.some(e=>(e(r),r.defaultPrevented))}}}const Nt=new qt(["scriptEdit","scriptChanged"]);function Pt(e){return!(/^\s*</.test(e)||e.indexOf("// ==UserScript==")<0)}Fe({CacheNewScript(e){const t=L();return ht.put(`new-${t}`,Jt(e)),t},NewScript:e=>e&&ht.get(`new-${e}`)||Jt()});const Ht={default:()=>[],transform:(e,t)=>(e.push(t),e)},Vt={default:()=>!1,transform:()=>!0},Wt={default:()=>null,transform:(e,t)=>null==e?t:e},Bt={include:Ht,exclude:Ht,match:Ht,excludeMatch:Ht,require:Ht,resource:{default:()=>({}),transform:(e,t)=>{const n=t.match(/^(\w\S*)\s+(.*)/);return n&&(e[n[1]]=n[2]),e}},grant:Ht},Ft={antifeature:Ht,compatible:Ht,connect:Ht,noframes:Vt,unwrap:Vt};function Gt(e){const t=d(ie,Bt,e=>e.default());return(e.match(y)[1]||"").replace(/(?:^|\n)\s*\/\/\x20(@\S+)(.*)/g,(e,n,r)=>{const[o,s]=n.slice(1).split(":"),i=o.replace(/[-_](\w)/g,(e,t)=>t.toUpperCase()),a=s?`${i}:${s.toLowerCase()}`:i,c=r.trim(),u=Bt[a]||Ft[a]||Wt;let l=t[a];void 0===l&&(l=u.default()),t[a]=u.transform(l,c)}),t.resources=t.resource,delete t.resource,t}function Kt(){return{origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0}}function Jt(e){const t=Ve({url:"*://*/*",name:"",date:(new Date).toLocaleString()},e),n=Dt("scriptTemplate").replace(/{{(\w+)}}/g,(e,n)=>{const r=t[n];return null==r?e:r});return{script:{custom:Kt(),config:{enabled:1,shouldUpdate:1},meta:Gt(n),props:{}},code:n}}function Xt(e){const t=e.meta.namespace||"",n=e.meta.name||"";let r=Re(`${t}\n${n}\n`);return t||n||(r+=e.props.id||""),r}Fe({TestBlacklist:Rn});const Yt={test:()=>1},Zt=dt({lifetime:36e5}),Qt=dt({lifetime:36e5}),en=dt({lifetime:6e4}),tn=dt({lifetime:6e4}),nn=/^(\*|http([s*])?|file|ftp|urn):\/\/([^/]*)\/(.*)/,rn=/^(\*|http([s*])?|file|ftp|urn|([^:]*?)(?=:))(:(?:\/(?:\/)?)?)?([^/]*)(?:\/(.*))?/,on=/^([^:]*):\/\/([^/]*)\/(.*)/,sn="(?:|[^:/]*?\\.)",an="(|(?:\\.[-\\w]+)+)",cn=1e5;let un,ln,dn,pn,hn,fn,mn,gn={},wn=0,yn=[];wt.push(Mn),At(e=>{if(D in e){const t=Mn(e[D]||[]),n=t.length?t:null;if(ct.base.setOne(E,n),n)throw n}}),ze(!0);class bn{constructor(e,t,n,r,o){const s="*"===t||"*"===n;this.scheme=s?"http":t,this.scheme2=s?"https":null,this.host="*"===r?null:Cn(r),this.path="*"===o?null:Tn(o)}test(){var e,t;return(this.scheme===dn||this.scheme2===dn)&&!1!==(null==(e=this.host)?void 0:e.test(pn))&&!1!==(null==(t=this.path)?void 0:t.test(hn))}static try(e){const t=e.match(nn);if(t)return new bn(...t);if("<all_urls>"===e)return Yt;throw`Bad pattern: ${bn.fail(e)} in ${e}`}static fail(e){const t=e.match(rn);return((null!=t[3]?(t[3]?"unknown":"missing")+" scheme, ":"")+("://"!==t[4]?'missing "://", ':"")||(null==t[6]?'missing "/" for path, ':"")).slice(0,-2)}}class vn{constructor(e,t,n){this.s=n?e.toLowerCase():e,this.i=!!n,this.cmp=t<0?"":t?"startsWith":"endsWith"}test(e){const{s:t,cmp:n}=this,r=e.length-t.length;return r>=0&&(n&&r?e[n](t)||this.i&&e.toLowerCase()[n](t):e===t||!r&&this.i&&e.toLowerCase()===t)}static try(e,t){const n=e.indexOf("*");if(n===e.length-1)e=e.slice(0,-1);else if(0===n&&e.indexOf("*",1)<0)e=e.slice(1);else if(n>=0)return;return new vn(e,n,t)}}function kn(e){Zt.batch(e),Qt.batch(e),en.batch(e),tn.batch(e),un=Array.isArray(e)&&e}function xn(e){ln=e,[,dn,pn,hn]=e?e.match(on):["","","",""],fn=e?en.get(e)||en.put(e,{}):null,mn=e?tn.get(e)||tn.put(e,{}):null}function $n(e,t){let n,r,o,s;const{custom:i,meta:a}=t;return(!((n=i.origMatch&&a.match||"").length+(r=i.match||"").length+(o=i.origInclude&&a.include||"").length+(s=i.include||"").length)||Sn(e,t,n,r,o,s))&&!((n=i.origExcludeMatch&&a.excludeMatch||"").length+(r=i.excludeMatch||"").length+(o=i.origExclude&&a.exclude||"").length+(s=i.exclude||"").length&&Sn(e,t,n,r,o,s))}function Sn(e,t,...n){ln!==e&&xn(e);for(let r,o,s,i,a,c,u,l,d=0;d<4;d+=1){if((o=n[d]).length){i||(d<2?(s=bn.try,i=Zt,a=fn):(s=Un,i=Qt,a=mn));for(let n=0,d=o;n<d.length;n++){const o=d[n];if(e&&(c=a[o]))return c;if(null==c){if(!(r=i.get(o))){try{r=s(o)}catch(e){r={err:e}}i.put(o,r)}if(u=r.err)un&&(u=u.message||u,u=e?`${u} - ${l||(l=_e(t))}`:u,un.push(u));else if(e&&(a[o]=+!!r.test(e)))return!0}}}1===d&&(i=!1)}}function In(e){return e.replace(/[.?+[\]{}()|^$]/g,"\\$&").replace(/\*/g,".*?")}function Un(e){if(e.length>1&&"/"===e[0]&&"/"===e[e.length-1])return new RegExp(e.slice(1,-1),"i");const t=e.includes(".tld/"),n=!t&&vn.try(e,!0);if(n)return n;const r=`^${In(e)}$`,o=t?r.replace("\\.tld/","((?:\\.[-\\w]+)+)/"):r,s=RegExp(o,"i");return r!==o&&(s.test=_n),s}function _n(e){var t;const n=e.match(this),r=null==n||null==(t=n[1])?void 0:t.slice(1).toLowerCase();return!!r&&He(r)===r}function Cn(e){const t=e.endsWith(".tld")&&Ne();let n,r="",o=e,s="";if(e.startsWith("*."))o=o.slice(2),r=sn;else if(!t&&(n=vn.try(e,!0)))return n;t&&(o=o.slice(0,-4),s=an);const i=RegExp(`^${r}${In(o)}${s}$`,"i");return t&&(i.test=_n),i}function Tn(e){const t=e.indexOf("?"),n=e.indexOf("#",t+1)>=0;return n&&vn.try(e)||RegExp(`^${In(e)}${n?"$":`($|${t>=0?"#":"[?#]"})`}`)}function Rn(e){let t=gn[e];if(void 0===t){ln!==e&&xn(e);const n=yn.find(t=>t.test(e));t=(null==n?void 0:n.reject)&&n.text,Dn(e,t||!1)}return t}function Mn(e=Dt(D)){const t=(e,t,n)=>e.get(t)||e.put(t,n(t)),n=[];return kn(!0),yn=(Array.isArray(e)?e:(e||"").split("\n")).reduce((e,r)=>{try{if(!(r=r.trim())||r.startsWith("#"))return e;const n=r.startsWith("@")&&r.split(/\s/,1)[0],o=n?r.slice(n.length+1).trim():r,s="@include"===n,i=(s||"@exclude"===n)&&t(Qt,o,Un)||!n&&!o.includes("/")&&t(Zt,`*://${o}/*`,bn.try)||t(Zt,o,bn.try);i.reject=!("@match"===n||s),i.text=r,e.push(i)}catch(e){n.push(e)}return e},[]),gn={},wn=0,kn(),n}function Dn(e,t){if(gn[e]=t,wn+=e.length,wn>cn)for(const e in gn)if(delete gn[e]&&(wn-=e.length)<.75*cn)return}const En=()=>new o((e,t)=>{function n(){const e=indexedDB.open("Violentmonkey",1);e.onsuccess=()=>{try{o(e.result)}catch(e){t(e)}},e.onerror=t,e.onupgradeneeded=()=>{t()}}function o(n){const r=n.transaction(["scripts","require","cache","values"]),o={};let i=3;const a=()=>{i-=1,i||e(ct.base.set(o))},c=(e,n)=>{const o=r.objectStore(e).getAll();o.onsuccess=()=>n(o.result),o.onerror=t};c("scripts",e=>{const t={};e.forEach(e=>{const{code:n,id:r,uri:i}=e;o[ct.script.toKey(r)]=s(e),o[ct.code.toKey(r)]=n,t[i]=r}),c("values",e=>{e.forEach(({uri:e,values:n})=>{const r=t[e];r&&(o[ct.value.toKey(r)]=n)}),a()})}),c("cache",e=>{e.forEach(({uri:e,data:t})=>{o[ct.cache.toKey(e)]=t}),a()}),c("require",e=>{e.forEach(({uri:e,code:t})=>{o[ct.require.toKey(e)]=t}),a()})}function s(e){return{meta:Gt(e.code),custom:r.assign({origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},e.custom),props:{id:e.id,uri:e.uri,position:e.position},config:{enabled:e.enabled,shouldUpdate:e.update}}}console.info("Upgrade database..."),n()}).catch(()=>{}),On={scripts:[],scriptMap:{},sizes:{},sizesPrefixRe:RegExp(`^(${Ye}|${et}|${tt}|${Qe}|${Xe}${Ze})`),storeInfo:{id:0,position:0}};function jn(e){return+e||0}function An(e){return null==e?void 0:e.props.id}function Ln(){Et("lastModified",Date.now())}async function zn(){const e=On.scripts.reduce((e,t,n)=>{const{props:r}=t,o=n+1;return r.position!==o&&(r.position=o,(e||(e={}))[r.id]=t),e},null);return On.storeInfo.position=On.scripts.length,e&&(await ct.script.set(e),Ln()),!!e}async function qn(){On.scripts.sort((e,t)=>jn(e.props.position)-jn(t.props.position));const e=await zn();return be("ScriptsUpdated",null),e}function Nn(e){return On.scriptMap[e]}function Pn({id:e,uri:t,meta:n}){let r;return e?r=Nn(e):(t||(t=Xt({meta:n,id:"@@should-have-name"})),r=On.scripts.find(({props:e})=>t===e.uri)),r}function Hn(){return On.scripts.filter(e=>!e.config.removed)}Fe({CheckPosition:qn,CheckRemove:ar,GetScript:Pn,async ExportZip({values:e}){const t=Hn(),n=t.map(An),r=await ct.code.getMulti(n);return{items:t.map(e=>({script:e,code:r[e.props.id]})),values:e?await ct.value.getMulti(n):void 0}},GetScriptCode:e=>ct.code[Array.isArray(e)?"getMulti":"getOne"](e),GetScriptVer(e){const t=Pn(e);return t&&!t.config.removed?t.meta.version:null},MarkRemoved:({id:e,removed:t})=>lr(e,{config:{removed:t?1:0},props:{lastModified:Date.now()}}),Move({id:e,offset:t}){const n=Nn(e),r=On.scripts.indexOf(n);return On.scripts.splice(r,1),On.scripts.splice(r+t,0,n),zn()},async RemoveScript(e){const t=On.scripts.indexOf(Nn(e));return t>=0&&(On.scripts.splice(t,1),await ct.base.remove([ct.script.toKey(e),ct.code.toKey(e),ct.value.toKey(e)])),be("RemoveScript",e)},ParseMeta:dr,ParseScript:pr,UpdateScriptInfo:({id:e,config:t,custom:n})=>lr(e,{config:t,custom:n,props:{lastModified:Date.now()}}),Vacuum:yr}),gt.push(async()=>{var e;const t=await ct.base.getOne("version"),n="2.13.3";t||await En(),n!==t&&ct.base.set({version:n});const r=await ct.base.getMulti(),{scripts:o,storeInfo:s,scriptMap:i}=On,a={};d(ae,r,([e,t])=>{const n=+ct.script.toId(e);if(n&&t){if(i[n]&&i[n]!==t)return;const e=Xt(t);if(a[e])return;a[e]=t,t.props=Ve({},t.props,{id:n,uri:e}),t.custom=Ve({},Kt(),t.custom),s.id=Math.max(s.id,n),s.position=Math.max(s.position,jn(t.props.position)),o.push(t);const{meta:r=(t.meta={})}=t;r.require||(r.require=[]),r.resources||(r.resources={}),r.grant=[...new Set(r.grant||[])]}}),n!==t&&p&&(null==(e=r.options)?void 0:e.defaultInjectInto)===m&&W(t,"2.12.7")<=0&&Et("defaultInjectInto",f),qn(),yr(r)});const Vn="cacheKeys",Wn="reqKeys",Bn="scripts",Fn="valueIds",Gn=/^GM[_.](listValues|([gs]et|delete)Value)$/,Kn=/^document-(start|body|end|idle)$/,Jn={[ot]:Vn,[st]:"ids",[it]:Wn,[at]:Fn},Xn=r.entries(Jn),Yn=new Set;function Zn(e,t,n){kn(n||!0);const r=Rn(e)?[]:On.scripts.filter(n=>{var r;return!n.config.removed&&(t||!(null!=(r=n.custom.noframes)?r:n.meta.noframes))&&$n(e,n)});return kn(),Qn(r)}async function Qn(e){const t=[],[n,o]=[0,1].map(()=>({depsMap:{},[Bn]:[]}));for(let e=0;e<Xn.length;e++){const[t,r]=Xn[e];n[t]={},o[t]={},n[r]=[],o[r]=[]}return e.forEach(e=>{var s;const{id:i}=e.props;if(!e.config.enabled)return void t.push(i);const{meta:a,custom:c}=e,{pathMap:u=hr(e)}=c,l=(null==(s=`${c.runAt||a.runAt||""}`.match(Kn))?void 0:s[1])||"end",d="start"===l||"body"===l?n:o,{depsMap:p}=d;d.ids.push(i),a.grant.some(Gn.test,Gn)&&d[Fn].push(i);for(let e=0,t=[[a.require,it,N],[r.values(a.resources),ot]];e<t.length;e++){const[r,o,s]=t[e],a=Jn[o],c=o===ot?n:d;for(let e=0;e<r.length;e++){let t=r[e];t=u[t]||t,t&&(Z(t)?s&&(d[o][t]=s(t)):c[a].includes(t)||(d[a].push(t),(p[t]||(p[t]=[])).push(i)))}}d[Bn].push(Ve({},e,{runAt:l}))}),n.ids.length&&r.assign(n,await er(n)),o.ids.length&&(o.promise=De().then(()=>er(o))),r.assign(n,{disabledIds:t,envDelayed:o})}async function er(e){const t=[];for(let n=0;n<Xn.length;n++){const[r,o]=Xn[n];for(let n=0,s=e[o];n<s.length;n++){const e=s[n];t.push(ct[r].toKey(e))}}const n=await ct.base.getMulti(t),r=new Set;for(let t=0;t<Xn.length;t++){const[s,i]=Xn[t];for(let t=0,a=e[i];t<a.length;t++){const i=a[t];let c=n[ct[s].toKey(i)];var o;c||s!==at||(c={}),e[s][i]=c,null==c&&(s===st?r.add(i):null==(o=e.depsMap[i])||o.forEach(e=>r.add(e)))}}return r.size&&tr(r),e}function tr(e){const t=[],n=O("msgMissingResources");let r,o=O("msgReinstallScripts"),s=o;e.forEach(e=>{r=`\n#${e}: ${Ue(Nn(e))}`,o+=r,Yn.has(e)||(Yn.add(e),t.push(e),s+=r)}),console.error(`${n} ${o}`),t.length&&We.Notification({title:n,text:s},void 0,{onClick(){t.forEach(e=>We.OpenEditor(e))}})}async function nr({ids:e,sizes:t}){const n=e?e.map(Nn):On.scripts;return{scripts:n,cache:await rr(n),sizes:t&&or(e)}}async function rr(e){const t=[];for(let n=0;n<e.length;n++){const{custom:r,meta:{icon:o}}=e[n];Q(o)&&t.push(r.pathMap[o]||o)}const n=`${M}38.png`,[r,s]=await o.all([ct.cache.getMulti(t,Oe),We.GetImageData(n)]);return r[n]=s,r}function or(e){const t=e?e.map(Nn):On.scripts;return t.map(({meta:e,custom:{pathMap:n={}},props:{id:o}},s)=>[On.sizes[Ye+o]||0,fe(t[s]),On.sizes[tt+o]||0,e.require.reduce(sr,{len:0,pathMap:n}).len,r.values(e.resources).reduce(ir,{len:0,pathMap:n}).len])}function sr(e,t){return e.len+=(On.sizes[Qe+(e.pathMap[t]||t)]||0)+t.length,e}function ir(e,t){return e.len+=(On.sizes[Xe+(e.pathMap[t]||t)]||0)+t.length,e}function ar({force:e}={}){const t=Date.now(),n=[],r=[];if(On.scripts.forEach(o=>{const{id:s,lastModified:i}=o.props;o.config.removed&&(e||t-jn(i)>C)?r.push(ct.code.toKey(s),ct.script.toKey(s),ct.value.toKey(s)):n.push(o)}),r.length)return On.scripts=n,ct.base.remove(r)}function cr(){const e=new Uint16Array(8);return i.crypto.getRandomValues(e),e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768,"01-2-3-4-567".replace(/\d/g,t=>(e[t]+65536).toString(16).slice(-4))}async function ur(e,t){const n=e.config||{};n.enabled=jn(n.enabled),n.shouldUpdate=jn(n.shouldUpdate);const r=e.props||{};let o;if(r.id?o=On.scriptMap[r.id]:(On.storeInfo.id+=1,r.id=On.storeInfo.id),r.uri=Xt(e),r.uuid=r.uuid||(null==crypto.randomUUID?void 0:crypto.randomUUID())||cr(),On.scripts.some(({props:{id:e,uri:t}={}})=>r.id!==e&&r.uri===t))throw O("msgNamespaceConflict");if(o){e.config=Ve({},o.config,n),e.props=Ve({},o.props,r);const t=On.scripts.indexOf(o);On.scripts[t]=e}else r.position?On.storeInfo.position<r.position&&(On.storeInfo.position=r.position):(On.storeInfo.position+=1,r.position=On.storeInfo.position),e.config=n,e.props=r,On.scripts.push(e);return ct.base.set({[ct.script.toKey(r.id)]:e,[ct.code.toKey(r.id)]:t})}async function lr(e,t){const n=On.scriptMap[e];if(!n)throw null;return n.props=Ve({},n.props,t.props),n.config=Ve({},n.config,t.config),n.custom=Ve({},n.custom,t.custom),await ct.script.setOne(e,n),be("UpdateScript",{where:{id:e},update:n})}function dr(e){const t="object"==typeof e,n=t&&e.custom||Kt(),r=Gt(t?e.code:e),o=[];return kn(o),$n("",{meta:r,custom:n}),kn(),{meta:r,errors:o.length?o:null}}async function pr(e){const{meta:t,errors:n}=dr(e);if(!t.name)throw`${O("msgInvalidScript")}\n${O("labelNoName")}`;const o={errors:n,update:{message:null==e.message?O("msgUpdated"):e.message||""}};let s;const i=await Pn({id:e.id,meta:t});if(i){if(e.isNew)throw O("msgNamespaceConflict");s=Ve({},i)}else({script:s}=Jt()),o.isNew=!0,o.update.message=O("msgInstalled");return s.config=Ve({},s.config,e.config,{removed:0}),s.custom=Ve({},s.custom,e.custom),s.props=Ve({},s.props,{lastModified:Date.now(),lastUpdated:Date.now()},e.props),s.meta=t,!Ie(s)&&Q(e.from)&&(s.custom.homepageURL=e.from),Q(e.url)&&(s.custom.lastInstallURL=e.url),e.position&&(s.props.position=+e.position),hr(s,e.url),await ur(s,e.code),fr(s,e),r.assign(o.update,s,e.update),o.where={id:s.props.id},be("UpdateScript",o),Nt.emit("scriptChanged",o),o}function hr(e,t){const{meta:n}=e,o=t||e.custom.lastInstallURL,s=o?[...n.require,...r.values(n.resources),n.icon].reduce((e,t)=>{if(t){const n=Te(t,o);n!==t&&(e[t]=n)}return e},{}):{};return e.custom.pathMap=s,s}async function fr(e,t,n){const{custom:{pathMap:s},meta:i}=e,a=(e,r,o)=>{var i;if(!e||Z(e))return;e=s[e]||e;const a=null==t||null==(i=t[r])?void 0:i[e];return null==a||o?ct[r].fetch(e,n,o).catch(e=>e):ct[r].setOne(e,a)&&null},c=await o.all([...i.require.map(e=>a(e,it)),...r.values(i.resources).map(e=>a(e,ot)),Q(i.icon)&&a(i.icon,ot,mr)]);if(null==t||!t.ignoreDepsErrors){const t=d(Ee,c.map(gr),"\n");if(t){const n=O("msgErrorFetchingResource");return be("UpdateScript",{update:{error:t,message:n},where:{id:e.props.id}}),`${n}\n${t}`}}}function mr(e,t,n){return new o((r,o)=>{const s=URL.createObjectURL(new Blob([t],{type:n})),i=t=>{URL.revokeObjectURL(s),"load"===t.type?r():o(`IMAGE_ERROR: ${e}`)},a=new Image;a.onload=i,a.onerror=i,a.src=s})}function gr(e){return e&&d(Ee,[e.status&&`HTTP${e.status}`,e.url]," ")||e}let wr;async function yr(e){if(wr)return wr;let n;wr=new o(e=>{n=e});const r=e&&[],s={},i={},a=[],c=[],u={},l=RegExp(`^(${[tt,Xe,Qe,Ye,Ze].join("|")})`),p=[tt,Ze],h={},f=(t,n,r,o)=>{if(!n||o&&Z(n))return 0;const i=t+((null==o?void 0:o[n])||n),a=u[i];a<0?(u[i]=1,n!==r&&(u[Ze+n]=1),t!==Ze&&(s[i]=fe(e[i])+(t===tt?0:i.length))):a||p.includes(t)||(u[i]=2+r)};return e||(e=await ct.base.getMulti()),d(ce,e,e=>{l.test(e)&&(u[e]=-1)}),On.sizes=s,On.scripts.forEach(e=>{const{meta:t,props:n}=e,{icon:r}=t,{id:o}=n,s=e.custom.pathMap||hr(e),i=Ce(e,!0);i&&(i.forEach(e=>f(Ze,e,o)),h[o]=i[0]),f(Ye,o,o),f(tt,o,o),t.require.forEach(e=>f(Qe,e,o,s)),d(ue,t.resources,e=>f(Xe,e,o,s)),Q(r)&&f(Xe,r,o,s)}),d(ae,u,([e,t])=>{if(t<0)c.push(e);else if(t>=2){const n=ct.forKey(e),o=n.toId(e),s=n.name===st?h[o]:o;r?r.push(s||+o&&_e(Nn(o))||e):s&&n.fetch&&(c.push(Ze+s),a.push(n.fetch(s).catch(e=>`${Ue(Nn(+o||t-2))}: ${gr(e)}`)))}}),c.length&&(await ct.base.remove(c),i.errors=(await o.all(a)).filter(t)),r&&r.length&&console.warn("Missing required resources. Try vacuuming database in options.",r),wr=null,i.fixes=a.length+c.length,n(i),i}const br={update:We.ParseScript,list:async()=>Hn(),get:We.GetScriptCode,remove:e=>We.MarkRemoved({id:e,removed:!0})},vr=[],kr=[],xr={},$r=j(Br,U);let Sr,Ir=o.resolve();function Ur({name:e,uri:t}){return e||`vm@2-${t}`}function _r(e){return/^vm(?:@\d+)?-/.test(e)}function Cr(e){const t=e.indexOf("-"),[,n]=e.slice(0,t).split("@");if("2"===n)return e.slice(t+1);try{return decodeURIComponent(e.slice(3))}catch(t){return e.slice(3)}}function Tr(){function e(e,t){const n=ne(e);return n.unshift("sync"),Dt(n,t)}function t(e,t){const n=ne(e);n.unshift("sync"),Et(n,t)}function n(){let e=Dt("sync");e&&e.services||(e={services:{}},t([],e))}return n(),{get:e,set:t}}function Rr(e){function t(t){const n=ne(t);return n.unshift("services",e),n}function n(e,n){return Sr.get(t(e),n)}function r(e,n){"object"==typeof e?d(ae,e,([e,n])=>{Sr.set(t(e),n)}):Sr.set(t(e),n)}function o(){Sr.set(t(),{})}return{get:n,set:r,clear:o}}function Mr(e,t,n){let r=t||e[0];function o(){return r}function s(t){return e.includes(t)?(r=t,n&&n()):console.warn("Invalid state:",t),o()}function i(e){return G(e).includes(r)}return{get:o,set:s,is:i}}function Dr(){return vr.map(e=>{const t=xr[e];return{name:t.name,displayName:t.displayName,authState:t.authState.get(),syncState:t.syncState.get(),lastSync:t.config.get("meta",{}).lastSync,progress:t.progress,properties:t.properties,userConfig:t.getUserConfig()}})}function Er(e,t,n){let o;return 2===t?o={version:t,custom:e.custom,config:e.config,props:se(e.props,["lastUpdated"])}:1===t&&(o={version:t,more:{custom:e.custom,enabled:e.config.enabled,update:e.config.shouldUpdate,lastUpdated:e.props.lastUpdated}}),r.assign(o,n)}function Or(e){const t={};try{const n=JSON.parse(e);t.code=n.code,2===n.version?(t.config=n.config,t.custom=n.custom,t.props=n.props):1===n.version&&n.more&&(t.custom=n.more.custom,t.config=jr({enabled:n.more.enabled,shouldUpdate:n.more.update}),t.props=jr({lastUpdated:n.more.lastUpdated}))}catch(n){t.code=e}return t}function jr(e){return Array.isArray(e)?e.forEach(jr):e&&"object"==typeof e&&d(ae,e,([t,n])=>{void 0===n?delete e[t]:jr(n)}),e}function Ar(e){const t=function(){this.initialize()};return t.prototype=e,t.extend=Lr,t}function Lr(e){return Ar(r.assign(r.create(this.prototype),e))}const zr=j(()=>{be("UpdateSync",Dr())}),qr=Ar({name:"base",displayName:"BaseService",delayTime:1e3,urlPrefix:"",metaFile:"Violentmonkey",properties:{authType:"oauth"},getUserConfig:A,setUserConfig:A,initialize(){this.progress={finished:0,total:0},this.config=Rr(this.name),this.authState=Mr(["idle","no-auth","initializing","authorizing","authorized","unauthorized","error"],null,zr),this.syncState=Mr(["idle","ready","syncing","error"],null,zr),this.lastFetch=o.resolve(),this.startSync=this.syncFactory();const e=ft();["on","off","fire"].forEach(t=>{this[t]=(...n)=>{e[t](...n)}})},log(...e){console.log(...e)},syncFactory(){let e,t;const n=()=>this.authState.is("authorized")&&Pr()===this.name,r=()=>{if(!n())return o.resolve();this.log("Ready to sync:",this.displayName),this.syncState.set("ready"),Ir=Ir.then(()=>new o(e=>{t=j(e,1e4),t()})).then(()=>{if(n())return this.sync();this.syncState.set("idle")}).catch(e=>{console.error(e)}).then(()=>{e=null,t=null}),e=Ir};function s(){return e||r(),t&&t(),e}return s},prepareHeaders(){this.headers={}},prepare(){return this.authState.set("initializing"),(this.initToken()?o.resolve(this.user()):o.reject({type:"no-auth"})).then(()=>{this.authState.set("authorized")},e=>{throw["no-auth","unauthorized"].includes(null==e?void 0:e.type)?this.authState.set(e.type):(console.error(e),this.authState.set("error")),this.syncState.set("idle"),e})},checkSync(){return this.prepare().then(()=>this.startSync())},user:A,acquireLock:A,releaseLock:A,handleMetaError(e){throw e},getMeta(){return this.get({name:this.metaFile}).then(e=>JSON.parse(e)).catch(e=>this.handleMetaError(e)).then(e=>({name:this.metaFile,data:e}))},initToken(){this.prepareHeaders();const e=this.config.get("token");return this.headers.Authorization=e?`Bearer ${e}`:null,!!e},loadData(e){const{progress:t}=this,{delay:n=this.delayTime}=e;let s=o.resolve();return n&&(s=this.lastFetch.then(e=>De(n-(Date.now()-e))).then(()=>Date.now()),this.lastFetch=s),t.total+=1,zr(),s.then(()=>{var t;(e=r.assign({},e)).headers=r.assign({},this.headers,e.headers);let{url:n}=e;return n.startsWith("/")&&(n=(null!=(t=e.prefix)?t:this.urlPrefix)+n),ee(n,e)}).then(({data:e})=>({data:e}),e=>({error:e})).then(({data:e,error:n})=>(t.finished+=1,zr(),n?o.reject(n):e))},getLocalData:()=>br.list(),getSyncData(){return this.getMeta().then(e=>o.all([e,this.list(),this.getLocalData()]))},sync(){return this.progress={finished:0,total:0},this.syncState.set("syncing"),this.prepare().then(()=>this.getSyncData()).then(e=>o.resolve(this.acquireLock()).then(()=>e)).then(([e,n,s])=>{const i=e.data||{},a=i.info||{},c=i.timestamp||0;let u=!c||r.keys(a).length!==n.length;const l=Date.now(),p=Dt("lastModified"),h={},f=this.config.get("meta",{}),m=!f.timestamp,g=m||c>f.timestamp;this.log("First sync:",m),this.log("Outdated:",g,"(","local:",f.timestamp,"remote:",c,")");const w=[],y=[],b=[],v=[],k=[];i.info=n.reduce((e,t)=>{h[t.uri]=t;let n=a[t.uri];return n||(n={},u=!0),e[t.uri]=n,n.modified||(n.modified=l,u=!0),e},{}),s.forEach(e=>{const{props:{uri:t,position:n,lastModified:r}}=e,o=i.info[t],s=h[t];o&&s?(m||!r||o.modified>r?w.push({local:e,remote:s,info:o}):(o.modified<r&&(y.push({local:e,remote:s}),o.modified=r,u=!0),o.position!==n&&(o.position&&p<=c?k.push({local:e,remote:s,info:o}):(o.position=n,u=!0))),delete h[t]):m||!g||r>c?y.push({local:e}):v.push({local:e})}),d(ae,h,([e,t])=>{const n=i.info[e];g?w.push({remote:t,info:n}):b.push({remote:t})});const x=[...w.map(({remote:e,info:t})=>(this.log("Download script:",e.uri),this.get(e).then(e=>{const n=Or(e);if(!n.code)return;t.modified&&oe(n,"props.lastModified",t.modified);const r=+t.position;return r&&(n.position=r),!Dt("syncScriptStatus")&&n.config&&delete n.config.enabled,br.update(n)}))),...y.map(({local:e,remote:t})=>(this.log("Upload script:",e.props.uri),br.get(e.props.id).then(n=>{const o=Er(e,1,{code:n});return i.info[e.props.uri]={modified:e.props.lastModified,position:e.props.position},u=!0,this.put(r.assign({},t,{uri:e.props.uri,name:null}),JSON.stringify(o))}))),...b.map(({remote:e})=>(this.log("Remove remote script:",e.uri),delete i.info[e.uri],u=!0,this.remove(e))),...v.map(({local:e})=>(this.log("Remove local script:",e.props.uri),br.remove(e.props.id))),...k.map(({local:e,info:t})=>{const n={};return t.position&&(n.props={position:t.position}),lr(e.props.id,n)})];return x.push(o.all(x).then(()=>qn()).then(e=>{if(e)return u=!0,br.list().then(e=>{e.forEach(e=>{const t=i.info[e.props.uri];t&&(t.position=e.props.position)})})})),x.push(o.all(x).then(()=>{const t=[];return u&&(i.timestamp=Date.now(),t.push(this.put(e,JSON.stringify(i)))),f.timestamp=i.timestamp,f.lastSync=Date.now(),this.config.set("meta",f),o.all(t)})),o.all(x.map(e=>e.then(A,e=>e||!0))).then(e=>e.filter(t)).then(e=>{if(e.length)throw e})}).then(()=>{this.syncState.set("idle"),this.log("Sync finished:",this.displayName)},e=>{this.syncState.set("error"),this.log("Failed syncing:",this.displayName),this.log(e)}).then(()=>o.resolve(this.releaseLock()).catch(A))}});function Nr(e){kr.push(e)}function Pr(){return Sr.get("current")}function Hr(e){return xr[e||Pr()]}function Vr(){Sr||(Sr=Tr(),kr.forEach(e=>{const t=new e,{name:n}=t;vr.push(n),xr[n]=t})),Br()}function Wr(e){if(!e.syncState.is(["ready","syncing"]))return e.authState.is(["idle","error"])?e.checkSync():e.authState.is("authorized")?e.startSync():void 0}function Br(){const e=Hr();return e&&o.resolve(Wr(e)).then($r)}function Fr(){const e=Hr();e&&e.authorize()}function Gr(){const e=Hr();e&&e.revoke()}function Kr(e){const t=Hr();if(t)return t.setUserConfig(e),t.checkSync()}let Jr;async function Xr(e,t){null==Jr||Jr();const n=(await browser.tabs.create({url:e})).id,r=e=>{var t,r;if(null!=(t=(r=Hr()).checkAuth)&&t.call(r,e.url))return browser.tabs.remove(n),setTimeout(Jr,0),{cancel:!0}};Jr=()=>{browser.webRequest.onBeforeRequest.removeListener(r)},t=t.replace(/:\d+/,""),browser.webRequest.onBeforeRequest.addListener(r,{urls:[`${t}*`],types:["main_frame","xmlhttprequest"]},["blocking"])}At(e=>{(null==e?void 0:e["sync.current"])&&Vr()});const Yr={"+":"-","/":"_"};async function Zr(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t),r=new Blob([n],{type:"application/octet-binary"});return(await q(r)).replace(/[+/=]/g,e=>Yr[e]||"")}function Qr(){return L(L(L()))}async function eo(e){const t="S256";return{code_challenge:await Zr(e),code_challenge_method:t}}const to={client_id:"f0q12zup2uys5w8",redirect_uri:"https://violentmonkey.github.io/auth_dropbox.html"},no=/[\u007f-\uffff]/g,ro=e=>`\\u${(e.charCodeAt(0)+65536).toString(16).slice(1)}`;function oo(e){return JSON.stringify(e).replace(no,ro)}function so(e){return{name:e.name,size:e.size,uri:Cr(e.name)}}Nr(qr.extend({name:"dropbox",displayName:"Dropbox",refreshToken(){const e=this.config.get("refresh_token");return this.authorized({grant_type:"refresh_token",refresh_token:e}).then(()=>this.prepare())},user(){const e=()=>this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/users/get_current_account"});return e().catch(t=>{if(401===t.status)return this.refreshToken().then(e);throw t}).catch(e=>401===e.status?o.reject({type:"unauthorized"}):o.reject({type:"error",data:e}))},handleMetaError(e){if(409!==e.status)throw e},list(){return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/files/list_folder",body:{path:""},responseType:"json"}).then(e=>e.entries.filter(e=>"file"===e[".tag"]&&_r(e.name)).map(so))},get(e){const t=Ur(e);return this.loadData({method:"POST",url:"https://content.dropboxapi.com/2/files/download",headers:{"Dropbox-API-Arg":oo({path:`/${t}`})}})},put(e,t){const n=Ur(e);return this.loadData({method:"POST",url:"https://content.dropboxapi.com/2/files/upload",headers:{"Dropbox-API-Arg":oo({path:`/${n}`,mode:"overwrite"}),"Content-Type":"application/octet-stream"},body:t,responseType:"json"}).then(so)},remove(e){const t=Ur(e);return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/files/delete",body:{path:`/${t}`},responseType:"json"}).then(so)},async authorize(){this.session={state:L(),codeVerifier:Qr()},Xr(`https://www.dropbox.com/oauth2/authorize?${zt(Ve({response_type:"code",token_access_type:"offline",client_id:to.client_id,redirect_uri:to.redirect_uri,state:this.session.state},await eo(this.session.codeVerifier)))}`,to.redirect_uri)},async authorized(e){delete this.headers.Authorization,this.authState.set("authorizing");const t=await this.loadData({method:"POST",url:"https://api.dropbox.com/oauth2/token",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:zt(Ve({client_id:to.client_id},e)),responseType:"json"});if(!t.access_token)throw t;this.config.set({uid:t.account_id,token:t.access_token,refresh_token:t.refresh_token||e.refresh_token})},checkAuth(e){const t=`${to.redirect_uri}?`;if(!e.startsWith(t))return;const n=Lt(e.slice(t.length)),{state:r,codeVerifier:o}=this.session||{};return this.session=null,n.state===r&&n.code?(this.authorized({code:n.code,code_verifier:o,grant_type:"authorization_code",redirect_uri:to.redirect_uri}).then(()=>this.checkSync()),!0):void 0},revoke(){return this.config.set({uid:null,token:null,refresh_token:null}),this.prepare()}}));const io={client_id:"000000004418358A",client_secret:"j9x3OVEtHvhiHKDWOGquyMfZKk96040H",redirect_uri:"https://violentmonkey.github.io/auth_onedrive.html"};function ao(e){return{name:e.name,size:e.size,uri:Cr(e.name)}}Nr(qr.extend({name:"onedrive",displayName:"OneDrive",urlPrefix:"https://api.onedrive.com/v1.0",refreshToken(){const e=this.config.get("refresh_token");return this.authorized({refresh_token:e,grant_type:"refresh_token"}).then(()=>this.prepare())},user(){const e=()=>this.loadData({url:"/drive",responseType:"json"});return e().catch(t=>{if(401===t.status)return this.refreshToken().then(e);throw t}).catch(e=>400===e.status&&"invalid_grant"===re(e,"data.error")?o.reject({type:"unauthorized"}):o.reject({type:"error",data:e}))},handleMetaError(e){if(404===e.status){var t;const n=(null==(t=e.headers.get("WWW-Authenticate"))?void 0:t[0])||"";return/^Bearer realm="OneDriveAPI"/.test(n)?this.refreshToken().then(()=>this.getMeta()):void 0}throw e},list(){return this.loadData({url:"/drive/special/approot/children",responseType:"json"}).then(e=>e.value.filter(e=>e.file&&_r(e.name)).map(ao))},get(e){const t=Ur(e);return this.loadData({url:`/drive/special/approot:/${encodeURIComponent(t)}`,responseType:"json"}).then(e=>this.loadData({url:e["@content.downloadUrl"],delay:!1}))},put(e,t){const n=Ur(e);return this.loadData({method:"PUT",url:`/drive/special/approot:/${encodeURIComponent(n)}:/content`,headers:{"Content-Type":"application/octet-stream"},body:t,responseType:"json"}).then(ao)},remove(e){const t=Ur(e);return this.loadData({method:"DELETE",url:`/drive/special/approot:/${encodeURIComponent(t)}`}).catch(A)},authorize(){Xr(`https://login.live.com/oauth20_authorize.srf?${zt({client_id:io.client_id,scope:"onedrive.appfolder wl.offline_access",response_type:"code",redirect_uri:io.redirect_uri})}`,io.redirect_uri)},checkAuth(e){const t=`${io.redirect_uri}?code=`;if(e.startsWith(t))return this.authState.set("authorizing"),this.authorized({code:e.slice(t.length)}).then(()=>this.checkSync()),!0},revoke(){return this.config.set({uid:null,token:null,refresh_token:null}),this.prepare()},authorized(e){return this.loadData({method:"POST",url:"https://login.live.com/oauth20_token.srf",prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:zt(r.assign({},{client_id:io.client_id,client_secret:io.client_secret,redirect_uri:io.redirect_uri,grant_type:"authorization_code"},e)),responseType:"json"}).then(e=>{if(!e.access_token)throw e;this.config.set({uid:e.user_id,token:e.access_token,refresh_token:e.refresh_token})})}}));const co={client_id:"590447512361-fa9j9vrskafqi75q2p2o2mkirdo9lavo.apps.googleusercontent.com",client_secret:"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",redirect_uri:"http://127.0.0.1:45678/",scope:"https://www.googleapis.com/auth/drive.appdata"},uo={status:"UNAUTHORIZED"};function lo(e){return{id:e.id,name:e.name,size:+e.size,uri:Cr(e.name)}}Nr(qr.extend({name:"googledrive",displayName:"Google Drive",urlPrefix:"https://www.googleapis.com/drive/v3",refreshToken(){const e=this.config.get("refresh_token");return e?this.authorized({refresh_token:e,grant_type:"refresh_token"}).then(()=>this.prepare()):o.reject({type:"unauthorized"})},user(){const e=()=>this.loadData({url:`https://www.googleapis.com/oauth2/v3/tokeninfo?${zt({access_token:this.config.get("token")})}`,responseType:"json"});return e().then(e=>{if(e.scope!==co.scope)return o.reject(uo)}).catch(t=>t===uo||400===t.status&&"Invalid Value"===re(t,"data.error_description")?this.refreshToken().then(e):o.reject({type:"error",data:t}))},getSyncData(){const e={spaces:"appDataFolder",fields:"files(id,name,size)"};return this.loadData({url:`/files?${zt(e)}`,responseType:"json"}).then(({files:e})=>{let t;const n=e.filter(e=>!!_r(e.name)||(t||e.name!==this.metaFile?this.remove(e):t=e,!1)).map(lo).filter(e=>!!e.size||(this.remove(e),!1)),s=t?lo(t):{},i=this.get(s).then(e=>JSON.parse(e)).catch(e=>this.handleMetaError(e)).then(e=>r.assign({},s,{name:this.metaFile,uri:null,data:e}));return o.all([i,n,this.getLocalData()])})},async authorize(){this.session={state:L(),codeVerifier:Qr()};const e=Ve({response_type:"code",client_id:co.client_id,redirect_uri:co.redirect_uri,scope:co.scope,state:this.session.state},await eo(this.session.codeVerifier));this.config.get("refresh_token")||(e.prompt="consent"),Xr(`https://accounts.google.com/o/oauth2/v2/auth?${zt(e)}`,co.redirect_uri)},checkAuth(e){const t=`${co.redirect_uri}?`;if(!e.startsWith(t))return;const n=Lt(e.slice(t.length)),{state:r,codeVerifier:o}=this.session||{};return this.session=null,n.state===r&&n.code?(this.authState.set("authorizing"),this.authorized({code:n.code,code_verifier:o,grant_type:"authorization_code",redirect_uri:co.redirect_uri}).then(()=>this.checkSync()),!0):void 0},revoke(){return this.config.set({token:null,refresh_token:null}),this.prepare()},authorized(e){return this.loadData({method:"POST",url:"https://www.googleapis.com/oauth2/v4/token",prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:zt(r.assign({},{client_id:co.client_id,client_secret:co.client_secret},e)),responseType:"json"}).then(e=>{if(!e.access_token)throw e;{const t={token:e.access_token};e.refresh_token&&(t.refresh_token=e.refresh_token),this.config.set(t)}})},handleMetaError:A,list(){throw new n("Not supported")},get({id:e}){return e?this.loadData({url:`/files/${e}?alt=media`}):o.reject()},put(e,t){const n=Ur(e),{id:r}=e,o=L("violentmonkey-is-great-"),s={"Content-Type":`multipart/related; boundary=${o}`},i=r?{name:n}:{name:n,parents:["appDataFolder"]},a=[`--${o}`,"Content-Type: application/json; charset=UTF-8","",JSON.stringify(i),`--${o}`,"Content-Type: text/plain","",t,`--${o}--`,""].join("\r\n"),c=r?`https://www.googleapis.com/upload/drive/v3/files/${r}?uploadType=multipart`:"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart";return this.loadData({url:c,body:a,headers:s,method:r?"PATCH":"POST"})},remove({id:e}){return this.loadData({method:"DELETE",url:`/files/${e}`})}}));const po=Symbol("children");class ho{constructor(e,t){this.node=e,this.nsMap=Ve({},t),this.parseAttrs(),this.parseName()}static fromXML(e){const t=(new DOMParser).parseFromString(e,"application/xml");return new ho(t)}parseAttrs(){const{node:e,nsMap:t}=this,n={},{attributes:r}=e;if(r)for(let r=0,o=e.attributes;r<o.length;r++){const e=o[r],{name:s,value:i}=e;"xmlns"===s?t.$=i:s.startsWith("xmlns:")&&(t[s.slice(6)]=i),n[s]=i}this.attrs=n}parseName(){const{node:e,nsMap:t}=this;if(1===e.nodeType){let r=e.tagName,o=t.$;if(r.includes(":")){let e;if([e,r]=r.split(":"),o=t[e],!o)throw new n(`Unknown namespace: ${e}`)}this.name=o+r}}text(){const{node:e}=this;if(e)return(e.textContent||"").trim()}children(){if(!this[po]){const{node:e,nsMap:t}=this;this[po]=[...e.children].map(e=>new ho(e,t))}return this[po]}map(e){return this.children().map(e)}getCallback(e){return"string"==typeof e?(t=e,e=>e.name===t):e;var t}filter(e){return this.children().filter(this.getCallback(e))}find(e){return this.children().find(this.getCallback(e))}attr(e){return this.attrs[e]}}const fo={serverUrl:"",anonymous:!1,username:"",password:""},mo=qr.extend({name:"webdav",displayName:"WebDAV",properties:{authType:"password",serverUrl:null},getUserConfig(){return this.userConfig||(this.userConfig=Ve({},fo,this.config.get("userConfig"))),this.userConfig},setUserConfig(e){r.assign(this.userConfig,e),this.config.set("userConfig",this.userConfig)},initToken(){var e;this.prepareHeaders();const t=this.getUserConfig();let n=(null==(e=t.serverUrl)?void 0:e.trim())||"";n.includes("://")||(n=`http://${n}`),n.endsWith("/")||(n+="/");try{new URL(n)}catch(e){return this.properties.serverUrl=null,!1}this.properties.serverUrl=`${n}Violentmonkey/`;const{anonymous:r,username:o,password:s}=t;if(r)return!0;if(!o||!s)return!1;const a=i.btoa(`${o}:${s}`);return this.headers.Authorization=`Basic ${a}`,!0},loadData(e){return qr.prototype.loadData.call(this,r.assign({credentials:"omit"},e))},handleMetaError(e){if(![404,409].includes(e.status))throw e},list(){const{serverUrl:e}=this.properties,n=()=>this.loadData({method:"MKCOL",url:e}),r=()=>this.loadData({method:"PROPFIND",url:e,headers:{depth:"1"}}).then(e=>ho.fromXML(e).children()[0].map(e=>{const t=e.find("DAV:propstat").find("DAV:prop");if("file"==(t.find("DAV:resourcetype").find("DAV:collection")?"directory":"file")){let n;const r=t.find("DAV:displayname");if(void 0!==r)n=r.text();else{const t=e.find("DAV:href").text();n=decodeURIComponent(t.substring(t.lastIndexOf("/")+1))}if(_r(n)){const e=t.find("DAV:getcontentlength");return go({name:n,size:e?+e.text():0})}}return null}).filter(t));return r().catch(e=>{if(404===e.status)return n().then(r);throw e})},get(e){const t=Ur(e),{serverUrl:n}=this.properties;return this.loadData({url:n+t})},put(e,t){const n=Ur(e),r={"Content-Type":"text/plain"},o=this.config.get("lock");o&&(r.If=`(<${o}>)`);const{serverUrl:s}=this.properties;return this.loadData({method:"PUT",url:s+n,body:t,headers:r})},remove(e){const t=Ur(e),n={},r=this.config.get("lock");r&&(n.If=`(<${r}>)`);const{serverUrl:o}=this.properties;return this.loadData({method:"DELETE",url:o+t,headers:n})}});function go(e){return{name:e.name,size:e.size,uri:Cr(e.name)}}Nr(mo),Fe({SyncAuthorize:Fr,SyncRevoke:Gr,SyncStart:Br,SyncSetConfig:Kr});const wo=s.createElement("textarea");let yo;Be({SetClipboard(e){yo=e,wo.focus(),s.execCommand("copy",!1,null)}}),s.body.appendChild(wo),s.addEventListener("copy",e=>{e.preventDefault();const{type:t,data:n}=yo;e.clipboardData.setData(t||"text/plain",n)}),wt.push(()=>{browser.commands.onCommand.addListener(e=>{if("newScript"===e)We.OpenEditor();else{const t="settings"===e?`#${e}`:"";We.TabOpen({url:`/options/index.html${t}`})}})}),Fe({GetImageData:async e=>e.startsWith(M)?(await Lo(e)).uri:(await ct.cache.fetch(e),Oe(await ct.cache.getOne(e)))}),Be({SetBadge:Do});const bo={},vo=(()=>{const{chrome:t}=e,n=t.browserAction,r=()=>t.runtime.lastError,o=e=>(...t)=>{try{d(e,n,...t,r)}catch(r){d(e,n,...t)}};return se(n,["setIcon","setBadgeText","setBadgeBackgroundColor","setTitle"],e=>e?o(e):A)})(),ko={},xo="isApplied",$o="showBadge",So="badgeColor",Io="badgeColorBlocked";let Uo,_o,Co,To,Ro,Mo;function Do(e,{tab:t,frameId:n}){const o=t.id,s=ko[o]||{};s.idMap&&0!==n||(s.total=0,s.unique=0,s.idMap={},ko[o]=s),s.total+=e.length,e&&(e.forEach(e=>{s.idMap[e]=1}),s.unique=r.keys(s.idMap).length),Oo(t,s),Eo(t,s)}function Eo(e,t=ko[e.id]){t&&vo.setBadgeText({text:`${t[_o]||""}`,tabId:e.id})}function Oo(e,t=ko[e.id]){t&&vo.setBadgeBackgroundColor({color:t.blocked?To:Co,tabId:e.id})}function jo(e,t=e.pendingUrl||e.url){const n=e.id,r=b.test(t),o=(r?Rn(t):void 0)&&Ro||!r&&Mo||"";if(o||(ko[n]||{}).blocked){vo.setTitle({title:o,tabId:n});const t=o?{blocked:!0}:{};ko[n]=t,Ao(e,t),Eo(e,t)}}async function Ao(e={},t={}){const n=(t.blocked?"b":!Uo&&"w")||"",r={};for(let e=0,t=[16,19,32,38];e<t.length;e++){const o=t[e],s=Lo(`${M}${o}${n}.png`);r[o]=(s.then?await s:s).img}vo.setIcon({tabId:e.id,imageData:r})}function Lo(e){return bo[e]||(bo[e]=zo(e))}function zo(e){return new o((t,n)=>{const r=new Image;r.src=e,r.onload=()=>{const{width:n,height:o}=r;if(!n)return void t(e);const i=s.createElement("canvas"),a=i.getContext("2d");i.width=n,i.height=o,a.drawImage(r,0,0,n,o),t(bo[e]={uri:i.toDataURL(),img:a.getImageData(0,0,n,o)})},r.onerror=n})}At(e=>{let t;const n=[];null!=(t=e[xo])&&(Uo=t,Ao(),n.push(Ao)),null!=(t=e[$o])&&(_o=t,n.push(Eo)),((t=e[So])&&(Co=t)||(t=e[Io])&&(To=t))&&n.push(Oo),D in e&&n.push(jo),n.length&&Ge(e=>n.forEach(t=>t(e)))}),wt.push(()=>{Uo=Dt(xo),_o=Dt($o),Co=Dt(So),To=Dt(Io),Ro=O("failureReasonBlacklisted"),Mo=O("failureReasonNoninjectable"),Ge(jo),Uo||Ao()}),browser.tabs.onRemoved.addListener(e=>{delete ko[e]}),browser.tabs.onUpdated.addListener((e,t,n)=>{const{url:r}=t;("loading"===t.status||t.favIconUrl&&n.url.startsWith("about:"))&&jo(n,r)});const qo={};Be({async Notification({image:e,text:t,title:n},r,o){const s=await browser.notifications.create({type:"basic",title:d(Ee,[n,p&&O("extName")]," - "),message:t,iconUrl:e||me});return qo[s]=(null==o?void 0:o.onClick)||r.tab.id,s},RemoveNotification:e=>browser.notifications.clear(e)}),browser.notifications.onClicked.addListener(e=>{const t=qo[e];t>=0&&ke(t,"NotificationClick",e),"function"==typeof t&&t()}),browser.notifications.onClosed.addListener(e=>{const t=qo[e];delete qo[e],t>=0&&ke(t,"NotificationClose",e)});const No={},Po=No;function Ho(e,t){const n=new RegExp(`\\s${e?"Chrom(e|ium)":"Firefox"}/(\\d+[.0-9]*)|$`,"i"),r=navigator.userAgent.match(n).pop();return t?r:parseFloat(r)}r.defineProperties(No,{chrome:{value:Ho(!0)},firefox:{value:Ho(),writable:!0},ready:{value:o.all([browser.runtime.getPlatformInfo(),null==browser.runtime.getBrowserInfo?void 0:browser.runtime.getBrowserInfo()]).then(([{os:e,arch:t},{name:n,version:o}={}])=>{r.assign(No,{arch:t,os:e,browserName:(null==n?void 0:n.toLowerCase())||"chrome",browserVersion:o||Ho(!0,!0)}),p&&(No.firefox=parseFloat(o)||0)})}});const Vo={};function Wo(e){const t=+e.name;t&&(Vo[t]=1,ke(t,"PopupShown",!0),e.onDisconnect.addListener(Bo))}function Bo({name:e}){delete Vo[e],ke(+e,"PopupShown",!1)}async function Fo(){ke((await Me()).id,"PopupShown",!0)}let Go;Be({async SetPopup(e,t){Vo[t.tab.id]||(r.assign(e,await nr({ids:e.ids})),ht.put("SetPopup",r.assign({[t.frameId]:[e,t]},ht.get("SetPopup"))))}}),wt.push(()=>{browser.runtime.onConnect.addListener(Wo),browser.webRequest.onBeforeRequest.addListener(Fo,{urls:[browser.runtime.getURL(browser.runtime.getManifest().browser_action.default_popup)],types:["main_frame"]})});const Ko=L("VM-Verify"),Jo={__proto__:null},Xo={__proto__:null},Yo=/^(proxy-|sec-)|^(user-agent|accept-(charset|encoding)|access-control-request-(headers|method)|connection|content-length|cookie2?|date|dnt|expect|host|keep-alive|origin|referer|te|trailer|transfer-encoding|upgrade|via)$/i,Zo={urls:["<all_urls>"],types:["xmlhttprequest"]},Qo=[browser.webRequest.OnBeforeSendHeadersOptions.EXTRA_HEADERS].filter(t),es={},ts=e=>e.name===Ko,ns=e=>!/^cookie2?$/i.test(e.name),rs=e=>!(ts(e)||/^origin$/i.test(e.name)&&e.value===R),os=e=>rs(e)&&ns(e),ss=/^set-cookie2?$/i,is=/^\s*(?:__(Secure|Host)-)?([^=\s]+)\s*=\s*(")?([!#-+\--:<-[\]-~]*)\3(.*)/,as=/\s*;?\s*(\w+)(?:=(")?([!#-+\--:<-[\]-~]*)\2)?/y,cs={strict:"strict",lax:"lax",none:"no_restriction"},us={onBeforeSendHeaders:[ds,"requestHeaders","blocking",...Qo],onHeadersReceived:[ls,"responseHeaders","blocking",...Qo]};function ls({responseHeaders:e,requestId:t,url:n}){const r=Jo[Xo[t]];if(r)return(r.anonymous||r.storeId)&&(e=e.filter(e=>!ss.test(e.name)||!r.storeId||ps(e.value,r,n))),r.responseHeaders=e.map(fs).join(""),{responseHeaders:e}}function ds({requestHeaders:e,requestId:t,url:n}){var r;const o=Xo[t]||(null==(r=e.find(ts))?void 0:r.value),s=Jo[o];return s&&(Xo[t]=o,s.coreId=t,s.url=n,e=(s.noNativeCookie?e.filter(ns):e).concat(es[o]||[]).filter(s.anonymous?os:rs)),{requestHeaders:e}}function ps(e,t,n){let r=is.exec(e);if(r){var o;const[,e,s,,i,a]=r,c={},u="Host"===e;for(as.lastIndex=0;r=as.exec(a);)c[r[1].toLowerCase()]=r[3];const l=null==(o=c.sameSite)?void 0:o.toLowerCase();browser.cookies.set({url:n,name:s,value:i,domain:u?void 0:c.domain,expirationDate:Math.max(0,+new Date(1e3*c["max-age"]||c.expires))||void 0,httpOnly:"httponly"in c,path:u?"/":c.path,sameSite:cs[l],secure:n.startsWith("https:")&&(!!e||"none"===l||"secure"in c),storeId:t.storeId})}}function hs(e,t){t?(es[e]=t,d(ae,us,([e,[t,...n]])=>{browser.webRequest[e].addListener(t,Zo,n)})):e in es&&(delete es[e],F(es)&&d(ae,us,([e,[t]])=>{browser.webRequest[e].removeListener(t)}))}function fs({name:e,value:t,binaryValue:n}){return`${ms(e)}: ${n?z(n):ms(t)}\r\n`}function ms(e){return/[\u0080-\uFFFF]/.test(e)?(Go||(Go=new TextEncoder),z(Go.encode(e))):e}Po.chrome>=74&&Po.chrome<=91&&browser.webRequest.onBeforeSendHeaders.addListener(A,Zo,Qo),Be({HttpRequest(e,t){const{tab:{id:n},frameId:r}=t,{id:o,eventsToNotify:s}=e;return Jo[o]={id:o,tabId:n,frameId:r,eventsToNotify:s,xhr:new XMLHttpRequest},vs(e,t,e=>Jo[o]&&ke(n,"HttpRequested",e,{frameId:r}))},AbortRequest(e){const t=Jo[e];t&&(t.xhr.abort(),ks(t))},RevokeBlob(e){const t=ht.pop(`xhrBlob:${e}`);t&&(clearTimeout(t),URL.revokeObjectURL(e))}});const gs=1e6;async function ws(e,t){return q(e,t*gs,gs)}function ys(e){const t=URL.createObjectURL(e);return ht.put(`xhrBlob:${t}`,setTimeout(We.RevokeBlob,6e4,t),61e3),t}function bs(e){let t,n,r,s,i,a,c=o.resolve(),u=!1;const{id:l,blobbed:d,chunked:p,xhr:h}=e,f=d&&ys||p&&ws,m=()=>{const t=e.responseHeaders||h.getAllResponseHeaders();if(a!==t)return a=t,{responseHeaders:a}};return o=>{if(t||(t=h.getResponseHeader("Content-Type")||"application/octet-stream"),h.response!==s){s=h.response,u=!1;try{i=h.responseText,i===s&&(i=["same"])}catch(e){}(d||p)&&s&&(n=s.size,r=p&&Math.ceil(n/gs)||1)}const{type:a}=o,g=e.eventsToNotify.includes(a),w=4===h.readyState&&g&&!u;(g||"loadend"===a)&&(c=c.then(async()=>{if(await e.cb({blobbed:d,chunked:p,contentType:t,dataSize:n,id:l,numChunks:r,type:a,data:g&&Ve({finalUrl:e.url||h.responseURL},m(),se(h,["readyState","status","statusText"]),"loaded"in o&&se(o,["lengthComputable","loaded","total"]),{response:w?r&&await f(s,0)||s:null,responseText:w?i:null})}),w)for(let t=1;t<r;t+=1)await e.cb({id:l,chunk:{pos:t*gs,data:await f(s,t),last:t+1===r}});"loadend"===a&&ks(e)}))}}async function vs(e,t,n){const{tab:r}=t,{incognito:o}=r,{anonymous:s,id:i,overrideMimeType:a,xhrType:c,url:u}=e,l=Jo[i];if(!l||l.cb)return;l.cb=n,l.anonymous=s;const{xhr:h}=l,f=[],m=c&&!p,g=m&&o,w=m&&!o,[y,b]=$s(e.data);l.blobbed=w,l.chunked=g;let v=!s&&(o||p);if(h.open(e.method||"GET",u,!0,e.user||"",e.password||""),h.setRequestHeader(Ko,i),b&&h.setRequestHeader("Content-Type",b),d(ae,e.headers,([e,t])=>{Yo.test(e)?f.push({name:e,value:t}):h.setRequestHeader(e,t),v&&(v=!/^cookie$/i.test(e))}),h.responseType=(m?"blob":c)||"text",h.timeout=Math.max(0,Math.min(2147483647,e.timeout))||0,a&&h.overrideMimeType(a),v){l.noNativeCookie=!0;for(let e=0,t=await browser.cookies.getAllCookieStores();e<t.length;e++){const n=t[e];if(n.tabIds.includes(r.id)){(p?"firefox-default"!==n.id:"0"!==n.id)&&(l.storeId=n.id);break}}const e=Date.now()/1e3,t=(await browser.cookies.getAll(Ve({url:u,storeId:l.storeId},Po.firefox>=59&&{firstPartyDomain:null}))).filter(t=>t.session||t.expirationDate>e);t.length&&f.push({name:"cookie",value:t.map(e=>`${e.name}=${e.value};`).join(" ")})}hs(i,f);const k=bs(l);l.eventsToNotify.forEach(e=>{h[`on${e}`]=k}),h.onloadend=k,h.send(y)}function ks({id:e,coreId:t}){delete Xo[t],delete Jo[e],hs(e,!1)}function xs(e,t){d(ue,Jo,n=>{null!=e&&n.tabId!==e||t&&n.frameId!==t||We.AbortRequest(n.id)})}function $s([e,t,n]){if("query"===t)t="application/x-www-form-urlencoded";else if("fd"===t){const n=new FormData;e.forEach(e=>n.set(...e)),e=n,t=""}else if(null!=t){const r=P(atob(e.slice(e.indexOf(",")+1)));n||(t=e.match(/^data:(.+?);base64/)[1].replace(/(boundary=)[^;]+/,(e,t)=>t+String.fromCharCode(...r.slice(2,r.indexOf(13))))),e=r}return[e,t]}const Ss=(e,t)=>e[t]||(e[t]={}),Is={};let Us=o.resolve(),_s={};function Cs(e,t){null==e&&(_s={}),d(ae,Is,([n,r])=>{const o=r[e];o&&(t?(delete o[t],F(o)&&delete r[e]):delete r[e]),(null==e||F(r))&&delete Is[n]})}function Ts(e,t,n){null==n||n.forEach(n=>{const{values:r,props:{id:o}}=n;r?oe(Is,[o,e,t],r):delete Is[o]})}function Rs(e){ct.value.set(e),Us=Us.catch(console.warn).then(Ms)}async function Ms(){const e=[],t={};d(ae,_s,Ds,t),_s={};for(let n=0,s=r.entries(t);n<s.length;n++){const[t,i]=s[n];if(t>=0)for(let n=0,s=r.entries(i);n<s.length;n++){const[r,i]=s[n];F(i)||(e.push(Es(+t,+r,i)),20===e.length&&await o.all(e.splice(0)))}}await o.all(e)}function Ds([e,t]){const n=r.entries(t);d(ae,Is[e],([t,r])=>{const o=Ss(this,t);d(ae,r,([t,r])=>{const s=Ss(Ss(o,t),e);n.forEach(([e,t])=>{t!==r[e]&&(t?r[e]=t:delete r[e],s[e]=t)})})})}function Es(e,t,n){return ke(e,"UpdatedValues",n,{frameId:t}).catch(console.warn)}Fe({async GetValueStore(e,{tab:t}){const n=Ss(Ss(Is,e),t.id);return n[0]||(n[0]=await ct.value.getOne(e))},SetValueStores(e){const t={};return d(ae,e,([e,n={}])=>{var r;(e=null==(r=Pn({id:+e,uri:e}))?void 0:r.props.id)&&(t[e]=n,_s[e]=n)}),Rs(t),Us}}),Be({UpdateValue({id:e,key:t,raw:n},{tab:r,frameId:o}){const s=re(Is,[e,r.id,o]);if(s)return n?s[t]=n:delete s[t],r.id>=0&&(Ss(_s,e)[t]=n||null),Rs({[e]:s}),Us}});let Os={},js={};const As={},Ls=5e3,zs=864e5,qs=dt({lifetime:36e5}),Ns=dt({lifetime:zs}),{scriptMap:Ps}=On,{api:Hs}=ct,Vs="get",Ws="set",Bs="remove",Fs=j(ti,200),{hook:Gs,fire:Ks}=ye(),Js=Gs,Xs=()=>{qs.destroy(),Ns.destroy()};function Ys(e,t,n=!0){n&&!js&&(js={}),d(ae,t,([t,r])=>{const{prefix:o}=ct[t];for(let t=0,s=G(r);t<s.length;t++){const r=o+s[t],i=js[r]||n&&(js[r]=[]),a=i?i.indexOf(e):-1;a>=0&&!n?(i.splice(a,1),i.length||delete js[r]):a<0&&n&&i.push(e)}}),F(js)&&(js=null)}function Zs(e){qs.batch(e),Ns.batch(e)}function Qs(e,t){const n=+ct.script.toId(e);n&&(t?Ps[n]=t:delete Ps[n])}async function ei(e,t){const n=On.sizesPrefixRe.exec(e);n&&n[0]!==et&&(On.sizes[e]=fe(t))}async function ti(){const e=r.keys(Os),t=[],n=Os;Os={},e.forEach(e=>{const r=n[e];r||(delete n[e],t.push(e)),ei(e,r)}),F(n)||await Hs[Ws](n),t.length&&await Hs[Bs](t),js&&setTimeout(ni,0,n,t),Ks({keys:e})}function ni(e,t){const n=new Map;let r,o;for(const s in js)if((r=e[s])||t.includes(s))for(let e=0,t=js[s];e<t.length;e++){const i=t[e];(o=n.get(i))||n.set(i,o={}),o[s]={newValue:r}}n.forEach((e,t)=>t(e))}ct.api={async[Vs](e){var t;const n={};var r;return Zs(!0),(!(e=null==(t=e)?void 0:t.filter(e=>{const t=qs.get(e),r=void 0!==t;return r&&(n[e]=le(t)),!r&&0!==Ns.get(e)}))||e.length)&&(d(ae,await Hs[Vs](e),([t,r])=>{n[t]=r,Ns.put(t,1),qs.put(t,le(r),!e&&Ls),Qs(t,r)}),null==(r=e)||r.forEach(e=>Ns.put(e,+d(u,n,e)))),Zs(!1),n},async[Ws](e){const t={},n=[];let r;Zs(!0),d(ae,e,([e,o])=>{const s=pe(o,qs.get(e));void 0!==s&&(qs.put(e,s),Ns.put(e,1),ct.value.toId(e)?(r=!0,Os[e]=s):(n.push(e),t[e]=o,Qs(e,o),ei(e,o)))}),Zs(!1),n.length&&(await Hs[Ws](t),Ks({keys:n})),r&&Fs()},async[Bs](e){let t;(e=e.filter(e=>{let n=0!==Ns.get(e);return n&&(qs.del(e),Ns.put(e,0),ct.value.toId(e)?(Os[e]=null,t=!0,n=!1):(Qs(e),ei(e))),n})).length&&(await Hs[Bs](e),Ks({keys:e})),t&&Fs()}},i[v]=e=>{const t=performance.now();return As[t]=e,t},browser.runtime.onConnect.addListener(e=>{if(!e.name.startsWith(v))return;const{id:t,cfg:n,tabId:r}=JSON.parse(e.name.slice(v.length)),o=t?As[t]:e.postMessage.bind(e);Ys(o,n),e.onDisconnect.addListener(()=>{Cs(r),Ys(o,n,!1),delete As[t]})});const ri={urls:["*://*/*"],types:["main_frame","sub_frame"]},oi="csar",si=browser.contentScripts,ii=3e5,ai=dt({lifetime:ii,async onDispose(e,t){var n;e&&(e.then&&(e=await e),null==(n=e[oi])||n.then(e=>e.unregister()),(e=e[ci]||e)[Bn]&&(e[Bn].forEach(e=>ai.del(e.dataKey)),ai.del(e[$]||mi[t]),delete mi[t]))}}),ci="inject",ui="injectInto",li="expose",di="defaultInjectInto",pi="isApplied",hi="xhrInject",fi="{GM,GM_info,unsafeWindow,cloneInto,createObjectIn,exportFunction}",mi={},gi={};let wi,yi,bi;async function vi({[$]:e,[k]:n,[x]:r},o){if(n.forEach(ki,o),!e)return;const s=await ai.get(e);if(!s)throw"Injection data expired, please reload the tab!";return s[x]=r,s[Bn].map(Oi,s).filter(t).forEach(ki,o),Ts(o.tab.id,o.frameId,s[Bn]),se(s,["cache",Bn])}async function ki([e,t,n]){const r=ai.get(e);if(t&&r){const{frameId:e,tab:{id:o}}=this;t=`document_${"body"===t?"start":t}`,browser.tabs.executeScript(o,{code:r,frameId:e,runAt:t}),n&&ke(o,"Run",n,{frameId:e})}}Be({async GetInjected({url:e,forceContent:t,done:n},r){const{frameId:o,tab:s}=r,i=s.id;e||(e=r.url||s.url),Vi(i,o);const a=Ui(e,!o),c=ai.get(a)||Di(a,e,i,o,t),u=c[ci]?c:await c,l=u[ci],d=u[k];return null!=d&&d.length&&setTimeout(vi,0,{[k]:d},r),Vo[i]&&setTimeout(ke,0,i,"PopupShown",Vo[i],{frameId:o}),Ts(i,o,l[Bn]),!n&&l},InjectionFeedback:vi}),At(Ii),wt.push(()=>{for(let e=0,t=[li,di,pi,hi];e<t.length;e++){const n=t[e];Ii({[n]:Dt(n)})}});const xi={[Xe]:Vn,[Ye]:!0,[Qe]:Wn,[et]:!0,[tt]:Fn};async function $i(e,t){if(e.then&&(e=await e),e[Vn])for(let r=0;r<this.length;r++){var n;const[o,s]=this[r],i=xi[o];!0===i?ai.destroy():null!=(n=e[i])&&n.includes(+s||s)&&ai.del(t)}}function Si(e){return d(u,w,e)?e:yi||f}function Ii(e){d(ae,e,([e,t])=>{switch(e){case di:yi=Si(t),ai.destroy();break;case hi:Ci(t),ai.destroy();break;case pi:_i(t);break;case li:d(ae,t,([e,t])=>{gi[decodeURIComponent(e)]=t});break;default:e.includes(".")&&Ii(oe({},e,t))}})}function Ui(e,t){return t?e:`-${e}`}function _i(e){wi=e;const t=(e?"add":"remove")+"Listener",n=e?ri:void 0;browser.webRequest.onSendHeaders[t](Ti,n),wi&&bi||browser.webRequest.onHeadersReceived[t](Ri,n),browser.tabs.onRemoved[t](Pi),browser.tabs.onReplaced[t](Hi),e||(ai.destroy(),Vi(),Xs())}function Ci(e){bi=e,browser.webRequest.onHeadersReceived.removeListener(Ri),e&&browser.webRequest.onHeadersReceived.addListener(Ri,ri,["blocking","responseHeaders",browser.webRequest.OnHeadersReceivedOptions.EXTRA_HEADERS].filter(t))}function Ti({url:e,tabId:t,frameId:n}){const r=Ui(e,!n);ai.has(r)||ai.put(r,Di(r,e,t,n),ii)}function Ri(e){const t=Ui(e.url,!e.frameId),n=bi&&ai.get(t);return(null==n?void 0:n[ci])&&Mi(e,n)}function Mi({url:e,responseHeaders:t},n){p&&e.startsWith("https:")&&Li(t)&&zi(n);const r=URL.createObjectURL(new Blob([JSON.stringify(n[ci])]));return t.push({name:"Set-Cookie",value:`"Violentmonkey:E3GD8ruVdGc="=${r.split("/").pop()}; SameSite=Lax`}),setTimeout(URL.revokeObjectURL,ii,r),{responseHeaders:t}}function Di(e,t,n,r,o){const s={[ci]:{expose:!r&&t.startsWith("https://")&&gi[t.split("/",3)[2]]}};return wi?Ei(s,e,t,n,r,o):s}async function Ei(e,n,o,s,i,a){const c=[],u=await Zn(o,!i,c),{envDelayed:l,disabledIds:p,[Bn]:h}=u;u[x]=a,d(ue,xi,t=>{!0!==t&&(e[t]=u[t])}),ai.batch(!0);const f=h.map(Oi,u).filter(t),g=l.promise,w=g&&L("more"),y=e[ci];return r.assign(y,{[Bn]:h,[ui]:yi,[m]:!a&&(h.some(Ni,u)||l[Bn].some(Ni,u)),[$]:w,cache:u.cache,ids:p,info:{ua:Po},errors:c.filter(e=>!p.includes(+e.slice(e.lastIndexOf("#")+1))).join("\n")}),e[k]=f,e[oi]=si&&!bi&&Ai(y,o,!!i),g&&(ai.put(w,g),mi[w]=n),ai.put(n,e),ai.batch(!1),e}function Oi(e){const{custom:n,meta:o,props:s}=e,{id:i}=s,{[x]:a,require:c,value:u}=this,l=this.code[i],h=L("VMin"),f=Ue(e),m=qi(e,a),g=n.pathMap||{},w=o.require.map(e=>c[g[e]||e]).filter(t),b=w?[].concat(...w.map(e=>[e,"\n;"])):[],v=b.length,k=!o.unwrap,{grant:$}=o,S=$.length,I=!S||1===S&&"none"===$[0],U=d(Ee,[k&&`window.${h}=function(${I?fi:"GM"}${p?`,${h}){try{`:"){"}${I?"":"with(this)with(c)delete c,"}((define,module,exports)=>{`,...b,v&&k&&"(()=>{",l,!l.endsWith("\n")&&"\n",v&&k&&"})()",k&&`})()${p?`}catch(e){${h}(e)}`:""}}`,p&&";0",`\n//# sourceURL=${_e(e,f)}`],"");return ai.put(h,U,ii),r.assign(e,{dataKey:h,displayName:f,code:m?"":a||U,metaStr:l.match(y)[1]||"",values:u[i]||null}),m&&[h,e.runAt,!k&&i]}Js(({keys:e})=>{ai.forEach($i,e.map((e,t)=>[e.slice(0,t=e.indexOf(":")+1),e.slice(t)]))});const ji=`(${function(e){const{vmResolve:t}=this;t?t(e):this.vmData=e}})`;function Ai(e,t,n){return si.register({allFrames:n,js:[{code:`${ji}(${JSON.stringify(e)})`}],matches:t.split("#",1),runAt:"document_start"})}function Li(e){return e.some(({name:e,value:t})=>/^content-security-policy$/i.test(e)&&/^.(?!.*'unsafe-inline')/.test(t.match(/(?:^|;)\s*script-src-elem\s[^;]+/)||t.match(/(?:^|;)\s*script-src\s[^;]+/)||t.match(/(?:^|;)\s*default-src\s[^;]+/)||""))}function zi(e){const t=e[ci];t[x]=!0,t[Bn].forEach(t=>{const n=!qi(t,!0);t.code=n||"",e[k].push([t.dataKey,!n&&t.runAt,t.meta.unwrap&&t.props.id])})}function qi(e,t){const n=e[ui]||(e[ui]=Si(e.custom[ui]||e.meta[ui]));return n===g||t&&n===f}function Ni(e){return!qi(e,this[x])}function Pi(e){Vi(e)}function Hi(e,t){Vi(t)}function Vi(e,t){xs(e,t),Cs(e,t)}const Wi={},Bi=!p||!(!i.AbortSignal||!browser.windows);function Fi(e){return 0===e?"firefox-default":e>0&&`firefox-container-${e}`}Fe({async OpenEditor(e,t){if(!e){const{tab:t,domain:n}=await We.GetTabDomain(),r=n&&We.CacheNewScript({url:(t.pendingUrl||t.url).split(/[#?]/)[0],name:`${Dt("scriptTemplateEdited")?"":"- "}${n}`});e="_new"+(r?`/${r}`:"")}const n=`${T}options/index.html#scripts/${e}`;for(let e=0,t=browser.extension.getViews();e<t.length;e++){const r=t[e];if(r.location.href===n){const{id:e,windowId:t}=await r.browser.tabs.getCurrent();return browser.windows.update(t,{focused:!0}),browser.tabs.update(e,{active:!0})}}return We.TabOpen({url:n,maybeInWindow:!0},t)}}),Be({async TabOpen({url:e,active:t=!0,container:n,insert:r=!0,maybeInWindow:o=!1,pinned:s},i={}){const a=i.tab||await Me()||{},c=i.url,u=!c||c.startsWith(T),{incognito:l,windowId:d}=a;let h=a.cookieStoreId;h&&!l&&(h=Fi(u?0:n)||h),h&&(h={cookieStoreId:h}),/^[-\w]+:/.test(e)||(e=u?browser.runtime.getURL(e):Te(e,c));const f=!l||p||!/^(chrome[-\w]*):/.test(e);let m;if(o&&browser.windows&&Dt("editorWindow")&&(!h||Po.firefox>=64)){const n=Ve({url:e,incognito:f&&l},Dt("editorWindowSimple")&&{type:"popup"},!p&&{focused:!!t},h),r=Dt("editorWindowPos"),o=r&&"top"in r;m=(await browser.windows.create(Ve({},n,r)).catch(o&&A)||o&&await browser.windows.create(n)).tabs[0]}m||(m=await browser.tabs.create(Ve({url:e,active:!!t,pinned:!!s},h,f&&Ve({windowId:d},r&&{index:a.index+1},Bi&&{openerTabId:a.id}))));const{id:g}=m;return t&&m.windowId!==d&&await browser.windows.update(m.windowId,{focused:!0}),Wi[g]=a.id,u?m:{id:g}},TabClose({id:e}={},t){var n;const r=e||(null==t||null==(n=t.tab)?void 0:n.id);r>=0&&browser.tabs.remove(r)},TabFocus(e,t){browser.tabs.update(t.tab.id,{active:!0}).catch(A),browser.windows.update(t.tab.windowId,{focused:!0}).catch(A)}}),browser.tabs.onRemoved.addListener(e=>{const t=Wi[e];t>=0&&(ke(t,"TabClosed",e),delete Wi[e])});const Gi=`${T}confirm/index.html#`;Be({async CheckInstallerTab(e,t){const n=p&&(t.url||"").startsWith("file:")&&await browser.tabs.get(e).catch(A);return n&&(n.pendingUrl||n.url||"").startsWith(Gi)},async ConfirmInstall({code:e,from:t,url:n},{tab:r={}}){if(e||(e=(await ee(n)).data),!Pt(e))throw O("msgInvalidScript");ht.put(n,e,3e3);const o=L(),{active:s,id:i,incognito:a}=r,c=(!a||p)&&(n===t||ht.has(`autoclose:${i}`)||/^(chrome:\/\/(newtab|startpage)\/|about:(home|newtab))$/.test(t));ht.put(`confirm-${o}`,{incognito:a,url:n,from:t,tabId:i,ff:Po.firefox});const u=Gi+o,{windowId:l}=c?await browser.tabs.update(i,{url:u}):await We.TabOpen({url:u,active:!!s},{tab:r});s&&l!==r.windowId&&await browser.windows.update(l,{focused:!0})}});const Ki=/^https:\/\/(greasyfork\.org\/scripts\/[^/]*\/code|openuserjs\.org\/install\/[^/]*|github\.com\/[^/]*\/[^/]*\/(raw\/[^/]*|releases\/[^/]*\/download)|raw\.githubusercontent\.com(\/[^/]*){3}|gist\.github\.com\/.*?)\/[^/]*?\.user\.js([?#]|$)/i,Ji=/^https?:\/\/((gist\\.)?github\\.com|(greasyfork|openuserjs)\\.org)\//i,Xi=e=>`${T}options/index.html#scripts/${+e.split("#")[1]}`,Yi=p&&new RegExp(`^(view-source:)?(${T.replace("://","$&)?")}[^/]*\\.user\\.js#\\d+`),Zi=Yi&&((e,t)=>{Yi.test(t)&&browser.tabs.update(e,{url:Xi(t)})});async function Qi(e,t){const{data:n}=await ee(t).catch(A)||{};if(n&&Gt(n).name){const r=e>=0&&await browser.tabs.get(e)||{};We.ConfirmInstall({code:n,url:t,from:r.url},{tab:r})}else ht.put(`bypass:${t}`,!0,1e4),e>=0&&browser.tabs.update(e,{url:t})}if(Yi){const e=(e,{url:t})=>t&&Zi(e,t),t=browser.tabs.onUpdated,n=t.addListener.bind(t,e);try{n({properties:["url"]})}catch(e){n()}}browser.tabs.onCreated.addListener(e=>{const{id:t,title:n,url:r}=e;(!r.startsWith("file:")||Po.firefox<68)&&/\.user\.js([?#]|$)/.test(e.pendingUrl||r)&&ht.put(`autoclose:${t}`,!0,1e4),Yi&&"about:blank"===r&&Zi(t,n)}),browser.webRequest.onBeforeRequest.addListener(e=>{const{method:t,tabId:n,url:r}=e;if("GET"===t)return r.startsWith(T)?{redirectUrl:Xi(r)}:ht.has(`bypass:${r}`)||Ji.test(r)&&!Ki.test(r)?void 0:(Qi(n,r),{redirectUrl:"javascript:void 0"})},{urls:["*://*/*.user.js","*://*/*.user.js?*","file://*/*.user.js","file://*/*.user.js?*",`${T}*.user.js`],types:["main_frame"]},["blocking"]);const ea={};function ta(e){1===e.length?ia(e[0]):e.length&&ia({text:e.map(e=>e.text).join("\n"),onClick:browser.runtime.openOptionsPage})}function na(e,t){const{id:n}=t.props,r=Ce(t,!0);return r&&e.push(ea[n]||(ea[n]=ra(t,r))),e}async function ra(e,t){const{id:n}=e.props;let r,o,s,i;try{const{update:a}=await pr({id:n,code:await oa(e,t),update:{checking:!1}});o=O("msgScriptUpdated",[Ue(a)]),i={cache:"no-cache"},r=!0}catch(e){s=e.error,i=!e.error&&!e.checking&&{}}finally{i&&(s=await fr(e,null,i)),sa(e)&&(o||s)&&(r={script:e,text:d(Ee,[o,s],"\n")}),delete ea[n]}return r}async function oa(e,t){let n;const{meta:o,props:{id:s}}=e,[i,a]=t,c={},u={update:c,where:{id:s}};l(O("msgCheckingForUpdate"));try{const{data:e}=await lt(a,{cache:"no-cache",headers:{Accept:"text/x-userscript-meta,*/*"}})||{},{version:t}=e?Gt(e):{};if(W(o.version,t)>=0)l(O("msgNoUpdate"),{checking:!1});else{if(i)return i===a?(l(O("msgUpdated")),e):(l(O("msgUpdating")),n=O("msgErrorFetchingScript"),(await lt(i,{cache:"no-cache"})).data);l(O("msgNewVersion"),{checking:!1})}}catch(e){l(n||O("msgErrorFetchingUpdateInfo"),{error:e})}throw c;function l(e,{error:t,checking:n=!t}={}){r.assign(c,{message:e,checking:n,error:t?`${O("genericError")} ${t.status}, ${t.url}`:null}),be("UpdateScript",u)}}function sa(e){var t;const n=Dt("notifyUpdates");return Dt("notifyUpdatesGlobal")?n:null!=(t=e.config.notifyUpdates)?t:n}function ia({script:e,text:t,onClick:n=(()=>We.OpenEditor(e.props.id))}){We.Notification({text:t,title:p?O("optionUpdate"):""},void 0,{onClick:n})}Fe({async CheckUpdate(e){const t=e?[Nn(e)]:Hn(),n=await o.all(t.reduce(na,[]));return ta(n.filter(e=>null==e?void 0:e.text)),e||Et("lastUpdate",Date.now()),n.reduce((e,t)=>e+(!0===t),0)}}),At(e=>{"autoUpdate"in e&&la(),be("UpdateOptions",e)}),Fe({async GetData(e){const t=await nr(e);return t.sync=Dr(),t},GetSizes:or,async GetTabDomain(){const e=await Me()||{},t=(e.pendingUrl||e.url||"").match(/^https?:\/\/([^/]+)|$/)[1];return{tab:e,domain:t&&Pe(t)||t}}}),Be({SetTimeout:e=>e>0&&De(e)});const aa=["MarkRemoved","Move","ParseScript","RemoveScript","UpdateScriptInfo"],ca=["CheckRemove","CheckUpdate"];async function ua({cmd:e,data:t}={},n){const r=d(u,We,e)&&We[e];if(!r)throw new c(`Unknown command: ${e}`);if(r.isOwn&&n&&!n.fake&&(n.origin?n.origin!==R:!`${n.url}`.startsWith(T)))throw new c(`Command is only allowed in extension context: ${e}`);try{const o=await r(t,n);return(aa.includes(e)||o&&ca.includes(e))&&Br(),null!=o?o:null}catch(e){throw e instanceof c?e:new c(e)}}function la(){const e=(+Dt("autoUpdate")||0)*_;if(!e)return;let t=Date.now()-Dt("lastUpdate");t>=e&&(ua({cmd:"CheckUpdate"}),t=0),clearTimeout(la.timer),la.timer=setTimeout(la,Math.min(I,e-t))}yt(()=>{e.handleCommandMessage=ua,e.deepCopy=le,browser.runtime.onMessage.addListener(ua),setTimeout(la,2e4),Vr(),ar(),setInterval(ar,_);const t=e.chrome.declarativeContent;t&&t.onPageChanged.getRules(null,async([e])=>{const n=null==e?void 0:e.id,r="Violentmonkey:E3GD8ruVdGc=";n!==r&&(n&&await browser.declarativeContent.onPageChanged.removeRules([n]),t.onPageChanged.addRules([{id:r,conditions:[new t.PageStateMatcher({pageUrl:{urlContains:"://"}})],actions:[new t.RequestContentScript({js:browser.runtime.getManifest().content_scripts[0].js})]}]))})})}},m={};function g(e){var t=m[e];if(void 0!==t)return t.exports;var n=m[e]={exports:{}};return f[e](n,n.exports,g),n.exports}g.m=f,h=[],g.O=(e,t,n,o)=>{if(!t){var s=1/0;for(u=0;u<h.length;u++){for(var[t,n,o]=h[u],i=!0,a=0;a<t.length;a++)(!1&o||s>=o)&&r.keys(g.O).every(e=>g.O[e](t[a]))?t.splice(a--,1):(i=!1,o<s&&(s=o));if(i){h.splice(u--,1);var c=n();void 0!==c&&(e=c)}}return e}o=o||0;for(var u=h.length;u>0&&h[u-1][2]>o;u--)h[u]=h[u-1];h[u]=[t,n,o]},g.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return g.d(t,{a:t}),t},g.d=(e,t)=>{for(var n in t)g.o(t,n)&&!g.o(e,n)&&r.defineProperty(e,n,{enumerable:!0,get:t[n]})},g.o=(e,t)=>r.prototype.hasOwnProperty.call(e,t),(()=>{var e={798:0};g.O.j=t=>0===e[t];var t=(t,n)=>{var r,o,[s,i,a]=n,c=0;if(s.some(t=>0!==e[t])){for(r in i)g.o(i,r)&&(g.m[r]=i[r]);if(a)var u=a(g)}for(t&&t(n);c<s.length;c++)o=s[c],g.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return g.O(u)},n=self.webpackChunkviolentmonkey=self.webpackChunkviolentmonkey||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var w=g.O(void 0,[582],()=>g(353));w=g.O(w)})()}