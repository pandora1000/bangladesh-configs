{const t=function(){return this||globalThis}(),{Boolean:e,Error:s,Object:n,Promise:i,document:a,window:l}=t,{hasOwnProperty:o,toString:r}={},c=n.call.bind(n.call);t.chrome.app,(()=>{var t,l={4586:(t,s,l)=>{"use strict";l(2993);var o=l(3293),r=(l(287),l(4017)),d=l(7311),h=(l(537),l(5517),l(6252)),u=l(3577);const p={class:"frame-block"},m={class:"flex"},g=(0,h._)("div",{class:"image"},[(0,h._)("img",{src:"/public/images/icon128.png"})],-1),f={class:"info"},v=["textContent"],w=["textContent"],C=["textContent"],b={class:"flex"},x=["textContent"],k=["href"],y=["textContent"],_=["textContent"],L=["data-collapsed"],S=["data-type","hidden"],$=["textContent"],D=["textContent"],O={class:"flex"},T={class:"image flex"},I=["src"],F={class:"actions flex flex-wrap mr-2c"},j=["textContent","data-hotkey","disabled"],q=["textContent"],z={class:"flex flex-col my-1"},P=["textContent"],W=["textContent","title"],M=["textContent"],Z={class:"frame-block flex-1 pos-rel"};function H(t,e){var s;const n=(0,h.up)("icon"),i=(0,h.up)("tooltip"),a=(0,h.up)("setting-check"),l=(0,h.up)("vm-externals");return(0,h.wg)(),(0,h.iD)("div",{class:(0,u.C_)(["page-confirm frame flex flex-col h-screen",{reinstall:t.reinstall}])},[(0,h._)("div",p,[(0,h._)("div",m,[g,(0,h._)("div",f,[(0,h._)("h1",null,[(0,h._)("div",null,[(0,h._)("span",{textContent:(0,u.zw)(t.heading)},null,8,v),t.sameCode?((0,h.wg)(),(0,h.iD)("span",{key:0,textContent:(0,u.zw)(t.i18n("msgSameCode")),style:{"font-weight":"normal"}},null,8,w)):(0,h.kq)("",!0)]),(0,h._)("div",{class:"ellipsis",textContent:(0,u.zw)(t.name)},null,8,C)]),(0,h._)("div",b,[(0,h.Wm)(i,{content:t.i18n("editNavCode"),class:"abs-center",placement:"right"},{default:(0,h.w5)(()=>[(0,h.Wm)(n,{name:"code"})]),_:1},8,["content"]),(0,h._)("span",{class:"ellipsis",textContent:(0,u.zw)(t.info.url?decodeURIComponent(t.info.url):"...")},null,8,x)]),((0,h.wg)(!0),(0,h.iD)(h.HY,null,(0,h.Ko)(t.icons,([t,e,s])=>((0,h.wg)(),(0,h.iD)("a",{key:e,class:"flex",target:"_blank",href:t},[(0,h.Wm)(i,{content:s,class:"abs-center",placement:"right"},{default:(0,h.w5)(()=>[(0,h.Wm)(n,{name:e},null,8,["name"])]),_:2},1032,["content"]),(0,h._)("span",{class:"ellipsis",textContent:(0,u.zw)(decodeURIComponent(t))},null,8,y)],8,k))),128)),(0,h._)("p",{class:"descr",textContent:(0,u.zw)(t.descr)},null,8,_),(0,h._)("div",{class:"lists flex flex-wrap","data-collapsed":!t.listsShown},[(0,h._)("div",{class:"toggle abs-center",onClick:e[0]||(e[0]=e=>t.listsShown=!t.listsShown)},[t.lists?((0,h.wg)(),(0,h.j4)(i,{key:0,content:t.i18n("msgShowHide"),placement:"bottom",align:"left"},{default:(0,h.w5)(()=>[(0,h.Wm)(n,{name:"info"})]),_:1},8,["content"])):(0,h.kq)("",!0)]),((0,h.wg)(!0),(0,h.iD)(h.HY,null,(0,h.Ko)(t.lists,(e,s)=>((0,h.wg)(),(0,h.iD)("dl",{key:s,"data-type":s,hidden:!e.length,tabindex:"0"},[(0,h._)("dt",{textContent:(0,u.zw)(s?`@${s}`:t.i18n("genericError"))},null,8,$),(0,h._)("dd",{textContent:(0,u.zw)(e),class:"ellipsis"},null,8,D)],8,S))),128))],8,L)])]),(0,h._)("div",O,[(0,h._)("div",T,[(0,h._)("img",{src:t.safeIcon},null,8,I)]),(0,h._)("div",F,[(0,h._)("button",{id:"confirm",ref:"confirm",textContent:(0,u.zw)(t.reinstall?t.i18n("buttonConfirmReinstallation"):t.i18n("buttonConfirmInstallation")),"data-hotkey":t.confirmHotkey,onClick:e[1]||(e[1]=(...e)=>t.installScript&&t.installScript(...e)),disabled:!t.installable},null,8,j),(0,h._)("button",{textContent:(0,u.zw)(t.i18n("buttonClose")),onClick:e[2]||(e[2]=(...e)=>t.close&&t.close(...e))},null,8,q),(0,h._)("div",z,[(0,h.Wm)(a,{name:"closeAfterInstall",label:t.i18n("installOptionClose"),"data-disabled":t.isLocal&&(null==(s=t.$refs.trackLocalFile)?void 0:s.value),ref:"closeAfterInstall"},null,8,["label","data-disabled"]),(0,h.Wm)(a,{name:"trackLocalFile",onChange:t.trackLocalFile,ref:"trackLocalFile","data-disabled":!t.isLocal},{default:(0,h.w5)(()=>[(0,h.Wm)(i,{content:t.trackTooltip,disabled:!t.trackTooltip},{default:(0,h.w5)(()=>[(0,h._)("span",{textContent:(0,u.zw)(t.i18n("installOptionTrack"))},null,8,P)]),_:1},8,["content","disabled"])]),_:1},8,["onChange","data-disabled"])]),t.message?((0,h.wg)(),(0,h.iD)("div",{key:0,textContent:(0,u.zw)(t.message),title:t.error,class:"status"},null,8,W)):(0,h.kq)("",!0)])]),t.info.incognito?((0,h.wg)(),(0,h.iD)("div",{key:0,class:"incognito",textContent:(0,u.zw)(t.i18n("msgIncognitoChanges"))},null,8,M)):(0,h.kq)("",!0)]),(0,h._)("div",Z,[t.script?((0,h.wg)(),(0,h.j4)(l,{key:0,ref:"externals",value:t.script,class:"abs-full","cm-options":t.cmOptions,commands:t.commands,install:{code:t.code,deps:t.deps,url:t.info.url}},null,8,["value","cm-options","commands","install"])):(0,h.kq)("",!0)])],2)}var E=l(3824),U=l(6930),R=l(8250),B=l(8856),N=l(9727),Y=l(8694),A=l(3057),Q=l(5310),G=l(8292),J=l(3795);const K=5e3,V=3e3,X=2,tt=100,et=(/Mac/.test(navigator.platform)?"Cmd":"Ctrl")+"-Enter",st=(0,B.Z)({lifetime:V*(X+1)});let nt,it,at,lt,ot;const rt={components:{Icon:U.Z,VmExternals:N.Z,SettingCheck:Y.Z,Tooltip:E.Z},data(){return{installable:!1,installed:!1,message:"",cmOptions:{lineWrapping:!0},code:"",commands:{close:this.close},confirmHotkey:et,info:{},deps:{},descr:"",error:null,heading:this.i18n("msgLoadingData"),lists:null,listsShown:!0,name:"...",reinstall:!1,safeIcon:null,sameCode:!1,script:null}},computed:{trackTooltip(){return J.Z.firefox>=68?this.i18n("installOptionTrackTooltip"):null},isLocal(){return!(0,o.Q1)(this.info.url)},icons(){const{script:t}=this,s=t&&(0,o.t$)(t),n=null==t?void 0:t.meta.supportURL;return[s&&[s,"home",this.i18n("labelHomepage")],n&&[n,"question",this.i18n("buttonSupport")]].filter(e)}},async mounted(){const t=`confirm-${G.BC.paths[0]}`,e=await(0,o.gj)("CacheLoad",t);this.info=e,e?(at=e.ff>=68&&e.url.startsWith("file:"),ot=(0,o.gj)("CachePop",e.url),this.guard=setInterval(o.gj,K,"CacheHit",{key:t}),await this.loadData(),await this.parseMeta(),await i.all([this.checkSameCode(),(async()=>{let t=X;for(;!await this.loadDeps()&&t;)await(0,o.dL)(V),t-=1})()]),this.installable&&(this.heading=this.reinstall?this.i18n("labelReinstall"):this.i18n("labelInstall")),this.disposeList=[R.$J.register("ctrlcmd-enter",()=>this.$refs.confirm.click())],R.$J.enable()):this.close()},beforeUnmount(){var t;this.guard&&(clearInterval(this.guard),this.guard=null),null==(t=this.disposeList)||t.forEach(t=>t())},methods:{async loadData(t){this.installable=!1;const e=at?await new i(this.pingFilePort):await this.getScript(this.info.url);if(null==e||t&&this.code===e)throw 0;this.setCode(e)},setCode(t){var e,s;const n=t.split(/\r?\n/),i=null==(e=this.$refs.externals)||null==(s=e.$refs.code)?void 0:s.cm;let a,l=-1;i&&i.eachLine(({text:t})=>(a=t!==n[l+=1],a)),this.code=t,(a||i&&l<n.length-1)&&this.$nextTick(()=>{i.setCursor(l),i.scrollIntoView(null,i.display.lastWrapHeight/3)})},async parseMeta(){const{meta:t,errors:e}=await(0,o.gj)("ParseMeta",this.code),s=(0,o.iQ)(t,"name");a.title=`${s.slice(0,tt)}${s.length>tt?"...":""} - ${lt||(lt=a.title)}`,this.name=c(o.Hv,[s,t.version],", "),this.descr=(0,o.iQ)(t,"description"),this.lists=(0,Q.zr)(t,["antifeature","grant","match","include","exclude","excludeMatch","compatible","connect"],t=>(null==t?void 0:t.map(t=>[t.replace(/^\W+/,"")||t,t]).sort(([t],[e])=>t<e?-1:t>e).map(([,t])=>t).join("\n"))||""),this.lists[""]=(null==e?void 0:e.join("\n"))||"",this.script={meta:t,custom:{},props:{}},this.allDeps=[[...new Set(t.require)],[...new Set(n.values(t.resources))]]},async loadDeps(){const{script:t,allDeps:[e,s]}=this;if(this.safeIcon||(0,A.d)(t).then(t=>{this.safeIcon=t}),this.require&&(0,Q.vZ)(e.slice().sort(),n.keys(this.require).sort())&&(0,Q.vZ)(s.slice().sort(),n.keys(this.resources).sort()))return;this.require={},this.resources={};const a=e.length+s.length;let l=0;const r=500,d=performance.now(),h=()=>{performance.now()-d>r&&(this.message=this.i18n("msgLoadingDependency",[l,a]))},u=async(t,e,s)=>{const n=(0,o.mn)(t,this.info.url),i=`${+s}${t}`;try{const t=await this.getFile(n,{isBlob:s,useCache:!0});e[n]=t,this.deps[i]=t,l+=1,h()}catch(e){return this.deps[i]=!1,t}},p=setTimeout(h,r),m=[...e.map(t=>u(t,this.require,!1)),...s.map(t=>u(t,this.resources,!0))],g=c(o.Hv,await i.all(m),"\n");if(clearTimeout(p),!g)return this.error=null,this.installable=!0,this.message=null,!0;this.message=this.i18n("msgErrorLoadingDependency"),this.error=g},close(){(0,o.gj)("TabClose")},async getFile(t,{isBlob:e,useCache:s}={}){const n=e?`blob+${t}`:`text+${t}`;if(s&&st.has(n))return st.get(n);const i=await(0,o.WY)(t,{responseType:e?"blob":null}),a=e?await(0,o.LZ)(i):i.data;return s&&st.put(n,a),a},async getScript(t){try{return ot&&await ot||await this.getFile(t)}catch(e){throw this.message=this.i18n("msgErrorLoadingData"),t}finally{ot=null}},async installScript(){this.installable=!1;try{const{update:t}=await(0,o.gj)("ParseScript",{code:this.code,url:this.info.url,from:this.info.from,require:this.require,cache:this.resources}),e=(new Date).toLocaleTimeString(["fr"]),s=this.confirmedTime||(this.confirmedTime=e);this.message=`${t.message} ${s}${s===e?"":` --\x3e ${e}`}`,this.installed=!0,this.isLocal&&this.$refs.trackLocalFile.value?this.trackLocalFile():this.$refs.closeAfterInstall.value&&this.close()}catch(t){this.message=`${t}`,this.installable=!0}},async trackLocalFile(){if(!this.tracking&&this.isLocal&&this.installed){for(ot=null,this.tracking=!0;this.$refs.trackLocalFile.value&&"stop"!==this.tracking;){await(0,o.dL)(500);try{await this.loadData(!0),await this.parseMeta(),await this.loadDeps(),await this.installScript(),this.sameCode=!1}catch(t){}}this.tracking=!1}},async checkSameCode(){const{name:t,namespace:e}=this.script.meta||{},s=await(0,o.gj)("GetScript",{meta:{name:t,namespace:e}});this.reinstall=!!s,this.sameCode=s&&this.code===await(0,o.gj)("GetScriptCode",s.props.id)},createFilePort(){nt=browser.tabs.connect(this.info.tabId,{name:"FetchSelf"}),nt.onMessage.addListener(t=>{it(t)}),nt.onDisconnect.addListener(()=>{this.tracking="stop"})},pingFilePort(t){nt||this.createFilePort(),it=t,nt.postMessage(null)}}},ct=(0,l(3744).Z)(rt,[["render",H]]);a.title=`${(0,o.ag)("labelInstall")} - ${(0,o.ag)("extName")}`,r.Z.ready.then(()=>{(0,d.sY)(ct)})},6291:(t,e,i)=>{var a={"./arrow.svg":7864,"./author.svg":6263,"./code.svg":4237,"./cog.svg":8527,"./command.svg":6337,"./filter.svg":1691,"./home.svg":6447,"./info.svg":6396,"./more.svg":485,"./plus.svg":336,"./question.svg":934,"./refresh.svg":1727,"./search.svg":2574,"./toggle-off.svg":3882,"./toggle-on.svg":6276,"./trash.svg":2981,"./undo.svg":418};function l(t){var e=o(t);return i(e)}function o(t){if(!i.o(a,t)){var e=new s("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return a[t]}l.keys=()=>n.keys(a),l.resolve=o,t.exports=l,l.id=6291},7462:(t,e,s)=>{"use strict";function i(){return i=n.assign?n.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)n.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},i.apply(this,arguments)}s.d(e,{Z:()=>i})}},o={};function r(t){var e=o[t];if(void 0!==e)return e.exports;var s=o[t]={exports:{}};return l[t].call(s.exports,s,s.exports,r),s.exports}r.m=l,t=[],r.O=(e,s,i,a)=>{if(!s){var l=1/0;for(h=0;h<t.length;h++){for(var[s,i,a]=t[h],o=!0,c=0;c<s.length;c++)(!1&a||l>=a)&&n.keys(r.O).every(t=>r.O[t](s[c]))?s.splice(c--,1):(o=!1,a<l&&(l=a));if(o){t.splice(h--,1);var d=i();void 0!==d&&(e=d)}}return e}a=a||0;for(var h=t.length;h>0&&t[h-1][2]>a;h--)t[h]=t[h-1];t[h]=[s,i,a]},r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var s in e)r.o(e,s)&&!r.o(t,s)&&n.defineProperty(t,s,{enumerable:!0,get:e[s]})},r.o=(t,e)=>n.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&n.defineProperty(t,Symbol.toStringTag,{value:"Module"}),n.defineProperty(t,"__esModule",{value:!0})},r.j=47,(()=>{var t={47:0};r.O.j=e=>0===t[e];var e=(e,s)=>{var n,i,[a,l,o]=s,c=0;if(a.some(e=>0!==t[e])){for(n in l)r.o(l,n)&&(r.m[n]=l[n]);if(o)var d=o(r)}for(e&&e(s);c<a.length;c++)i=a[c],r.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return r.O(d)},s=self.webpackChunkviolentmonkey=self.webpackChunkviolentmonkey||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})();var d=r.O(void 0,[386,84],()=>r(4586));d=r.O(d)})()}